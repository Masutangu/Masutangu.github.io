<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Programming Language</title>
  <meta name="description" content="一. 声明式编程和命令式编程">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Programming Language">
  <meta name="twitter:description" content="一. 声明式编程和命令式编程">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="Programming Language">
  <meta property="og:description" content="一. 声明式编程和命令式编程">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://masutangu.com/2018/01/programing-language/">
  <link rel="alternate" type="application/rss+xml" title="Masutangu" href="http://masutangu.com/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="前往 Masutangu 的主页" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="Masutangu logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Masutangu" class="blog-button">Masutangu</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">长风破浪会有时 直挂云帆济沧海</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">也許我這一生　始終在追逐那顆九號球</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="Visit blog" class="blog-button">博客</a></li>
                
                  <li class="navigation__item"><a href="http://500px.me/community/user-details/5cc3fb7c1480fb4fc2140a09627457614" target="_blank" title="Life">生活</a></li>
                
                  <li class="navigation__item"><a href="https://about.me/masutangu" target="_blank" title="About me">关于</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/masutangu" title="@masutangu 的 Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  
  
  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:masutangu.cs@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-blue"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-01-13 11:30:24 +0800" itemprop="datePublished" class="post-meta__date date">2018-01-13</time> &#8226; <span class="post-meta__tags tags">读书笔记</span>
    </div>
    <h1 class="post-title">Programming Language</h1>
  </header>

  <section class="post">
    <h2>一. 声明式编程和命令式编程</h2>

<h4>声明式编程（Declarative Programming）</h4>

<p>Building the structure and elements of computer programs, that <strong>expresses the logic of a computation without describing its control flow</strong>.</p>

<h4>命令式编程（Imperative Programming）</h4>

<p>Describes computation <strong>in terms of statements that change a program state</strong>.</p>

<p><em>左图为 Declarative Programming 范式，右图为 Imperative Programming 范式：</em>
<img src="/assets/images/programming-language/illustration-3.png" width="800"/></p>

<h2>二. 函数式编程</h2>

<p>三大特性：</p>

<ul>
<li>No Mutation</li>
<li>First Class Function</li>
<li>Tail Recursion Optimization</li>
</ul>

<h3>1. No Mutation</h3>

<p>知乎上<a href="https://www.zhihu.com/question/28292740">《什么是函数式编程思维》</a>其中一个回到写得很好：</p>

<blockquote>
<p>函数式编程的本质：
函数式编程中的<strong>函数</strong>这个术语不是指计算机中的函数，而是指数学中的函数，即自变量的映射。也就是说一个函数的值仅决定于函数参数的值，不依赖其他状态。在函数式语言中，<strong>函数作为一等公民</strong>，可以在任何地方定义，在函数内或函数外，可以作为函数的参数和返回值，可以对函数进行组合。纯函数式编程语言中的<strong>变量</strong>也不是命令式编程语言中的变量表示存储状态的单元，而是<strong>代数中的变量</strong>，即一个值的名称。变量的值是<strong>不可变的（immutable）</strong>，也就是说不允许像命令式编程语言中那样多次给一个变量赋值。</p>
</blockquote>

<p>没有 Mutation 带来的好处:</p>

<ul>
<li>No code can ever distinguish aliasing vs. identical copies</li>
<li>No need to think about aliasing: focus on other things</li>
<li>Can use aliasing, which saves space, without danger </li>
</ul>

<h3>2. How to build bigger types</h3>

<p>3 most important type building-blocks in any language</p>

<ul>
<li><strong>Each of</strong>: A t value contains values of each of t1 t2 … tn</li>
<li><strong>One of</strong>: A t value contains values of one of t1 t2 … tn</li>
<li><strong>Self reference</strong>: A t value can refer to other t values</li>
</ul>

<h3>3. Tail Recursion and Accumulators</h3>

<p>ML recognizes these tail calls in the compiler and treats them differently: <strong>pop the caller before the call, allowing callee to reuse the same stack space</strong></p>

<p><em>非尾递归的调用堆栈</em>
<img src="/assets/images/programming-language/illustration-1.png" width="800"/></p>

<p><em>尾递归优化后的调用堆栈</em>
<img src="/assets/images/programming-language/illustration-2.png" width="800"/></p>

<h3>4. Higher Order Function</h3>

<h4>Map</h4>
<figure class="highlight"><pre><code class="language-text" data-lang="text">fun map (f,xs) =
 case xs of
 [] =&gt; []
 | x::xs’ =&gt; (f x)::(map(f,xs’))
</code></pre></figure>
<h4>Filter</h4>
<figure class="highlight"><pre><code class="language-text" data-lang="text">fun filter (f,xs) =
 case xs of
 [] =&gt; []
 | x::xs’ =&gt; if f x
 then x::(filter(f,xs’))
 else filter(f,xs’)
</code></pre></figure>
<h4>Fold</h4>
<figure class="highlight"><pre><code class="language-text" data-lang="text">fun fold f acc xs =
 case xs of
 [] =&gt; acc
 | x::xs’ =&gt; fold f (f(acc,x)) xs’
</code></pre></figure>
<h4>Higher Order Function vs For Loop</h4>

<p><strong>Fold</strong>  is another very famous iterator over recursive structures. This pattern separates recursive traversal from data processing:</p>

<ul>
<li><strong>Can reuse same traversal for different data processing</strong></li>
<li><strong>Can reuse same data processing for different data structures</strong></li>
<li><strong>In both cases, using common vocabulary concisely communicates intent</strong></li>
</ul>

<p><strong>遍历函数和处理函数分离，提高复用性。</strong></p>

<h3>5. Function Closure</h3>

<p>A function value has two parts:</p>

<ul>
<li><strong>The code</strong> </li>
<li><strong>The environment</strong> that was current when the function was defined</li>
</ul>

<p>This pair is called a <strong>function closure</strong>.</p>

<h3>6. Abstract Data Types With Closure</h3>
<figure class="highlight"><pre><code class="language-text" data-lang="text">datatype set = S of { insert : int -&gt; set, 
              member : int -&gt; bool, 
              size   : unit -&gt; int }

val empty_set =
    let
        fun make_set xs = (* xs is a &quot;private field&quot; in result *)
            let (* contains a &quot;private method&quot; in result *)
                fun contains i = List.exists (fn j =&gt; i=j) xs
            in
                S { insert = fn i =&gt; if contains i 
                                     then make_set xs 
                                     else make_set (i::xs),
                    member = contains,
                    size   = fn () =&gt; length xs
                  }
            end
    in
        make_set []
    end 

fun use_sets () =
    let val S s1 = empty_set
        val S s2 = (#insert s1) 34
        val S s3 = (#insert s2) 34
        val S s4 = #insert s3 19
    in
        if (#member s4) 42
        then 99
        else if (#member s4) 19
        then 17 + (#size s3) ()
        else 0
    end 
</code></pre></figure>
<p><em>使用 Java 实现：</em></p>
<figure class="highlight"><pre><code class="language-java" data-lang="java">interface Func&lt;B,A&gt; {
    B m(A x);
}
interface Pred&lt;A&gt; {
    boolean m(A x);
}

class List&lt;T&gt; {
    T       head;
    List&lt;T&gt; tail;
    List(T x, List&lt;T&gt; xs) {
    head = x;
    tail = xs;
    }

    // * the advantage of a static method is it allows xs to be null
    //    -- a more OO way would be a subclass for empty lists
    // * a more efficient way in Java would be a messy while loop
    //   where you keep a pointer to the previous element and mutate it
    //   -- (try it if you do not believe it is messy)
    static &lt;A,B&gt; List&lt;B&gt; map(Func&lt;B,A&gt; f, List&lt;A&gt; xs) {
        if(xs==null)
            return null;
        return new List&lt;B&gt;(f.m(xs.head), map(f,xs.tail));
    }

    static &lt;A&gt; List&lt;A&gt; filter(Pred&lt;A&gt; f, List&lt;A&gt; xs) {
        if(xs==null)
            return null;
        if(f.m(xs.head))
            return new List&lt;A&gt;(xs.head, filter(f,xs.tail));
        return filter(f,xs.tail);
    }

    // * again recursion would be more elegant but less efficient
    // * again an instance method would be more common, but then
    //   all clients have to special-case null 
    static &lt;A&gt; int length(List&lt;A&gt; xs) {
        int ans = 0;
        while(xs != null) {
            ++ans;
            xs = xs.tail;
        }
        return ans;
    }
}

class ExampleClients {
    static List&lt;Integer&gt; doubleAll(List&lt;Integer&gt; xs) {
        return List.map((new Func&lt;Integer,Integer&gt;() { 
                     public Integer m(Integer x) { return x * 2; } 
                         }), xs);
    }
    static int countNs(List&lt;Integer&gt; xs, final int n) {
        return List.length(List.filter(
           (new Pred&lt;Integer&gt;() { 
               public boolean m(Integer x) { return x==n; } 
           }), xs));
    }
}
</code></pre></figure>
<p><em>使用 C 实现:</em></p>
<figure class="highlight"><pre><code class="language-c" data-lang="c">typedef struct List list_t;
struct List {
  void * head;
  list_t * tail;
};

list_t * makelist (void * x, list_t * xs) {
  list_t * ans = (list_t *)malloc(sizeof(list_t));
  ans-&gt;head = x;
  ans-&gt;tail = xs;
  return ans;
}

list_t * map(void* (*f)(void*,void*), void* env, list_t * xs) {
  if(xs==NULL)
    return NULL;
  return makelist(f(env,xs-&gt;head), map(f,env,xs-&gt;tail));
}

list_t * filter(bool (*f)(void*,void*), void* env, list_t * xs) {
  if(xs==NULL)
    return NULL;
  if(f(env,xs-&gt;head))
    return makelist(xs-&gt;head, filter(f,env,xs-&gt;tail));
  return filter(f,env,xs-&gt;tail);
}

int length(list_t* xs) {
  int ans = 0;
  while(xs != NULL) {
    ++ans;
    xs = xs-&gt;tail;
  }
  return ans;
}

// clients of our list implementation:
// [the clients that cast from void* to intptr_t are technically not legal C, 
//  as explained in detail below if curious]

// awful type casts to match what map expects
void* doubleInt(void* ignore, void* i) {
  return (void*)(((intptr_t)i)*2);
}

// assumes list holds intptr_t fields
list_t * doubleAll(list_t * xs) {
  return map(doubleInt, NULL, xs);
}

// awful type casts to match what filter expects
bool isN(void* n, void* i) {
  return ((intptr_t)n)==((intptr_t)i);
}

// assumes list hold intptr_t fields
int countNs(list_t * xs, intptr_t n) {
  return length(filter(isN, (void*)n, xs));
}
</code></pre></figure>
  </section>
</article>

<section class="read-more">
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">更早的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2018/01/game-recover-based-on-replicated-state-machine/" title="link to 基于 Replicated State Machine 实现游戏进程恢复">基于 Replicated State Machine 实现游戏进程恢复</a></h2>
       <p class="excerpt">Introduction游戏服务器实现的业务逻辑普遍比较复杂，且大部分是带有状态的。如果进程重启或意外崩溃，会导致该服务器上的玩家断线，丢失进行中的游戏数据，带来极差的游戏体验。为了避免这种情况出现，一般游戏服务器都会持久化玩家数据以实现进程恢复，当重启或进程意外崩溃时，重新拉起进程后可以恢复到之前的状态。常用的做法是将玩家的状态信息保存在共享内存中，重启时加载共享内存进行恢复。共享内存虽然方便，但会有许多限制。比如 C++ 涉及到多态（虚函数表）、STL容器（heap分配），都不能直接映...&hellip;</p>
       <div class="post-list__meta"><time datetime="2018-01-13 11:30:24 +0800" class="post-list__meta--date date">2018-01-13</time> &#8226; <span class="post-list__meta--tags tags">工作</span><a class="btn-border-small" href=/2018/01/game-recover-based-on-replicated-state-machine/>继续阅读</a></div>
   </div>
   
</section>

<section class="post-comments">
  
    <div id="disqus_thread"></div>
    <script>
    
    var disqus_config = function () {
        this.page.url = "http://masutangu.com/2018/01/programing-language/";
        this.page.identifier = "/2018/01/programing-language/";
    };

    var disqus_shortname = 'masutangu';
    
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>要查看<a href="http://disqus.com/?ref_noscript"> Disqus </a>评论，请启用 JavaScript</noscript>
    
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">本站点采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a></span>
        <span class="footer__copyright">本站由 <a href="http://masutangu.com/">@masutangu</a> 创建，采用 <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> 作为主题，您可以在 GitHub 找到<a href="https://github.com/Masutangu/Masutangu.github.io">本站源码</a> - &copy; 2018</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript" src="/js/main.js"></script>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-77236140-1', 'masutangu.com');
    ga('send', 'pageview');
</script>


    
  </body>

</html>
