<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Masutangu</title>
    <description>ä¹Ÿè¨±æˆ‘é€™ä¸€ç”Ÿã€€å§‹çµ‚åœ¨è¿½é€é‚£é¡†ä¹è™Ÿçƒ</description>
    <link>http://masutangu.com/</link>
    <atom:link href="http://masutangu.com/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 02 Apr 2018 23:32:34 +0800</pubDate>
    <lastBuildDate>Mon, 02 Apr 2018 23:32:34 +0800</lastBuildDate>
    <generator>Jekyll v3.1.1</generator>
    
      <item>
        <title>Programming Language è¯¾ç¨‹ç¬”è®°</title>
        <description>&lt;p&gt;æœ¬æ–‡æ˜¯å­¦ä¹ &lt;a href=&quot;https://www.coursera.org/learn/programming-languages-part-b/home/info&quot;&gt;Coursera Programming Language&lt;/a&gt;è¯¾ç¨‹çš„å­¦ä¹ ç¬”è®°ï¼Œæ–‡ç« å†…å®¹åŠä»£ç å‡å–è‡ªè¯¾ç¨‹ææ–™ã€‚&lt;/p&gt;

&lt;h1&gt;Interpreter or Compiler&lt;/h1&gt;

&lt;p&gt;å®ç°ç¼–ç¨‹è¯­è¨€çš„ workflow å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/programming-language-b/illustration-1.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Parser è¯»å–ç¨‹åºæ–‡æœ¬ï¼Œæ£€æŸ¥ syntaxï¼Œå¦‚æœè¯­æ³•æ­£ç¡®åˆ™è¾“å‡º ASTï¼ˆabstract syntax treeï¼‰ã€‚å¦‚æœè¯¥ç¼–ç¨‹è¯­è¨€æœ‰ type checkerï¼Œåˆ™å°† AST ä¸¢ç»™ type checker æ£€æŸ¥ï¼Œé€šè¿‡ type check åï¼Œå°±ç”± interpreter æˆ– compile æ¥è¿è¡Œç¨‹åºå¹¶è¾“å‡ºç»“æœã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å®ç°ç¼–ç¨‹è¯­è¨€ B é€šå¸¸æœ‰ä¸‹é¢ä¸¤ç§åŠæ³•ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ A æ¥å®ç° interpreterï¼ˆå‘½åä¸º evaluator æˆ– executor æ›´æ°å½“ï¼‰ï¼Œè¾“å…¥ B è¯­è¨€å†™çš„ä»£ç ï¼Œè¾“å‡ºç»“æœ&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ A å®ç° compilerï¼ˆå‘½åä¸º translator æ›´æ°å½“ï¼‰ï¼Œå°† B ç¿»è¯‘æˆç¬¬ä¸‰ç§ç¼–ç¨‹è¯­è¨€ C&lt;/li&gt;
&lt;/ul&gt;

&lt;h1&gt;Skipping Parsing&lt;/h1&gt;

&lt;p&gt;å¦‚æœåŸºäºç¼–ç¨‹è¯­è¨€ A æ¥å®ç°ç¼–ç¨‹è¯­è¨€ Bï¼Œå°±å¯ä»¥è·³è¿‡ parsing é˜¶æ®µï¼š&lt;strong&gt;Have B programmers write ASTs directly in PL A&lt;/strong&gt;&lt;/p&gt;

&lt;h1&gt;ML from a Racket perspective&lt;/h1&gt;

&lt;p&gt;ML is like a well-defined subset of Racket&lt;/p&gt;

&lt;h1&gt;Racket from an ML Perspective&lt;/h1&gt;

&lt;p&gt;One way to describe Racket is that &lt;strong&gt;it has â€œone big datatypeâ€&lt;/strong&gt;ï¼šall values have this type.&lt;/p&gt;

&lt;p&gt;æˆ‘çš„ç†è§£ç”±äº Racket æ˜¯ dynamic typingï¼Œæ‰€ä»¥ ML ç¨‹åºå‘˜çœ‹æ¥ Racket åªæœ‰ä¸€ä¸ªç±»å‹ï¼ˆè¿™æ · static type check éƒ½èƒ½æˆåŠŸï¼‰&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Constructors are applied implicitly (&lt;strong&gt;values are tagged&lt;/strong&gt;)&lt;/p&gt;

&lt;p&gt;42 is really like Int 42&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Primitives implicitly check tags and extract data, raising errors for wrong constructors&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;fun car v = case v of Pair(a,b) =&amp;gt; a | _ =&amp;gt; raise â€¦

fun pair? v = case v of Pair _ =&amp;gt; true | _ =&amp;gt; false
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1&gt;Weak Typing&lt;/h1&gt;

&lt;p&gt;There exist programs that, by definition, must pass static checking but then when run can &amp;quot;set the computer on fire&amp;quot;?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Ease of language implementation: Checks left to the programmer&lt;/li&gt;
&lt;li&gt;Performance: Dynamic checks take time&lt;/li&gt;
&lt;li&gt;Lower level: Compiler does not insert information like array sizes, so it cannot do the checks&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Racket is not weakly typed&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;It just checks most things dynamically*&lt;/li&gt;
&lt;li&gt;Dynamic checking is the definition â€“ if the implementation can analyze the code to ensure some checks are not needed, then it can optimize them away&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Mon, 02 Apr 2018 19:10:35 +0800</pubDate>
        <link>http://masutangu.com/2018/04/programing-language-b/</link>
        <guid isPermaLink="true">http://masutangu.com/2018/04/programing-language-b/</guid>
        
        
        <category>è¯»ä¹¦ç¬”è®°</category>
        
      </item>
    
      <item>
        <title>The Part-Time Parliament è®ºæ–‡ç¬”è®°</title>
        <description>&lt;h1&gt;èƒŒæ™¯&lt;/h1&gt;

&lt;p&gt;Paxos å²›å…¼èŒè®®ä¼šç±»ä¼¼å®¹é”™å¼åˆ†å¸ƒå¼ç³»ç»Ÿé¢å¯¹çš„é—®é¢˜ï¼š&lt;strong&gt;è®®å‘˜å¯¹åº”åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è¿›ç¨‹ï¼Œè®®å‘˜ç¼ºå¸­å¯¹åº”è¿›ç¨‹æŒ‚æ‰ã€‚Paxos è®¾è®¡çš„è®®ä¼šåè®®åœ¨è®®å‘˜ç»å¸¸ç¼ºå¸­çš„æƒ…å†µä¸‹å¯ä»¥ä¿è¯æ³•ä»¤çš„ä¸€è‡´æ€§ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h1&gt;The Single-Decree Synod&lt;/h1&gt;

&lt;p&gt;å•ä¸€æ³•ä»¤çš„ç¥ä¼šåè®®çš„æ¼”åŒ–å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é¦–å…ˆç”±å‡ ä¸ª&lt;strong&gt;èƒ½ä¿è¯ä¸€è‡´æ€§å’Œå…è®¸è¿›å±•æ€§çš„çº¦æŸ&lt;/strong&gt;æ¨å¯¼å‡º&lt;strong&gt;åˆçº§åè®®ï¼ˆpreliminary protocol)&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;preliminary protocol&lt;/strong&gt;çš„çº¦æŸç‰ˆæœ¬å¾—åˆ°&lt;strong&gt;åŸºæœ¬åè®®ï¼ˆbasic protocolï¼‰&lt;/strong&gt;ï¼Œå…¶æ»¡è¶³ä¸€è‡´æ€§ä½†ä¸ä¿è¯è¿›å±•æ€§&lt;/li&gt;
&lt;li&gt;è¿›ä¸€æ­¥çº¦æŸ&lt;strong&gt;basic protocol&lt;/strong&gt;å¾—åˆ°å®Œæ•´çš„ç¥ä¼šåè®®ï¼Œæ—¢æ»¡è¶³ä¸€è‡´æ€§åˆä¿è¯è¿›å±•æ€§&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¥ä¸‹æ¥å››å°èŠ‚å…ˆè®²è§£ä¿è¯ä¸€è‡´æ€§çš„çº¦æŸï¼Œå†ä¾æ¬¡å¾—å‡º preliminary protocolã€basic protocol å’Œå®Œæ•´çš„ç¥ä¼šåè®®ã€‚&lt;/p&gt;

&lt;h2&gt;ä¸€è‡´æ€§çš„çº¦æŸæ¡ä»¶&lt;/h2&gt;

&lt;p&gt;ç¥ä¼šæ³•ä»¤é€šè¿‡å¤šè½®å¸¦ç¼–å·çš„&lt;strong&gt;è¡¨å†³ï¼ˆballotï¼‰&lt;/strong&gt;é€‰å‡ºã€‚æ¯ä¸€è½® ballot æ˜¯å¯¹å•ä¸€æ³•ä»¤çš„æŠ•ç¥¨ã€‚æ¯è½® ballot ç‰§å¸ˆåªèƒ½é€‰æ‹©æŠ•ç¥¨ï¼ˆè¡¨ç¤ºèµæˆï¼‰æˆ–ä¸æŠ•ç¥¨ï¼ˆè¡¨ç¤ºä¸èµæˆï¼‰ã€‚æ¯è½® ballot éƒ½å…³è”ä¸€ä¸ª&lt;strong&gt;æ³•å®šäººæ•°é›†ï¼ˆquorumï¼‰&lt;/strong&gt;çš„ç‰§å¸ˆé›†åˆã€‚åªæœ‰å½“ quorum ä¸­çš„æ¯ä¸€ä½ç‰§å¸ˆéƒ½æŠ•ç¥¨ï¼Œè¿™è½® ballot æ‰ç®—æˆåŠŸã€‚ä¸€è½® ballot B åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªå…ƒç´ ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;B(dec): è¢«æŠ•ç¥¨çš„æ³•ä»¤&lt;/li&gt;
&lt;li&gt;B(qrm): è¯¥è½® ballot çš„ quorum&lt;/li&gt;
&lt;li&gt;B(vot): æŠ•ç¥¨çš„ç‰§å¸ˆé›†åˆ&lt;/li&gt;
&lt;li&gt;B(bal): ballot çš„ç¼–å·&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å½“ä¸”ä»…å½“ B(qrm) âŠ† B(vot) æ—¶ï¼Œè¿™è½® ballot æ‰ç®—æˆåŠŸã€‚&lt;strong&gt;B(bal) å€¼çš„å¤§å°å’Œè¿›è¡Œ ballot çš„é¡ºåºæ— å…³ï¼ŒB(bal) æ¯”è¾ƒå¤§çš„ ballot æœ‰å¯èƒ½åœ¨ B(bal) æ¯”è¾ƒå°çš„ ballot ä¹‹å‰å‘ç”Ÿã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Paxos æ•°å­¦å®¶åœ¨ç”±å¤šè½® ballot ç»„æˆçš„é›†åˆ ğœ· ä¸Šå®šä¹‰äº†ä¸‰ä¸ªçº¦æŸæ¡ä»¶ï¼Œå¦‚æœé›†åˆä¸­çš„ ballot éƒ½æ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œåˆ™å¯ä»¥ä¿è¯ä¸€è‡´æ€§ä¼šï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;B1(ğœ·): ğœ· ä¸­çš„æ¯ä¸€è½® ballot éƒ½æ‹¥æœ‰å”¯ä¸€çš„ç¼–å·&lt;/li&gt;
&lt;li&gt;B2(ğœ·): ğœ· ä¸­ä»»æ„ä¸¤è½® ballot çš„ quorum è‡³å°‘æœ‰ä¸€ä¸ªå…¬å…±æˆå‘˜&lt;/li&gt;
&lt;li&gt;B3(ğœ·): ğœ· ä¸­ä»»æ„ä¸€è½® ballot Bï¼Œå¦‚æœ B(qrm) ä¸­ä»»ä½•ä¸€ä¸ªç‰§å¸ˆåœ¨ ğœ· ä¸­æ›´æ—©çš„ ballot ä¸­æŠ•è¿‡ç¥¨ï¼Œåˆ™ B(dec) ä¸æ‰€æœ‰æ›´æ—©çš„ ballots ä¸­æœ€åé‚£è½® ballot çš„æ³•ä»¤ç›¸åŒ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹å›¾æ˜¯å¯¹ B3(ğœ·) çš„å›¾è§£ã€‚äº”è½® ballot ç»„æˆé›†åˆ ğœ·ï¼ŒAã€Bã€Î“ã€âˆ† å’Œ E è¡¨ç¤ºäº”ä½ç‰§å¸ˆï¼Œæ–¹æ¡†åœˆèµ·çš„è¡¨ç¤ºæŠ•ç¥¨çš„ç‰§å¸ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/the-part-time-parliament-note/illustration-1.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç¼–å· 2 æ˜¯æœ€æ—©çš„ä¸€è½® ballotï¼Œå› æ­¤æ˜¾è€Œæ˜“è§ä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼ˆæ²¡æœ‰æ¯”ä»–æ›´æ—©çš„ ballotäº†ï¼‰&lt;/li&gt;
&lt;li&gt;ç¼–å· 5 çš„ ballotï¼Œå››ä½ quorum éƒ½æ²¡æœ‰åœ¨æ›´æ—©çš„ ballot ä¸­æŠ•è¿‡ç¥¨ï¼Œå› æ­¤ä¸‰ä¸ªæ¡ä»¶ä¹Ÿæ»¡è¶³&lt;/li&gt;
&lt;li&gt;ç¼–å· 14 çš„ ballot ä¸­ï¼Œâˆ† æ˜¯ quorum ä¸­å”¯ä¸€ä¸€ä½åœ¨æ›´æ—©çš„ ballot ä¸­æŠ•è¿‡ç¥¨çš„ï¼Œå› æ­¤è¿™ä¸€è½®çš„æ³•ä»¤å¿…é¡»å’Œç¼–å·ä¸º 2 çš„ ballot ä¸€è‡´ï¼Œéƒ½ä¸º ğœ¶&lt;/li&gt;
&lt;li&gt;ç¼–å· 27 æ˜¯ä¸€è½®æˆåŠŸçš„ ballotï¼ŒAã€Î“ å’Œ âˆ† ä¸ºè¯¥è½®çš„ quorum æˆå‘˜ã€‚Î“ åœ¨ç¼–å· 5 çš„ ballot ä¸­æŠ•è¿‡ç¥¨ï¼Œâˆ† åœ¨ç¼–å·ä¸º 2 çš„ ballot ä¸­æŠ•è¿‡ç¥¨ï¼Œæ ¹æ® B3(ğœ·)ï¼Œè¿™ä¸€è½®çš„æ³•ä»¤å¿…é¡»å’Œç¼–å· 5 çš„æ³•ä»¤ä¸€è‡´ï¼ˆç¼–å· 5 æ¯”ç¼–å· 2 æ›´æ–°ï¼‰&lt;/li&gt;
&lt;li&gt;ç¼–å· 29 çš„ quorum æˆå‘˜ä¸º Bã€Î“ å’Œ âˆ†ã€‚B åœ¨ç¼–å· 14 çš„ ballot æŠ•è¿‡ç¥¨ï¼ŒÎ“ åœ¨ç¼–å· 5 å’Œ 27 çš„ ballots éƒ½æŠ•è¿‡ç¥¨ï¼Œâˆ† åœ¨ç¼–å·ä¸º 2 å’Œ 27 çš„ballots ä¹ŸæŠ•è¿‡ç¥¨ï¼Œè¿™äº› ballots ä¸­æœ€æ–°çš„ç¼–å·ä¸º 27ï¼Œå› æ­¤è¿™è½® ballot çš„æ³•ä»¤å¿…é¡»å’Œç¼–å· 27 çš„æ³•ä»¤ä¸€è‡´&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹é¢ç»™å‡º B1(ğœ·) B2(ğœ·) B3(ğœ·) çš„æ•°å­¦å®šä¹‰ï¼š&lt;/p&gt;

&lt;p&gt;ç¬¦å· v è¡¨ç¤ºä¸€æ¬¡æŠ•ç¥¨ï¼Œå…¶ä¸­ v(pst) è¡¨ç¤ºæŠ•ç¥¨çš„ç‰§å¸ˆï¼Œv(bal) è¡¨ç¤ºæŠ•ç¥¨çš„ç¼–å·ï¼Œv(dec) è¡¨ç¤ºæŠ•ç¥¨çš„æ³•ä»¤ã€‚é›†åˆ Votes(ğœ·) è¡¨ç¤ºæ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æŠ•ç¥¨ v çš„é›†åˆï¼šv(pst) âˆˆ B(vot)ï¼Œv(bal) = B(bal)ï¼Œv(dec) = B(dec)ï¼ŒB âˆˆ ğœ·ã€‚å®šä¹‰ p ä¸ºç‰§å¸ˆï¼Œb ä¸º ballot ç¼–å·ï¼Œåˆ™ MaxVote(b, p, ğœ·) è¡¨ç¤ºé›†åˆ &lt;strong&gt;{ v âˆˆ Votes(B): (v(pst) = p) âˆ§ (v(bal) &amp;lt; b) } âˆª { null(p) }&lt;/strong&gt; ä¸­ ballot æœ€å¤§çš„æŠ•ç¥¨ã€‚&lt;em&gt;æ³¨ï¼šnull(p) è¡¨ç¤º null æŠ•ç¥¨ï¼Œå³ v(bal) ä¸º-âˆ, v(dec) ä¸º BLANK ä¸” v(pst) = p&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;å¯¹ä»»æ„éç©ºçš„ç‰§å¸ˆé›†åˆ Qï¼ŒMaxVote(b, Q, ğœ·) å®šä¹‰ä¸º Q ä¸­çš„æ‰€æœ‰ç‰§å¸ˆ p çš„ MaxVote(b, p, ğœ·) çš„æœ€å¤§å€¼ã€‚&lt;em&gt;æ³¨ï¼šç¿»è¯‘å¾—ä¸å¤ªå¦¥å½“ï¼ŒåŸæ–‡ï¼šFor any nonempty set Q of priests, MaxVote(b, Q, B) was defined to equal the maximum of all votes MaxVote(b, p, B) with p in Q.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;B1(ğœ·) B2(ğœ·) B3(ğœ·) çš„æ•°å­¦å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;B1(ğœ·) â‰œ âˆ€B, B&amp;#39; âˆˆ ğœ· : (B â‰  B&amp;#39;) â‡’ (B(bal) â‰  B&amp;#39;(bal))&lt;/li&gt;
&lt;li&gt;B2(ğœ·) â‰œ âˆ€B, B&amp;#39; âˆˆ ğœ· : B(qrm) âˆ© B&amp;#39;(qrm) â‰  âˆ…&lt;/li&gt;
&lt;li&gt;B3(ğœ·) â‰œ âˆ€B âˆˆ ğœ· : (MaxVote(B(bal) , B(qrm), ğœ·)bal â‰  âˆ’âˆ) â‡’ (B(dec) = MaxVote(B(bal) , B(qrm) , ğœ·)dec)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;å¼•ç†ï¼šå¦‚æœæ»¡è¶³ B1(ğœ·) B2(ğœ·) B3(ğœ·)ï¼Œåˆ™ ((B(qrm) âŠ† B(vot)) âˆ§ (B&amp;#39;(bal) &amp;gt; B(bal))) â‡’ (B(dec) = B&amp;#39;(dec))&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¼•ç†è¯æ˜å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;å¯¹ ğœ· ä¸­ä»»æ„ ballot Bï¼Œå®šä¹‰ Î¨(B, ğœ·) è¡¨ç¤º ğœ· ä¸­æ‰€æœ‰ç¼–å·å¤§äº B(bal) ä¸”æ³•ä»¤ä¸ç­‰äº B(dec) çš„ ballot çš„é›†åˆï¼š&lt;strong&gt;Î¨(B, ğœ·) â‰œ {B&amp;#39; âˆˆ ğœ· : (B&amp;#39;(bal) &amp;gt; B(bal) âˆ§ (B&amp;#39;(dec) â‰  B(dec))}&lt;/strong&gt;ã€‚å¦‚æœè¯æ˜ B(qrm) âŠ† B(vot) åˆ™ Î¨(B, ğœ·) ä¸ºç©ºï¼Œå¼•ç†å³æˆç«‹ã€‚ä¸‹é¢æ˜¯åè¯æ³•ï¼Œå‡è®¾å­˜åœ¨ B æ»¡è¶³ B(qrm) âŠ† B(vot) ä¸” Î¨(B, ğœ·) ä¸ä¸ºç©ºï¼Œä¸‹é¢æ¨å¯¼å¾—å‡ºçŸ›ç›¾çš„ç»“è®ºï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;é€‰æ‹© C âˆˆ Î¨(B, B) æ»¡è¶³ C(bal) = min{ B&amp;#39;(bal) : B&amp;#39; âˆˆ Î¨(B, ğœ·)}&lt;/li&gt;
&lt;li&gt;C(bal) &amp;gt; B(bal)ï¼šç”± 1 å’Œ Î¨(B, ğœ·) çš„å®šä¹‰å¾—å‡º&lt;/li&gt;
&lt;li&gt;B(vot) âˆ© C(qrm) â‰  âˆ…ï¼šç”± B2(ğœ·) å’Œ B(qrm) âŠ† B(vot) å¾—å‡º&lt;/li&gt;
&lt;li&gt;MaxVote(C(bal), C(qrm), ğœ·)bal â‰¥ B(bal)ï¼šç”± 2ã€3 å’Œ MaxVote çš„å®šä¹‰å¾—å‡º&lt;/li&gt;
&lt;li&gt;MaxVote(C(bal), C(qrm), ğœ·) âˆˆ Votes(B)ï¼šç”± 4 çŸ¥é“ MaxVote(C(bal), C(qrm) , ğœ·) ä¸æ˜¯ null æŠ•ç¥¨&lt;/li&gt;
&lt;li&gt;MaxVote(C(bal), C(qrm), ğœ·)dec = C(dec)ï¼šç”± 5 å’Œ B3(ğœ·) å¾—å‡º&lt;/li&gt;
&lt;li&gt;MaxVote(C(bal), C(qrm), ğœ·)dec â‰  B(dec)ï¼šç”± 6ã€1 å’Œ Î¨(B, ğœ·) çš„å®šä¹‰å¾—å‡º&lt;/li&gt;
&lt;li&gt;MaxVote(C(bal), C(qrm), ğœ·)bal &amp;gt; B(bal)ï¼šç”± 4 7 å’Œ B1(ğœ·) çš„å‡º&lt;/li&gt;
&lt;li&gt;MaxVote(C(bal), C(qrm), ğœ·) âˆˆ Votes(Î¨(B, ğœ·))ï¼šç”± 7 8 å’Œ Î¨(B, ğœ·) çš„å®šä¹‰å¾—å‡º&lt;/li&gt;
&lt;li&gt;MaxVote(C(bal), C(qrm), ğœ·)bal &amp;lt; C(bal)ï¼šç”± MaxVote(C(bal), C(qrm), ğœ·) çš„å®šä¹‰å¾—å‡º&lt;/li&gt;
&lt;li&gt;ç”± 9 10 1 å¾—å‡ºçŸ›ç›¾ï¼Œå› ä¸º 1 ä¸­å®šä¹‰äº† C(bal) æ˜¯ Î¨(B, ğœ·) ä¸­ç¼–å·æœ€å°çš„ï¼Œç”± 9 çŸ¥é“ MaxVote(C(bal), C(qrm), ğœ·) å±äº Votes(Î¨(B, ğœ·))ï¼Œé‚£ä¹ˆ MaxVote(C(bal), C(qrm), ğœ·) å¿…é¡»å¤§äºç­‰äº C(bal)ï¼Œè¿™ä¸ 10 å¾—åˆ°çš„ MaxVote(C(bal), C(qrm), ğœ·)bal &amp;lt; C(bal) çŸ›ç›¾&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç”±å¼•ç†å¾—å‡ºï¼Œå¦‚æœæ»¡è¶³ B1(ğœ·) B2(ğœ·) B3(ğœ·)ï¼Œåˆ™ä»»æ„ä¸¤è½®æˆåŠŸçš„ ballots éƒ½æ˜¯ç›¸åŒçš„æ³•ä»¤ï¼Œæ•°å­¦è¡¨ç¤ºï¼š&lt;strong&gt;((B(qrm) âŠ† B(vot)) âˆ§ (B&amp;#39;(qrm) âŠ† B&amp;#39;(vot))) â‡’ (B&amp;#39;dec = Bdec)&lt;/strong&gt;&lt;/p&gt;

&lt;h2&gt;The Preliminary Protocol&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†éµå®ˆ B3(ğœ·)ï¼Œç‰§å¸ˆåœ¨å‘èµ·è¡¨å†³å‰éœ€è¦å…ˆç¡®å®š MaxVote(b, Q, ğœ·)decï¼Œå› æ­¤éœ€è¦ç¡®å®š Q ä¸­çš„æ¯ä¸€ä¸ª p çš„ MaxVote(b, q, ğœ·)decã€‚Preliminary protocol çš„å‰ä¸¤æ­¥å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;(1) ç‰§å¸ˆ p é€‰æ‹©æ–°çš„ ballot number bï¼Œå‘é€ä¸€æ¡ NextBallot(b) æ¶ˆæ¯ç»™æŸäº›ç‰§å¸ˆ&lt;/p&gt;

&lt;p&gt;(2) ç‰§å¸ˆ q æ”¶åˆ° NextBallot(b) æ¶ˆæ¯åï¼Œå‘é€ LastVote(b, v) æ¶ˆæ¯ç»™ pï¼Œv ä¸º MaxVote(b, q, ğœ·)&lt;/p&gt;

&lt;p&gt;å‘é€å®Œ LastVote(b, v)ï¼Œ&lt;strong&gt;q æ‰¿è¯ºä¸å†ç»™ç¼–å·åœ¨ [v(bal), b] åŒºé—´çš„è¡¨å†³æŠ•ç¥¨ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;æ³¨ï¼šè¿™ä¸ªæ‰¿è¯ºæ˜¯ä¸ºäº†è§£å†³ä¹±åºçš„é—®é¢˜ï¼Œ ballot ç¼–å·å¤§çš„æŠ•ç¥¨å‘ç”Ÿåœ¨ç¼–å·å°çš„ä¹‹å‰æ—¶ï¼Œå¦‚ä¸‹å›¾ï¼ŒB å’Œ C æŠ•ç¥¨çš„æ³•ä»¤å‡ºç°äº†ä¸ä¸€è‡´ï¼»å‚è€ƒè‡ª&lt;a href=&quot;https://zhuanlan.zhihu.com/p/21438357&quot;&gt;Paxosç†è®ºä»‹ç»(1): æœ´ç´ Paxosç®—æ³•ç†è®ºæ¨å¯¼ä¸è¯æ˜&lt;/a&gt;ï¼½ï¼š&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/the-part-time-parliament-note/illustration-2.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹æ¥ä¸¤ä¸ªæ­¥éª¤æ˜¯ï¼š&lt;/p&gt;

&lt;p&gt;(3) åœ¨æ”¶åˆ° majority çš„ LastVote(b, v) ä¹‹åï¼Œp å‘èµ·ä¸€è½®ç¼–å·ä¸º bï¼Œquorum ä¸º Q ä¸”æ³•ä»¤ä¸º dï¼ˆd éœ€è¦æ»¡è¶³B3(ğœ·)ï¼‰çš„è¡¨å†³ï¼Œç»™ Q ä¸­æ¯ä¸€ä¸ªç‰§å¸ˆå‘é€ BeginBallot(b, d) æ¶ˆæ¯&lt;/p&gt;

&lt;p&gt;(4) åœ¨æ”¶åˆ° BeginBallot(b, d) æ¶ˆæ¯åï¼Œq å†³å®šæ˜¯å¦æŠ•ç¥¨ï¼Œå¦‚æœå¯ä»¥æŠ•ç¥¨ï¼ˆä¸è¿èƒŒä¸Šé¢çš„æ‰¿è¯ºï¼‰ï¼Œåˆ™å‘é€ Voted(b, q) æ¶ˆæ¯ç»™ p&lt;/p&gt;

&lt;p&gt;æ­¥éª¤ 3 å°†è¡¨å†³ B åŠ å…¥åˆ°é›†åˆ ğœ· ä¸­ï¼Œå…¶ä¸­ B(bal) = bï¼ŒB(qrm) = Qï¼ŒB(vot) = âˆ…ã€‚æ­¥éª¤ 4 ä¸­ï¼Œå¦‚æœç‰§å¸ˆ q æŠ•ç¥¨äº†ï¼Œåˆ™å°† q åŠ å…¥ B(vot) ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;åè®®çš„å‰©ä½™æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;(5) å¦‚æœ p æ”¶åˆ°äº† Q ä¸­æ¯ä¸€ä¸ª q çš„ Voted(b, q) æ¶ˆæ¯ï¼Œé‚£ä¹ˆ p åœ¨å¾‹ç°¿ä¸Šè®°å½•ä¸‹æ³•ä»¤ dï¼Œå¹¶ä¸”å‘é€ Success(d) ç»™æ¯ä¸€ä¸ªç‰§å¸ˆ&lt;/p&gt;

&lt;p&gt;(6) ç‰§å¸ˆ q æ”¶åˆ° Success(d) æ¶ˆæ¯åï¼Œå°†æ³•ä»¤ d è®°å½•åœ¨è‡ªå·±çš„å¾‹ç°¿ä¸Š&lt;/p&gt;

&lt;h2&gt;The Basic Protocol&lt;/h2&gt;

&lt;p&gt;åœ¨ preliminary protocol ä¸­ï¼Œæ¯ä¸€ä¸ªç‰§å¸ˆéƒ½å¿…é¡»è®°å½• &lt;strong&gt;(i) ä»–å‘èµ·çš„æ¯ä¸€ä¸ªballot number (ii) ä»–æŠ•è¿‡çš„æ¯ä¸€æ¬¡ç¥¨ (iii) ä»–å‘é€è¿‡çš„æ¯ä¸€ä¸ª LastVote æ¶ˆæ¯&lt;/strong&gt;ã€‚è¦è®°å½•è¿™ä¹ˆå¤šä¿¡æ¯æ˜¯éå¸¸å›°éš¾çš„ï¼Œå› æ­¤ Paxos äººå¯¹ preliminary protocol åšäº†è¿›ä¸€æ­¥çº¦æŸï¼Œå¾—åˆ°æ›´å®ç”¨çš„ basic protocolï¼Œæ¯ä¸ªç‰§å¸ˆåªéœ€è¦åœ¨å¾‹ç°¿ä¸Šè®°å½•ä¸‹é¢ä¸‰ä¸ªä¿¡æ¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;lastTried[p]&lt;/strong&gt;ï¼šp å‘èµ·çš„æœ€åä¸€ä¸ªè¡¨å†³çš„ç¼–å·&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;prevVote[p]&lt;/strong&gt;ï¼šp æŠ•è¿‡çš„æ‰€æœ‰è¡¨å†³ä¸­ç¼–å·æœ€å¤§çš„é‚£æ¬¡æŠ•ç¥¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;nextBal[p]&lt;/strong&gt;ï¼šp å‘è¿‡çš„æ‰€æœ‰ LastVote(b, v) æ¶ˆæ¯ä¸­ b çš„æœ€å¤§å€¼&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Preliminary protocol å…è®¸ç‰§å¸ˆå¹¶è¡Œç®¡ç†ä»»æ„æ•°é‡çš„è¡¨å†³ï¼Œbasic protocol ä¸­ç‰§å¸ˆåœ¨ä¸€ä¸ªæ—¶é—´å†…åªç®¡ç†ä¸€ä¸ªè¡¨å†³ï¼Œç¼–å·ä¸º lastTried[p]ï¼Œå¿½ç•¥å’Œä¹‹å‰å‘èµ·çš„è¡¨å†³ç›¸å…³çš„æ¶ˆæ¯ã€‚Basic protocol ä¸­å¯¹ LastVote åšäº†æ›´å¼ºçš„æ‰¿è¯ºï¼š&lt;strong&gt;ä¸å†å¯¹ç¼–å·å°äº b çš„è¡¨å†³è¿›è¡ŒæŠ•ç¥¨ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Basic protocol æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;(1) ç‰§å¸ˆ p é€‰æ‹©æ–°çš„ ballot number bï¼Œå¿…é¡»å¤§äº lastTried[p]ï¼Œå¹¶æ›´æ–° lastTried[p] ç½®ä¸º bï¼Œç„¶åå‘é€ NextBallot(b) æ¶ˆæ¯ç»™æŸäº›ç‰§å¸ˆ&lt;/p&gt;

&lt;p&gt;(2) ç‰§å¸ˆ q æ”¶åˆ° NextBallot(b) æ¶ˆæ¯ï¼Œå¦‚æœ b å¤§äº nextBal(q)ï¼Œåˆ™æ›´æ–° nextBal(q) ç½®ä¸º b å¹¶å‘é€ LastVote(b, v) æ¶ˆæ¯ç»™ pï¼Œv å³ prevVote[q]ã€‚å¦‚æœ b å°äºç­‰äº nextBal(q) åˆ™å¿½ç•¥è¯¥ NextBallot æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;p&gt;(3) åœ¨æ”¶åˆ° majority çš„ LastVote(b, v) æ¶ˆæ¯åï¼Œå¦‚æœ b ç­‰äº lastTried[p]ï¼Œåˆ™ p å‘èµ·ä¸€è½®æ–°çš„è¡¨å†³ï¼ŒæŒ‡å®šç¼–å·ä¸º bï¼Œquorum ä¸º Qï¼Œæ³•ä»¤ä¸º dï¼Œd éœ€è¦æ»¡è¶³ B3(ğœ·)ã€‚p å‘é€ BeginBallot(b, d) æ¶ˆæ¯ç»™ Q ä¸­æ‰€æœ‰ç‰§å¸ˆã€‚&lt;/p&gt;

&lt;p&gt;(4) åœ¨æ”¶åˆ° BeginBallot(b, d) æ¶ˆæ¯åï¼Œå¦‚æœ b ç­‰äº nextBal[q]ï¼Œç‰§å¸ˆ q æŠ•ç¥¨ï¼Œå¹¶å°† prevVote[q] è®¾ç½®ä¸ºæœ¬æ¬¡æŠ•ç¥¨ï¼Œç„¶åå‘é€ Voted(b, q) æ¶ˆæ¯ç»™ pã€‚å¦‚æœ b ä¸ç­‰äº nextBal[q]ï¼Œåˆ™å¿½ç•¥è¯¥ BeginBallot æ¶ˆæ¯&lt;/p&gt;

&lt;p&gt;(5) å¦‚æœ p æ”¶åˆ° Q ä¸­æ‰€æœ‰ç‰§å¸ˆçš„ Voted(b, q) æ¶ˆæ¯ï¼Œå¹¶ä¸” b ç­‰äº lastTried[p]ï¼Œä»–åœ¨å¾‹ç°¿ä¸Šè®°å½•ä¸‹æ³•ä»¤ dï¼Œå¹¶å‘é€ Success(d) æ¶ˆæ¯ç»™æ‰€æœ‰çš„ç‰§å¸ˆã€‚&lt;/p&gt;

&lt;p&gt;(6) åœ¨æ”¶åˆ° Success(d) æ¶ˆæ¯åï¼Œç‰§å¸ˆåœ¨å¾‹ç°¿ä¸Šè®°å½•ä¸‹æ³•ä»¤ d&lt;/p&gt;

&lt;p&gt;Basic protocol æ˜¯ preliminary protocol çš„çº¦æŸç‰ˆæœ¬ï¼Œpreliminary protocol æ»¡è¶³ä¸€è‡´æ€§çš„æ¡ä»¶ï¼Œé‚£ä¹ˆ basic protocol ä¹Ÿä¸€å®šæ»¡è¶³ã€‚ä¸è¿‡å’Œ preliminary protocol ä¸€æ ·ï¼Œbasic protocol ä¹Ÿæ²¡è¦æ±‚å¿…é¡»æ‰§è¡ŒæŸä¸ªæ“ä½œï¼Œå› æ­¤åŒæ ·æ²¡æœ‰è§£å†³è¿›å±•æ€§çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;h2&gt;The Complete Synod Protocol&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†ä¿è¯è¿›å±•æ€§ï¼Œ&lt;strong&gt;å…³é”®åœ¨äºå†³å®šç‰§å¸ˆä»€ä¹ˆæ—¶å€™åº”è¯¥å‘èµ·è¡¨å†³&lt;/strong&gt;ã€‚æ°¸è¿œä¸å‘èµ·è¡¨å†³å’Œå¤ªé¢‘ç¹çš„å‘èµ·è¡¨å†³éƒ½ä¼šå½±å“è¿›å±•æ€§ã€‚å®Œæ•´çš„ç¥ä¼šåè®®åœ¨ basic protocol çš„åŸºç¡€ä¸Šæ–°å¢ä¸€ä¸ªæµç¨‹æ¥é€‰æ‹©å”¯ä¸€çš„ç‰§å¸ˆ--æ€»ç»Ÿï¼Œæ¥å‘èµ·è¡¨å†³ã€‚è¿™éƒ¨åˆ†ç»†èŠ‚å‚ç…§è®ºæ–‡çš„ 2.4 èŠ‚ã€‚&lt;/p&gt;

&lt;h1&gt;The Multi-Decree Parliament&lt;/h1&gt;

&lt;h2&gt;The Protocol&lt;/h2&gt;

&lt;p&gt;Paxos è®®ä¼šéœ€è¦é€šè¿‡ä¸€ç³»åˆ—æ³•ä»¤è€Œä¸ä»…ä»…å•ä¸€ä¸€ä¸ªæ³•ä»¤ã€‚æ³•ä»¤æè®®ç»™æ€»ç»Ÿï¼Œç”±æ€»ç»Ÿèµ‹äºˆ ballot number å¹¶å°è¯•é€šè¿‡å®ƒã€‚åè®®å¯¹æ¯ä¸ªæ³•ä»¤ä½¿ç”¨ä¸åŒå®ä¾‹çš„ Complete Synod Protocolï¼Œä½†è¿™ç³»åˆ—å®ä¾‹åªéœ€è¦ä¸€ä½æ€»ç»Ÿæ¥è´Ÿè´£ï¼Œå¹¶ä¸”ç¥ä¼šåè®®çš„å‰ä¸¤æ­¥åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç¥ä¼šåè®®ä¸­ï¼Œæ€»ç»Ÿåœ¨ç¬¬ä¸‰æ­¥ä¹‹å‰ä¸ä¼šé€‰æ‹©æ³•ä»¤å’Œ quorumï¼Œå› æ­¤æ€»ç»Ÿå¯ä»¥ä¸ºæ‰€æœ‰å®ä¾‹å‘é€ä¸€æ¡ NextBallot(b) æ¶ˆæ¯ï¼Œè®®å‘˜å›å¤ä¸€æ¡ LastVote æ¶ˆæ¯ï¼Œè§„åˆ™å’Œå•ä¸€æ³•ä»¤çš„åè®®ç›¸åŒï¼Œåªæ˜¯æŠŠæ‰€æœ‰å¾…è¡¨å†³çš„å®ä¾‹ä¿¡æ¯åŒ…å«åœ¨ä¸€æ¡ LastVote ä¿¡æ¯é‡Œã€‚&lt;/p&gt;

&lt;p&gt;å½“æ€»ç»Ÿæ”¶åˆ° majority çš„å›å¤åï¼Œå°±ä¸ºæ¯ä¸ªå¾…è¡¨å†³çš„å®ä¾‹æ‰§è¡Œ Complete Synod Protocol çš„ç¬¬ä¸‰æ­¥ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ Paxon çš„è®®ä¼šåè®®å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å·²ç»çŸ¥é“ç»“æœçš„è¡¨å†³ä¸å†éœ€è¦å†èµ°ä¸€é Complete Synod Protocol çš„æµç¨‹ï¼Œå› æ­¤å½“æ–°é€‰ä¸¾çš„æ€»ç»Ÿ p åœ¨å¾‹ç°¿ä¸Šå·²ç»è®°å½•æœ‰ç¼–å·å°äºç­‰äº n çš„æ³•ä»¤ï¼Œé‚£ä»–å°†å‘é€ NextBallot(b, n) ä»£æ›¿ä¹‹å‰çš„ NextBallot(b) æ¶ˆæ¯ã€‚è®®å‘˜æ”¶åˆ° NextBallot æ¶ˆæ¯åï¼Œå°†ä»–å¾‹ç°¿ä¸Šæ‰€æœ‰ç¼–å·å¤§äº n çš„æ³•ä»¤è¿”å›ç»™ pï¼Œå¹¶ä¸”å‘Šè¯‰ p ä»–ç¼ºå¤±çš„ç¼–å·å°äºç­‰äº n çš„æ³•ä»¤ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Properties of the Protocol&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;åœ¨æ€»ç»Ÿæè®®ä»»ä½•æ³•ä»¤ä¹‹å‰ï¼Œå¿…é¡»å…ˆå‘ majority å­¦ä¹ ä»–ä»¬å·²ç»æŠ•è¿‡ç¥¨çš„æ³•ä»¤ã€‚&lt;/strong&gt;ä»»ä½•ä¸€ä¸ªå·²ç»é€šè¿‡çš„æ³•ä»¤ä¸€å®šè¢«è‡³å°‘ä¸€ä¸ªå¤šæ•°é›†åˆä¸­çš„è®®å‘˜æŠ•è¿‡ç¥¨ã€‚è¿™æ ·å°±ä¿è¯äº†æ€»ç»Ÿåœ¨æè®®æ–°æ³•ä»¤å‰å¾‹ç°¿ä¸Šä¸ä¼šæœ‰ç©ºç¼ºã€‚&lt;/p&gt;
</description>
        <pubDate>Wed, 21 Mar 2018 20:36:16 +0800</pubDate>
        <link>http://masutangu.com/2018/03/the-part-time-parliament-note/</link>
        <guid isPermaLink="true">http://masutangu.com/2018/03/the-part-time-parliament-note/</guid>
        
        
        <category>è¯»ä¹¦ç¬”è®°</category>
        
      </item>
    
      <item>
        <title>å¤šæ’è¡Œæ¦œæ•°æ®åˆ·æ–°æ–¹æ¡ˆ</title>
        <description>&lt;h2&gt;ä¸€. èƒŒæ™¯&lt;/h2&gt;

&lt;p&gt;æœ€è¿‘å·¥ä½œé‡åˆ°ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼š&lt;strong&gt;å¤šä¸ªä¸åŒçš„æ’è¡Œæ¦œçš„ç©å®¶ä¿¡æ¯å¦‚ä½•ä¿æŒä¸€è‡´&lt;/strong&gt;ã€‚ç®€å•æè¿°ä¸‹åœºæ™¯ï¼Œä»¥å°æ¸¸æˆè·³ä¸€è·³ä¸ºä¾‹å­ï¼Œä¸€å¼€å§‹æ¸¸æˆåªæœ‰ä¸€ä¸ªå¥½å‹æ’è¡Œæ¦œï¼Œå¥½å‹æ’è¡Œæ¦œä»¥ç©å®¶çš„æœ€é«˜åˆ†æ•°è¿›è¡Œæ’åºï¼Œè¿™æ ·å¥½å¤„ç†ï¼Œæ­ä¸€ä¸ªå…³ç³»é“¾svrï¼Œè¯¥ svr ä¸Šç¼“å­˜ç©å®¶å¥½å‹çš„ä¿¡æ¯ï¼ˆé¿å…æ¯æ¬¡å» DB æŸ¥è¯¢ï¼‰ï¼Œå¹¶ä½¿ç”¨ç©å®¶ä¿¡æ¯ä¸­çš„æœ€é«˜åˆ†æ•°è¿›è¡Œæ’åºã€‚å®¢æˆ·ç«¯è¯·æ±‚æ—¶ä¸‹æ–¹ç›¸åº”çš„æ’åå’Œç©å®¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ€é«˜åˆ†æ•°ä¿¡æ¯ï¼ˆå®¢æˆ·ç«¯éœ€è¦å±•ç¤ºï¼‰å³å¯ã€‚ä½†å¦‚æœæˆ‘ä»¬è¦æ–°å¢ä¸€ä¸ªå…¨å›½æ’è¡Œæ¦œï¼Œå…¨å›½æ’è¡Œæ¦œä»¥ç©å®¶çš„æœ€é«˜æ­¥æ•°ï¼‹è€—æ—¶è¿›è¡Œæ’è¡Œã€‚è¿™æ—¶éœ€è¦æ­ä¸€ä¸ªå…¨å›½æ’è¡Œæ¦œsvrï¼Œè¯¥svrä¸ŠåŒæ ·ç¼“å­˜è¿›å…¥å…¨å›½æ’è¡Œæ¦œçš„ç©å®¶çš„ä¿¡æ¯ï¼Œä½¿ç”¨ç©å®¶ä¿¡æ¯ä¸­çš„æœ€é«˜åˆ†æ•°ï¼‹è€—æ—¶è¿›è¡Œæ’åºã€‚åŒæ ·çš„åœ¨å®¢æˆ·ç«¯è¯·æ±‚æ—¶ä¸‹å‘ç›¸åº”çš„æ’åå’Œç©å®¶ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;æ–¹æ¡ˆä¸€ï¼šå„ä¸ªæ’è¡Œæ¦œæœ‰è‡ªå·±çš„ç©å®¶ç¼“å­˜ï¼š&lt;/em&gt;
&lt;img src=&quot;/assets/images/multi-rank-refresh-design/illustration-1.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;h2&gt;äºŒ. é—®é¢˜&lt;/h2&gt;

&lt;p&gt;ä½†é—®é¢˜æ¥äº†ï¼Œ&lt;strong&gt;å¦‚ä½•ä¿è¯å‡ºç°åœ¨ä¸¤ä¸ªæ¦œå•çš„åŒä¸€ç©å®¶æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Ÿ&lt;/strong&gt;ï¼ˆä¸ä¸€è‡´æ˜¯å› ä¸ºä¸¤ä¸ªæ’è¡Œ svr åˆ†åˆ«ç¼“å­˜äº†ç©å®¶çš„ä¿¡æ¯ï¼Œæ¯ä¸ªsvrçš„æ’è¡Œæ•°æ®ç¼“å­˜åˆ·æ–°å‘¨æœŸä¹Ÿä¸ä¸€è‡´ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„ data svr æ¥ç¼“å­˜ç©å®¶çš„ä¿¡æ¯ï¼Œ&lt;strong&gt;ä¿è¯ä¸åŒæ’è¡Œ svr å–åˆ°çš„ç©å®¶æ•°æ®æ˜¯ä¸€è‡´çš„ï¼ŒåŒæ—¶ä¸¤ä¸ªæ’è¡Œsvråˆ·æ–°ç¼“å­˜çš„å‘¨æœŸéœ€è¦ä¿æŒä¸€è‡´&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;æ–¹æ¡ˆäºŒï¼šæ¯ä¸ªæ’è¡Œæ¦œéƒ½ä»data svr æ‹‰å–ç©å®¶æ•°æ®ï¼š&lt;/em&gt;
&lt;img src=&quot;/assets/images/multi-rank-refresh-design/illustration-2.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;p&gt;æ•°æ®æºéƒ½ä» data svr æ‹‰å–è¿™ä¸ªå¾ˆç®€å•ï¼Œå…³é”®åœ¨äº&lt;strong&gt;å¦‚ä½•è®©ä¸åŒæ’è¡Œæ¦œçš„åˆ·æ–°å‘¨æœŸä¿æŒä¸€è‡´&lt;/strong&gt;ã€‚æœ¬æ–‡æå‡ºä¸€ä¸ªä¸æˆç†Ÿæœ‰å¾…è€ƒéªŒçš„æ–¹æ¡ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ç»™å‡ºç®€å•çš„åè®®ä¾‹å­è¯´æ˜ã€‚&lt;/p&gt;

&lt;h2&gt;ä¸‰. æ–¹æ¡ˆ&lt;/h2&gt;

&lt;h3&gt;1. åè®®&lt;/h3&gt;

&lt;p&gt;CSProto è¡¨ç¤ºä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„åè®®ï¼ŒSSProto è¡¨ç¤ºæœåŠ¡å™¨ä¹‹é—´çš„åè®®ã€‚Common ä¸ºå…¬ç”¨åè®®ã€‚å®šä¹‰æ’è¡Œæ¦œç›¸å…³åè®®å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;em&gt;å…¬ç”¨åè®®ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;package Common;

message PlayerInfo {
    int32 uid              = 1;  // ç©å®¶ uid
    int64 udpate_timestamp = 2;  // ç©å®¶ä¿¡æ¯çš„æ›´æ–°æ—¶é—´
    // ç©å®¶ä¿¡æ¯ åŒ…æ‹¬ä¾‹å¦‚æœ€é«˜åˆ† è€—æ—¶ å…·ä½“å­—æ®µç•¥è¿‡ç•¥
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åè®®ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;import &amp;quot;common.proto&amp;quot;;

package CSProto;

message RankReq {
    int32 rank_type = 1; // æ’è¡Œæ¦œç±»å‹ ä¾‹å¦‚å¥½å‹æ’è¡Œæ¦œ å…¨å›½æ’è¡Œæ¦œ
}

message RankInfo {
    Common.PlayerInfo info = 1; // ç©å®¶ä¿¡æ¯ å®¢æˆ·ç«¯å±•ç¤ºç”¨
    int32 rank_idx         = 2; // ç©å®¶æ’å
}

message RankRes {
    int32 rank_type             = 1; // æ’è¡Œæ¦œç±»å‹ ä¾‹å¦‚å¥½å‹æ’è¡Œæ¦œ å…¨å›½æ’è¡Œæ¦œ
    repeated RankInfo rank_list = 2; // æ’è¡Œæ•°æ®
    int64 update_timestamp      = 3; // æ’è¡Œæ¦œæ›´æ–°æ—¶é—´
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;æœåŠ¡å™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åè®®ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;package SSProto;

message GetPlayerInfoReq {
    repeated int32 uid_list = 1;
} 

message GetPlayerInfoRes {
    repeated Common.PlayerInfo info_list = 1;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;æ¶ˆæ¯æµå¦‚ä¸‹ï¼š&lt;/em&gt;
&lt;img src=&quot;/assets/images/multi-rank-refresh-design/illustration-3.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;h3&gt;2. ä¿è¯æ’è¡Œæ¦œ svr åˆ·æ–°å‘¨æœŸä¸€è‡´&lt;/h3&gt;

&lt;p&gt;æ’è¡Œæ¦œ svr ä» Data svr ä¸­æ‹‰å–ç©å®¶çš„ä¿¡æ¯è¿›è¡Œæ’åºï¼Œè€Œ Data svr ä¼šå®šæœŸå»æ›´æ–°ç©å®¶çš„ä¿¡æ¯ï¼Œå¯ä»¥æ¨å¯¼å‡ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ’è¡Œæ¦œçš„åˆ·æ–°æ—¶é—´ç­‰äºmax(æ’è¡Œæ¦œä¸Šæ¦œçš„ç©å®¶æ•°æ®çš„æ›´æ–°æ—¶é—´æˆ³)&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å› æ­¤å›åŒ…ç»™å®¢æˆ·ç«¯çš„ RankRes ä¸­çš„ update_timestamp å–å€¼çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;rank_res.update_timestamp =  max([rankinfo.info.udpate_timestamp for rankinfo in rank_res.rank_list])
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;å®¢æˆ·ç«¯ä½¿ç”¨ map æ¥ç®¡ç†æ¯ä¸ªæ’è¡Œæ¦œçš„æ›´æ–°æ—¶é—´ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;# rank_map
&amp;lt;ranktype1, udpate_timestamp1&amp;gt;
&amp;lt;ranktype2, update_timestamp2&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;å¹¶å®šä¹‰æ‰€æœ‰æ’è¡Œæ¦œçš„æœ€æ–°æ›´æ–°æ—¶é—´ rank_max_update_timestampï¼Œå–å€¼ä¼ªä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;rank_max_update_timestamp = max([update_timestamp for _, update_timestamp in rank_map]) 
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;å½“ç©å®¶ç‚¹å‡»æŸä¸ªæ’è¡Œæ¦œï¼Œå®¢æˆ·ç«¯å‘ç°è¯¥æ’è¡Œæ¦œçš„ update_timestamp å°äº rank_max_update_timestampï¼Œå°±èƒ½åˆ¤å®šè¯¥æ’è¡Œæ¦œä¸Šå­˜åœ¨è¿‡æ—¶çš„ç©å®¶æ•°æ®ï¼Œè¿™æ—¶å°±åº”è¯¥å‘åå°å‘èµ· RankReq è·å–æ’è¡Œæ¦œè¯·æ±‚ã€‚&lt;strong&gt;é€šè¿‡åŠæ—¶è¯·æ±‚è¿‡æ—¶æ’è¡Œæ¦œæ•°æ®ï¼Œä¿è¯æ¯ä¸ªæ’è¡Œæ¦œçš„ update_timestamp ä¸€è‡´ï¼Œå°±èƒ½ä¿è¯æ’è¡Œæ¦œä¸Šç©å®¶ä¿¡æ¯çš„ä¸€è‡´ï¼Œä¹Ÿå°±ä¿è¯äº†åœ¨å¤šä¸ªæ’è¡Œæ¦œä¸Šç©å®¶ä¿¡æ¯çš„ä¸€è‡´ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h3&gt;3. ä¼˜åŒ–&lt;/h3&gt;

&lt;p&gt;ä¸Šé¢æåˆ°ï¼Œæ¯æ¬¡ update_timestamp å°äº rank_max_update_timestampï¼Œå®¢æˆ·ç«¯éƒ½ä¼šé‡æ–°è¯·æ±‚ä¸€æ¬¡æ’è¡Œæ¦œï¼Œåå°ä¼šè¿”å›æœ€æ–°çš„æ’è¡Œæ¦œæ•°æ®ï¼Œè¿™é‡Œå…¶å®å¯ä»¥åšä¸‹ä¼˜åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/multi-rank-refresh-design/illustration-4.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;p&gt;å®¢æˆ·ç«¯å…ˆè¯·æ±‚äº† ranktype1 çš„æ’è¡Œæ¦œï¼Œå¯ä»¥çœ‹å‡º ranktype1 çš„ update_timestamp ä¸º t1ã€‚ä¹‹ååˆè¯·æ±‚äº† rank_type2 çš„æ’è¡Œæ¦œï¼Œè¿”å› ranktype2 çš„ update_timestamp ä¸º t2ã€‚ç”±äº t1 &amp;lt; t2ï¼Œå®¢æˆ·ç«¯ä¼šå‘ç°éœ€è¦æ›´æ–° ranktype1ã€‚ä½†ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºå…¶å®åå°ä¸éœ€è¦å†è¿”å›ä¸€æ¬¡ ranktype1 çš„æ’è¡Œæ•°æ®äº†ï¼ˆranktype1 æ¦œä¸Šçš„ç©å®¶ uid1 uid2 uid3 çš„æ•°æ®å¹¶æ²¡æœ‰å˜åŒ–ï¼‰ã€‚å› æ­¤æˆ‘ä»¬åœ¨ RankReq é‡ŒåŠ ä¸Šå®¢æˆ·ç«¯æœ¬åœ°è¯¥æ’è¡Œæ¦œçš„ update_timestampï¼Œå¦‚æœåå°å‘ç°å®¢æˆ·ç«¯çš„ update_timestamp å’Œåå°çš„æ˜¯ä¸€è‡´çš„ï¼Œå°±è¿”å›ç‰¹å®šçš„é”™è¯¯ç å‘Šè¯‰å®¢æˆ·ç«¯æ’è¡Œæ¦œä¾ç„¶æœ‰æ•ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;æ–°å¢å®¢æˆ·ç«¯æœ¬åœ°è¯¥æ’è¡Œæ¦œçš„ update_timestampï¼š&lt;/em&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;message RankReq {
    int32 rank_type               = 1; // æ’è¡Œæ¦œç±»å‹ ä¾‹å¦‚å¥½å‹æ’è¡Œæ¦œ å…¨å›½æ’è¡Œæ¦œ
    int64 client_update_timestamp = 2; // å®¢æˆ·ç«¯æœ¬åœ°è¯¥æ’è¡Œæ¦œçš„ update_timestamp
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;é‡‡ç”¨è¿™ç§æ–¹å¼çš„è¯ï¼Œæ¯æ¬¡ç‚¹å‡»è¯¥æ’è¡Œæ¦œå®¢æˆ·ç«¯è¿˜æ˜¯éœ€è¦å‘èµ·ä¸€æ¬¡ï¼ˆæ— æ•ˆï¼‰çš„åå°è¯·æ±‚ï¼Œå¦‚ä½•åšä¼˜åŒ–å‘¢ï¼Ÿè¿™é‡Œç”¨äº†ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆï¼Œå¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°æ’è¡Œæ¦œä¾ç„¶æœ‰æ•ˆçš„é”™è¯¯ç ï¼Œå°±æŠŠæœ¬åœ°è¯¥æ’è¡Œæ¦œ update_timestamp æ›´æ–°ä¸º rank_max_update_timestampï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/multi-rank-refresh-design/illustration-5.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;p&gt;æ¯æ¬¡å®¢æˆ·ç«¯è¯·æ±‚ï¼Œrank svr éƒ½éœ€è¦åˆ° data svr æŸ¥è¯¢ç©å®¶ä¿¡æ¯ã€‚å¯ä»¥åœ¨ rank svr ä¸Šç¼“å­˜ç©å®¶çš„ä¿¡æ¯ï¼Œåˆ° data svr æŸ¥è¯¢æ—¶å¦‚æœç©å®¶æ•°æ®æ— å˜åŒ–ï¼Œåˆ™è¿”å›ç‰¹å®šé”™è¯¯ç ï¼Œrank svr ç»§ç»­ä½¿ç”¨æœ¬åœ°çš„ç©å®¶ä¿¡æ¯ç¼“å­˜ã€‚&lt;/p&gt;

&lt;h2&gt;ä¸‰. æ€»ç»“&lt;/h2&gt;

&lt;p&gt;æœ¬æ–‡æå‡ºäº†ä¸€ä¸ªæœ‰å¾…è€ƒéªŒçš„å¤šæ’è¡Œæ¦œæ•°æ®åˆ·æ–°æ–¹æ¡ˆï¼Œä¸ºè§£å†³å¤šä¸ªæ’è¡Œæ¦œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚è¯¥æ–¹æ¡ˆè¿˜æœ‰ä¸€äº›ç»†èŠ‚æœ‰å¾…è€ƒé‡ï¼Œæ¬¢è¿å¤§å®¶æœ‰ä»»ä½•æƒ³æ³•æˆ–æœ‰æ›´å¥½çš„æ–¹æ¡ˆé‚®ä»¶æˆ‘ä¸€èµ·è®¨è®ºã€‚&lt;/p&gt;
</description>
        <pubDate>Sun, 04 Mar 2018 09:00:42 +0800</pubDate>
        <link>http://masutangu.com/2018/03/multi-rank-refresh-design/</link>
        <guid isPermaLink="true">http://masutangu.com/2018/03/multi-rank-refresh-design/</guid>
        
        
        <category>å·¥ä½œ</category>
        
      </item>
    
      <item>
        <title>Programming Language è¯¾ç¨‹ç¬”è®°</title>
        <description>&lt;p&gt;æœ¬æ–‡æ˜¯å­¦ä¹ &lt;a href=&quot;https://www.coursera.org/learn/programming-languages/home/info&quot;&gt;Coursera Programming Language&lt;/a&gt;è¯¾ç¨‹çš„å­¦ä¹ ç¬”è®°ï¼Œæ–‡ç« å†…å®¹åŠä»£ç å‡å–è‡ªè¯¾ç¨‹ææ–™ã€‚&lt;/p&gt;

&lt;h2&gt;ä¸€. å£°æ˜å¼ç¼–ç¨‹å’Œå‘½ä»¤å¼ç¼–ç¨‹&lt;/h2&gt;

&lt;h4&gt;å£°æ˜å¼ç¼–ç¨‹ï¼ˆDeclarative Programmingï¼‰&lt;/h4&gt;

&lt;p&gt;Building the structure and elements of computer programs, that &lt;strong&gt;expresses the logic of a computation without describing its control flow&lt;/strong&gt;.&lt;/p&gt;

&lt;h4&gt;å‘½ä»¤å¼ç¼–ç¨‹ï¼ˆImperative Programmingï¼‰&lt;/h4&gt;

&lt;p&gt;Describes computation &lt;strong&gt;in terms of statements that change a program state&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;å·¦å›¾ä¸º Declarative Programming èŒƒå¼ï¼Œå³å›¾ä¸º Imperative Programming èŒƒå¼ï¼š&lt;/em&gt;
&lt;img src=&quot;/assets/images/programming-language/illustration-3.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;h2&gt;äºŒ. å‡½æ•°å¼ç¼–ç¨‹&lt;/h2&gt;

&lt;p&gt;ä¸‰å¤§ç‰¹æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;No Mutation&lt;/li&gt;
&lt;li&gt;First Class Function&lt;/li&gt;
&lt;li&gt;Tail Recursion Optimization&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;1. No Mutation&lt;/h3&gt;

&lt;p&gt;çŸ¥ä¹ä¸Š&lt;a href=&quot;https://www.zhihu.com/question/28292740&quot;&gt;ã€Šä»€ä¹ˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹æ€ç»´ã€‹&lt;/a&gt;å…¶ä¸­ä¸€ä¸ªå›åˆ°å†™å¾—å¾ˆå¥½ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å‡½æ•°å¼ç¼–ç¨‹çš„æœ¬è´¨ï¼š
å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„&lt;strong&gt;å‡½æ•°&lt;/strong&gt;è¿™ä¸ªæœ¯è¯­ä¸æ˜¯æŒ‡è®¡ç®—æœºä¸­çš„å‡½æ•°ï¼Œè€Œæ˜¯æŒ‡æ•°å­¦ä¸­çš„å‡½æ•°ï¼Œå³è‡ªå˜é‡çš„æ˜ å°„ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå‡½æ•°çš„å€¼ä»…å†³å®šäºå‡½æ•°å‚æ•°çš„å€¼ï¼Œä¸ä¾èµ–å…¶ä»–çŠ¶æ€ã€‚åœ¨å‡½æ•°å¼è¯­è¨€ä¸­ï¼Œ&lt;strong&gt;å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘&lt;/strong&gt;ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å®šä¹‰ï¼Œåœ¨å‡½æ•°å†…æˆ–å‡½æ•°å¤–ï¼Œå¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œå¯ä»¥å¯¹å‡½æ•°è¿›è¡Œç»„åˆã€‚çº¯å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­çš„&lt;strong&gt;å˜é‡&lt;/strong&gt;ä¹Ÿä¸æ˜¯å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€ä¸­çš„å˜é‡è¡¨ç¤ºå­˜å‚¨çŠ¶æ€çš„å•å…ƒï¼Œè€Œæ˜¯&lt;strong&gt;ä»£æ•°ä¸­çš„å˜é‡&lt;/strong&gt;ï¼Œå³ä¸€ä¸ªå€¼çš„åç§°ã€‚å˜é‡çš„å€¼æ˜¯&lt;strong&gt;ä¸å¯å˜çš„ï¼ˆimmutableï¼‰&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å…è®¸åƒå‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€ä¸­é‚£æ ·å¤šæ¬¡ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ²¡æœ‰ Mutation å¸¦æ¥çš„å¥½å¤„:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;No code can ever distinguish aliasing vs. identical copies&lt;/li&gt;
&lt;li&gt;No need to think about aliasing: focus on other things&lt;/li&gt;
&lt;li&gt;Can use aliasing, which saves space, without danger &lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;2. How to build bigger types&lt;/h3&gt;

&lt;p&gt;3 most important type building-blocks in any language&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Each of&lt;/strong&gt;: A t value contains values of each of t1 t2 â€¦ tn&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;One of&lt;/strong&gt;: A t value contains values of one of t1 t2 â€¦ tn&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Self reference&lt;/strong&gt;: A t value can refer to other t values&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;3. Tail Recursion and Accumulators&lt;/h3&gt;

&lt;p&gt;ML recognizes these tail calls in the compiler and treats them differently: &lt;strong&gt;pop the caller before the call, allowing callee to reuse the same stack space&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;éå°¾é€’å½’çš„è°ƒç”¨å †æ ˆ&lt;/em&gt;
&lt;img src=&quot;/assets/images/programming-language/illustration-1.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;å°¾é€’å½’ä¼˜åŒ–åçš„è°ƒç”¨å †æ ˆ&lt;/em&gt;
&lt;img src=&quot;/assets/images/programming-language/illustration-2.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;h3&gt;4. Higher Order Function&lt;/h3&gt;

&lt;h4&gt;Map&lt;/h4&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;fun map (f,xs) =
 case xs of
 [] =&amp;gt; []
 | x::xsâ€™ =&amp;gt; (f x)::(map(f,xsâ€™))
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;h4&gt;Filter&lt;/h4&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;fun filter (f,xs) =
 case xs of
 [] =&amp;gt; []
 | x::xsâ€™ =&amp;gt; if f x
 then x::(filter(f,xsâ€™))
 else filter(f,xsâ€™)
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;h4&gt;Fold&lt;/h4&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;fun fold f acc xs =
 case xs of
 [] =&amp;gt; acc
 | x::xsâ€™ =&amp;gt; fold f (f(acc,x)) xsâ€™
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;h4&gt;Higher Order Function vs For Loop&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;Fold&lt;/strong&gt;  is another very famous iterator over recursive structures. This pattern separates recursive traversal from data processing:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Can reuse same traversal for different data processing&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Can reuse same data processing for different data structures&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;In both cases, using common vocabulary concisely communicates intent&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;éå†å‡½æ•°å’Œå¤„ç†å‡½æ•°åˆ†ç¦»ï¼Œæé«˜å¤ç”¨æ€§ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h3&gt;5. Function Closure&lt;/h3&gt;

&lt;p&gt;A function value has two parts:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;The code&lt;/strong&gt; &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;The environment&lt;/strong&gt; that was current when the function was defined&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This pair is called a &lt;strong&gt;function closure&lt;/strong&gt;.&lt;/p&gt;

&lt;h3&gt;6. Abstract Data Types With Closure&lt;/h3&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;datatype set = S of { insert : int -&amp;gt; set, 
              member : int -&amp;gt; bool, 
              size   : unit -&amp;gt; int }

val empty_set =
    let
        fun make_set xs = (* xs is a &amp;quot;private field&amp;quot; in result *)
            let (* contains a &amp;quot;private method&amp;quot; in result *)
                fun contains i = List.exists (fn j =&amp;gt; i=j) xs
            in
                S { insert = fn i =&amp;gt; if contains i 
                                     then make_set xs 
                                     else make_set (i::xs),
                    member = contains,
                    size   = fn () =&amp;gt; length xs
                  }
            end
    in
        make_set []
    end 

fun use_sets () =
    let val S s1 = empty_set
        val S s2 = (#insert s1) 34
        val S s3 = (#insert s2) 34
        val S s4 = #insert s3 19
    in
        if (#member s4) 42
        then 99
        else if (#member s4) 19
        then 17 + (#size s3) ()
        else 0
    end 
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;ä½¿ç”¨ Java å®ç°ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;interface Func&amp;lt;B,A&amp;gt; {
    B m(A x);
}
interface Pred&amp;lt;A&amp;gt; {
    boolean m(A x);
}

class List&amp;lt;T&amp;gt; {
    T       head;
    List&amp;lt;T&amp;gt; tail;
    List(T x, List&amp;lt;T&amp;gt; xs) {
    head = x;
    tail = xs;
    }

    // * the advantage of a static method is it allows xs to be null
    //    -- a more OO way would be a subclass for empty lists
    // * a more efficient way in Java would be a messy while loop
    //   where you keep a pointer to the previous element and mutate it
    //   -- (try it if you do not believe it is messy)
    static &amp;lt;A,B&amp;gt; List&amp;lt;B&amp;gt; map(Func&amp;lt;B,A&amp;gt; f, List&amp;lt;A&amp;gt; xs) {
        if(xs==null)
            return null;
        return new List&amp;lt;B&amp;gt;(f.m(xs.head), map(f,xs.tail));
    }

    static &amp;lt;A&amp;gt; List&amp;lt;A&amp;gt; filter(Pred&amp;lt;A&amp;gt; f, List&amp;lt;A&amp;gt; xs) {
        if(xs==null)
            return null;
        if(f.m(xs.head))
            return new List&amp;lt;A&amp;gt;(xs.head, filter(f,xs.tail));
        return filter(f,xs.tail);
    }

    // * again recursion would be more elegant but less efficient
    // * again an instance method would be more common, but then
    //   all clients have to special-case null 
    static &amp;lt;A&amp;gt; int length(List&amp;lt;A&amp;gt; xs) {
        int ans = 0;
        while(xs != null) {
            ++ans;
            xs = xs.tail;
        }
        return ans;
    }
}

class ExampleClients {
    static List&amp;lt;Integer&amp;gt; doubleAll(List&amp;lt;Integer&amp;gt; xs) {
        return List.map((new Func&amp;lt;Integer,Integer&amp;gt;() { 
                     public Integer m(Integer x) { return x * 2; } 
                         }), xs);
    }
    static int countNs(List&amp;lt;Integer&amp;gt; xs, final int n) {
        return List.length(List.filter(
           (new Pred&amp;lt;Integer&amp;gt;() { 
               public boolean m(Integer x) { return x==n; } 
           }), xs));
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;ä½¿ç”¨ C å®ç°:&lt;/em&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;typedef struct List list_t;
struct List {
  void * head;
  list_t * tail;
};

list_t * makelist (void * x, list_t * xs) {
  list_t * ans = (list_t *)malloc(sizeof(list_t));
  ans-&amp;gt;head = x;
  ans-&amp;gt;tail = xs;
  return ans;
}

list_t * map(void* (*f)(void*,void*), void* env, list_t * xs) {
  if(xs==NULL)
    return NULL;
  return makelist(f(env,xs-&amp;gt;head), map(f,env,xs-&amp;gt;tail));
}

list_t * filter(bool (*f)(void*,void*), void* env, list_t * xs) {
  if(xs==NULL)
    return NULL;
  if(f(env,xs-&amp;gt;head))
    return makelist(xs-&amp;gt;head, filter(f,env,xs-&amp;gt;tail));
  return filter(f,env,xs-&amp;gt;tail);
}

int length(list_t* xs) {
  int ans = 0;
  while(xs != NULL) {
    ++ans;
    xs = xs-&amp;gt;tail;
  }
  return ans;
}

// clients of our list implementation:
// [the clients that cast from void* to intptr_t are technically not legal C, 
//  as explained in detail below if curious]

// awful type casts to match what map expects
void* doubleInt(void* ignore, void* i) {
  return (void*)(((intptr_t)i)*2);
}

// assumes list holds intptr_t fields
list_t * doubleAll(list_t * xs) {
  return map(doubleInt, NULL, xs);
}

// awful type casts to match what filter expects
bool isN(void* n, void* i) {
  return ((intptr_t)n)==((intptr_t)i);
}

// assumes list hold intptr_t fields
int countNs(list_t * xs, intptr_t n) {
  return length(filter(isN, (void*)n, xs));
}
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;</description>
        <pubDate>Fri, 02 Mar 2018 19:45:24 +0800</pubDate>
        <link>http://masutangu.com/2018/03/programing-language/</link>
        <guid isPermaLink="true">http://masutangu.com/2018/03/programing-language/</guid>
        
        
        <category>è¯»ä¹¦ç¬”è®°</category>
        
      </item>
    
      <item>
        <title>åŸºäº Replicated State Machine å®ç°æ¸¸æˆè¿›ç¨‹æ¢å¤</title>
        <description>&lt;h2&gt;Introduction&lt;/h2&gt;

&lt;p&gt;æ¸¸æˆæœåŠ¡å™¨å®ç°çš„ä¸šåŠ¡é€»è¾‘æ™®éæ¯”è¾ƒå¤æ‚ï¼Œä¸”å¤§éƒ¨åˆ†æ˜¯å¸¦æœ‰çŠ¶æ€çš„ã€‚å¦‚æœè¿›ç¨‹é‡å¯æˆ–æ„å¤–å´©æºƒï¼Œä¼šå¯¼è‡´è¯¥æœåŠ¡å™¨ä¸Šçš„ç©å®¶æ–­çº¿ï¼Œä¸¢å¤±è¿›è¡Œä¸­çš„æ¸¸æˆæ•°æ®ï¼Œå¸¦æ¥æå·®çš„æ¸¸æˆä½“éªŒã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå‡ºç°ï¼Œä¸€èˆ¬æ¸¸æˆæœåŠ¡å™¨éƒ½ä¼šæŒä¹…åŒ–ç©å®¶æ•°æ®ä»¥å®ç°è¿›ç¨‹æ¢å¤ï¼Œå½“é‡å¯æˆ–è¿›ç¨‹æ„å¤–å´©æºƒæ—¶ï¼Œé‡æ–°æ‹‰èµ·è¿›ç¨‹åå¯ä»¥æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚&lt;strong&gt;å¸¸ç”¨çš„åšæ³•æ˜¯å°†ç©å®¶çš„çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨å…±äº«å†…å­˜ä¸­ï¼Œé‡å¯æ—¶åŠ è½½å…±äº«å†…å­˜è¿›è¡Œæ¢å¤ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å…±äº«å†…å­˜è™½ç„¶æ–¹ä¾¿ï¼Œä½†ä¼šæœ‰è®¸å¤šé™åˆ¶ã€‚æ¯”å¦‚ C++ æ¶‰åŠåˆ°&lt;strong&gt;å¤šæ€ï¼ˆè™šå‡½æ•°è¡¨ï¼‰ã€STLå®¹å™¨ï¼ˆheapåˆ†é…ï¼‰&lt;/strong&gt;ï¼Œéƒ½ä¸èƒ½ç›´æ¥æ˜ å°„åˆ°å…±äº«å†…å­˜ä¸­ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/game-recover-based-on-replicated-state-machine/illustration-1.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;p&gt;è¿™ç¯‡æ–‡ç« æä¾›äº†æ–°çš„æ€è·¯ï¼Œæå‡ºä¸€ä¸ªå®ç°æ¸¸æˆè¿›ç¨‹æ¢å¤æ›´ç®€æ´çš„åšæ³•ã€‚&lt;/p&gt;

&lt;h2&gt;Replicated State Machine&lt;/h2&gt;

&lt;p&gt;åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ&lt;strong&gt;replicated State Machine æ˜¯å®ç° fault tolerance çš„ä¸€ä¸ªé‡è¦æ–¹å¼&lt;/strong&gt;ï¼Œé€šå¸¸ç”±å¤åˆ¶æ—¥å¿—æ¥å®ç°ã€‚æ¯ä¸€å°æœåŠ¡å™¨ä¿å­˜ä¸€ä»½æ—¥å¿—ï¼Œæ—¥å¿—ä¸­åŒ…å«ä¸€ç³»åˆ—çš„å‘½ä»¤ï¼ŒçŠ¶æ€æœºä¼šæŒ‰é¡ºåºæ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚å› ä¸ºæ¯ä¸€å°è®¡ç®—æœºçš„çŠ¶æ€æœºéƒ½æ˜¯ç¡®å®šçš„ï¼ˆdeterministic state machineï¼‰ï¼Œæ‰§è¡Œçš„å‘½ä»¤ç›¸åŒï¼Œæœ€åè¾“å‡ºçš„ç»“æœä¹Ÿç›¸åŒã€‚&lt;/p&gt;

&lt;h2&gt;Combine&lt;/h2&gt;

&lt;p&gt;å¦‚æœæˆ‘ä»¬èƒ½&lt;strong&gt;ä»¥ç¡®å®šçŠ¶æ€æœºï¼ˆdeterministic state machineï¼‰æ¥å®ç°æ¸¸æˆé€»è¾‘&lt;/strong&gt;ï¼Œå°±å¯ä»¥è¿ç”¨ replicated State Machine çš„æ€æƒ³ã€‚åªè¦æˆ‘ä»¬æŠŠæ‰€æœ‰è§¦å‘çŠ¶æ€æœºçŠ¶æ€å˜æ›´çš„ event éƒ½ä¿å­˜ä¸‹æ¥ï¼Œé‡å¯æ—¶ç›´æ¥é‡æ”¾ä¸€éï¼Œå°±å¯ä»¥å›åˆ°é‡å¯å‰çš„çŠ¶æ€äº†ã€‚&lt;/p&gt;

&lt;p&gt;å‡è®¾å®ç°ä¸€ä¸ªå›åˆåˆ¶ pvp çš„å¯¹æˆ˜æ¸¸æˆé€»è¾‘ã€‚RoomSvr ä¸Šæœ‰è‹¥å¹²ä¸ªæˆ¿é—´ã€‚æˆ‘ä»¬&lt;strong&gt;ä»¥ state machine æ¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œæ¯ä¸ªæˆ¿é—´é€šè¿‡ state machine ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼Œå°†ç©å®¶çš„è¯·æ±‚å’Œå®šæ—¶å™¨è¶…æ—¶éƒ½è½¬åŒ–ä¸º eventï¼Œé€šè¿‡ event distributer åˆ†å‘ç»™ç›¸åº”æˆ¿é—´å¤„ç†ï¼Œå¹¶ä¸”å°† event é€šè¿‡ logging module åºåˆ—åŒ–ä¿å­˜åˆ°æœ¬åœ°&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/game-recover-based-on-replicated-state-machine/illustration-2.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;p&gt;è¿›ç¨‹é‡å¯æ—¶ç›´æ¥åŠ è½½æ—¥å¿—ï¼Œè¯»å– event ä¸¢ç»™æˆ¿é—´çš„ state machine è¿›è¡Œé‡æ”¾ï¼Œå°±èƒ½å°†æ¯ä¸ªæˆ¿é—´æ¢å¤åˆ°è¿›ç¨‹é‡å¯/æŒ‚æ‰ä¹‹å‰çš„çŠ¶æ€äº†ã€‚&lt;/p&gt;

&lt;h2&gt;How to Snapshot&lt;/h2&gt;

&lt;p&gt;æ—¥ç§¯æœˆç´¯ï¼Œåºåˆ—åŒ–çš„æ—¥å¿—ä¼šè¶Šæ¥è¶Šå¤šï¼Œå¦‚ä½•èƒ½æ¸…ç†åˆ°ä¸å†éœ€è¦çš„æ—¥å¿—ï¼Œæé«˜é‡å¯æ—¶åŠ è½½çš„é€Ÿåº¦å‘¢ï¼Ÿç”±äºæ¸¸æˆé€»è¾‘ä¸æ˜¯ç®€å•çš„ kv å­˜å‚¨ï¼Œæ— æ³•ç›´æ¥åš snapshotï¼Œä¹Ÿæ— æ³•å‚è€ƒ leveldb LSM-Tree çš„åšæ³•ï¼Œéœ€è¦æ¢ä¸€ç§æ–¹å¼æ¥å‡å°‘æ—¥å¿—çš„å †ç§¯ã€‚&lt;/p&gt;

&lt;p&gt;å½“è¿™ä¸€å±€å·²ç»ç»“æŸæ—¶ï¼Œè¿™å±€çš„ç›¸å…³ event å°±å¯ä»¥å…¨éƒ¨åˆ æ‰äº†ã€‚å¦‚æœå°† event åºåˆ—åŒ–åˆ°æ—¥å¿—ä¸­ï¼Œè¦åˆ é™¤ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥è€ƒè™‘åˆ©ç”¨å…±äº«å†…å­˜æ¥å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/game-recover-based-on-replicated-state-machine/illustration-3.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;

&lt;p&gt;å®ç° ShmStore æ¥ç®¡ç†å…±äº«å†…å­˜çš„å­˜å‚¨ï¼Œæ›¿æ¢æ‰ä¸Šå›¾çš„ Logging Moduleã€‚&lt;code&gt;ShmArr&lt;/code&gt; ä¸ºæ˜ å°„åˆ°å…±äº«å†…å­˜çš„ &lt;code&gt;RoomInfo&lt;/code&gt;æ•°ç»„ï¼Œ&lt;code&gt;RoomInfo&lt;/code&gt; æ˜¯ C struct ç»“æ„ï¼Œè®°å½•äº†æˆ¿é—´idã€æˆ¿é—´çš„çŠ¶æ€ï¼ˆæ˜¯å¦æœ‰æ•ˆï¼‰å’Œæˆ¿é—´çš„æ‰€æœ‰ eventã€‚  &lt;code&gt;room_idx_map_&lt;/code&gt; ç»´æŠ¤ç€æˆ¿é—´ id åˆ° &lt;code&gt;ShmArr&lt;/code&gt; ä¸‹æ ‡çš„å…³ç³»ï¼Œ&lt;code&gt;free_idx_&lt;/code&gt; ä¿å­˜ç€ &lt;code&gt;ShmArr&lt;/code&gt; ä¸­ç©ºé—²çš„ä¸‹æ ‡ã€‚å½“åˆ›å»ºæ–°æˆ¿é—´æ—¶ï¼Œä» &lt;code&gt;free_idx_&lt;/code&gt; ä¸­å–ä¸€ä¸ªç©ºé—²ä¸‹æ ‡ï¼Œå¹¶æŠŠæˆ¿é—´ id åˆ°è¯¥ä¸‹æ ‡çš„æ˜ å°„å…³ç³»ä¿å­˜äº &lt;code&gt;room_idx_map_&lt;/code&gt; ä¸­ï¼Œå°† &lt;code&gt;RoomInfo&lt;/code&gt; çš„ status ç½®ä¸ºæœ‰æ•ˆã€‚ä¹‹åè¯¥æˆ¿é—´çš„æ‰€æœ‰ event å°±ä¿å­˜åœ¨å¯¹åº”çš„ &lt;code&gt;RoomInfo&lt;/code&gt; ç»“æ„é‡Œã€‚å½“æˆ¿é—´é”€æ¯æ—¶ï¼Œå°†å¯¹åº”çš„ &lt;code&gt;RoomInfo&lt;/code&gt; ç»“æ„æ¸…ç©ºï¼ŒåŒæ—¶ä»&lt;code&gt;room_idx_map_&lt;/code&gt;åˆ é™¤å¯¹åº”çš„æ˜ å°„å…³ç³»ï¼Œå¹¶æŠŠè¯¥ &lt;code&gt;RoomInfo&lt;/code&gt; çš„ä¸‹æ ‡æ·»åŠ å› &lt;code&gt;free_idx_&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å½“è¯»å–å…±äº«å†…å­˜é‡å»ºæˆ¿é—´çŠ¶æ€æ—¶ï¼ŒåªåŠ è½½ status ä¸ºæœ‰æ•ˆçš„ &lt;code&gt;RoomInfo&lt;/code&gt; ç»“æ„ã€‚&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;æœ€ç»ˆæ¨¡å—å›¾å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/game-recover-based-on-replicated-state-machine/illustration-4.png&quot; width=&quot;800&quot;/&gt;&lt;/p&gt;
</description>
        <pubDate>Sat, 13 Jan 2018 11:30:24 +0800</pubDate>
        <link>http://masutangu.com/2018/01/game-recover-based-on-replicated-state-machine/</link>
        <guid isPermaLink="true">http://masutangu.com/2018/01/game-recover-based-on-replicated-state-machine/</guid>
        
        
        <category>å·¥ä½œ</category>
        
      </item>
    
      <item>
        <title>MIT 6.824 å­¦ä¹ ç¬”è®°ï¼ˆäº”ï¼‰</title>
        <description>&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« æ˜¯å¯¹ &lt;a href=&quot;https://pdos.csail.mit.edu/6.824/schedule.html&quot;&gt;MIT 6.824&lt;/a&gt; è¯¾ç¨‹çš„å­¦ä¹ ç¬”è®°ã€‚&lt;/p&gt;

&lt;h1&gt;FaRM Note&lt;/h1&gt;

&lt;p&gt;FaRM writes go to RAM, not disk -- eliminates a huge bottleneck. Can write RAM in 200 ns, but takes 10 ms to write hard drive, 100 us for SSD, but RAM loses content in power failure! Not persistent by itself.  &lt;/p&gt;

&lt;p&gt;Just write to RAM of f+1 machines, to tolerate f failures? Might be enough if failures were always independent, but power failure is not independent -- may strike 100% of machines!&lt;/p&gt;

&lt;p&gt;So batteries in every rack, can run machines for a few minutes: &lt;strong&gt;&amp;quot;non-volatile RAM&amp;quot;&lt;/strong&gt;. What if crash prevents s/w from writing SSD, e.g bug in FaRM or kernel, or cpu/memory/hardware error. FaRM copes with single-machine crashes by copying data from RAM of machines&amp;#39; replicas to other machines to ensure always f+1 copies. Crashes (other than power failure) must be independent!&lt;/p&gt;

&lt;p&gt;why is the network often a performance bottleneck?&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    the usual setup:
    app                       app
    ---                       ---
    socket buffers            buffers
    TCP                       TCP
    NIC driver                driver
    NIC  -------------------- NIC
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;lots of expensive CPU operations:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;system calls&lt;/li&gt;
&lt;li&gt;copy messages&lt;/li&gt;
&lt;li&gt;interrupts&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;and all twice if RPC! It&amp;#39;s hard to build RPC than can deliver more than a few 100,000 / second wire b/w (e.g. 10 gigabits/second) is rarely the limit for short RPC. These per-packet CPU costs are the limiting factor for small messages.&lt;/p&gt;

&lt;p&gt;Two classes of concurrency control for transactions:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;pessimistic:
wait for lock on first use of object; hold until commit/abort, called two-phase locking. Conflicts cause delays&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;optimistic:
access object without locking; commit &amp;quot;validates&amp;quot; to see if OK. &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Valid: do the writes&lt;/li&gt;
&lt;li&gt;Invalid: abort
called &lt;strong&gt;Optimistic Concurrency Control (OCC)&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;FaRM uses OCC. The reason: OCC lets FaRM read using one-sided RDMA reads, server storing the object does not need to set a lock, due to OCC.&lt;/p&gt;

&lt;p&gt;FaRM transaction API (simplified):&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;  txCreate()
  o = txRead(oid)  -- RDMA
  o.f += 1
  txWrite(oid, o)  -- purely local
  ok = txCommit()  -- Figure 4
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;What&amp;#39;s in an oid: &lt;region #, address&gt;. &lt;code&gt;region #&lt;/code&gt; indexes a mapping to [ primary, backup1, ... ]. Target NIC can use address directly to read or write RAM so target CPU doesn&amp;#39;t have to be involved.&lt;/p&gt;

&lt;p&gt;Server memory layout: regions, each an array of objects
Object layout: header with version # and lock&lt;/p&gt;

&lt;p&gt;Every region replicated on one primary, f backups -- f+1 replicas. Only the primary serves reads; all f+1 see commits+writes replication yields availability if &amp;lt;= f failures, i.e. available as long as one replica stays alive; better than Raft!&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;txRead
one-sided RDMA to fetch object direct from primary&amp;#39;s memory -- fast!
also fetches object&amp;#39;s version number, to detect concurrent writes&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;txWrite
must be preceded by txRead
just writes local copy; no communication&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;transaction execution / commit protocol without failure -- Figure 4&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;LOCK (first message in commit protocol)&lt;/p&gt;

&lt;p&gt;TC sends to primary of each written object
TC uses RDMA to append to its log at each primary
LOCK record contains oid, version # xaction read, new value
primary s/w polls log, sees LOCK, validates, sends &amp;quot;yes&amp;quot; or &amp;quot;no&amp;quot; reply message
note LOCK is both logged in primary&amp;#39;s NVRAM &lt;em&gt;and&lt;/em&gt; an RPC exchange&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;what does primary CPU do on receipt of LOCK?&lt;/p&gt;

&lt;p&gt;(for each object)
if object locked, or version != what xaction read, reply &amp;quot;no&amp;quot;
otherwise set the lock flag and return &amp;quot;yes&amp;quot;
note: does &lt;em&gt;not&lt;/em&gt; block if object is already locked&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;TC waits for all LOCK reply messages&lt;/p&gt;

&lt;p&gt;if any &amp;quot;no&amp;quot;, abort
send ABORT to primaries so they can release locks
returns &amp;quot;no&amp;quot; from txCommit()&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;TC sends COMMIT-PRIMARY to primary of each written object&lt;/p&gt;

&lt;p&gt;uses RDMA to append to primary&amp;#39;s log
TC only waits for hardware ack -- does not wait for primary to process log entry
TC returns &amp;quot;yes&amp;quot; from txCommit()&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;what does primary do when it processes the COMMIT-PRIMARY in its log?&lt;/p&gt;

&lt;p&gt;copy new value over object&amp;#39;s memory
increment object&amp;#39;s version #
clear object&amp;#39;s lock flag&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1&gt;Paxos Made Simple&lt;/h1&gt;

&lt;h2&gt;The Consensus Algorithm&lt;/h2&gt;

&lt;p&gt;Assume a collection of processes that can propose values. &lt;/p&gt;

&lt;p&gt;The safety
requirements for consensus are:
â€¢ Only a value that has been proposed may be chosen,
â€¢ Only a single value is chosen, and
â€¢ A process never learns that a value has been chosen unless it actually has been&lt;/p&gt;

&lt;p&gt;We let the three roles in the consensus algorithm be performed by three classes of agents: proposers, acceptors, and learners.&lt;/p&gt;

&lt;p&gt;A proposer sends a proposed value to a
set of acceptors. An acceptor may accept the proposed value. The value is
chosen when a large enough set of acceptors have accepted it. Because any two majorities
have at least one acceptor in common, this works if an acceptor can accept
at most one value. &lt;/p&gt;

&lt;p&gt;In the absence of failure or message loss, we want a value to be chosen
even if only one value is proposed by a single proposer. This suggests the
requirement:
P1. An acceptor must accept the first proposal that it receives.&lt;/p&gt;

&lt;p&gt;P1 and the requirement that a value is chosen only when it is accepted
by a majority of acceptors imply that an acceptor must be allowed to accept
more than one proposal. We keep track of the different proposals that an
acceptor may accept by assigning a (natural) number to each proposal, so a
proposal consists of a proposal number and a value. To prevent confusion,
we require that different proposals have different numbers.  A
value is chosen when a single proposal with that value has been accepted by
a majority of the acceptors. In that case, we say that the proposal (as well
as its value) has been chosen.&lt;/p&gt;

&lt;p&gt;We can allow multiple proposals to be chosen, but we must guarantee
that all chosen proposals have the same value. By induction on the proposal
number, it suffices to guarantee:
P2. If a proposal with value v is chosen, then every higher-numbered proposal
that is chosen has value v.&lt;/p&gt;

&lt;p&gt;To be chosen, a proposal must be accepted by at least one acceptor. So,
we can satisfy P2 by satisfying:
P2a
. If a proposal with value v is chosen, then every higher-numbered proposal
accepted by any acceptor has value v.&lt;/p&gt;

&lt;p&gt;Because communication
is asynchronous, a proposal could be chosen with some particular
acceptor c never having received any proposal. Suppose a new proposer
â€œwakes upâ€ and issues a higher-numbered proposal with a different value.
P1 requires c to accept this proposal, violating P2a
. Maintaining both P1
and P2a
requires strengthening P2a
to:
P2b
. If a proposal with value v is chosen, then every higher-numbered proposal
issued by any proposer has value v.&lt;/p&gt;

&lt;p&gt;Since any set S consisting of a majority of acceptors contains at least one
member of C , we can conclude that a proposal numbered n has value v by
ensuring that the following invariant is maintained:
P2c
. For any v and n, if a proposal with value v and number n is issued,
then there is a set S consisting of a majority of acceptors such that
either (a) no acceptor in S has accepted any proposal numbered less
than n, or (b) v is the value of the highest-numbered proposal among
all proposals numbered less than n accepted by the acceptors in S.&lt;/p&gt;

&lt;p&gt;We can therefore satisfy P2b by maintaining the invariance of P2c
.&lt;/p&gt;

&lt;p&gt;To maintain the invariance of P2c
, a proposer that wants to issue a proposal
numbered n must learn the highest-numbered proposal with number
less than n, if any, that has been or will be accepted by each acceptor in
some majority of acceptors.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;A proposer chooses a new proposal number n and sends a request to
each member of some set of acceptors, asking it to respond with:
(a) A promise never again to accept a proposal numbered less than
n, and
(b) The proposal with the highest number less than n that it has
accepted, if any.
I will call such a request a prepare request with number n.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;If the proposer receives the requested responses from a majority of
the acceptors, then it can issue a proposal with number n and value
v, where v is the value of the highest-numbered proposal among the
responses, or is any value selected by the proposer if the responders
reported no proposals.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;A proposer issues a proposal by sending, to some set of acceptors, a request
that the proposal be accepted. (This need not be the same set of acceptors
that responded to the initial requests.) Letâ€™s call this an accept request&lt;/p&gt;

&lt;p&gt;P1a
. An acceptor can accept a proposal numbered n iff it has not responded
to a prepare request having a number greater than n.&lt;/p&gt;

&lt;p&gt;The final
algorithm is obtained by making one small optimization.
Suppose an acceptor receives a prepare request numbered n, but it has
already responded to a prepare request numbered greater than n, thereby
promising not to accept any new proposal numbered n. There is then no
reason for the acceptor to respond to the new prepare request, since it will
not accept the proposal numbered n that the proposer wants to issue. We also have it ignore
a prepare request for a proposal it has already accepted.&lt;/p&gt;

&lt;p&gt;Phase 1. (a) A proposer selects a proposal number n and sends a prepare
request with number n to a majority of acceptors.
(b) If an acceptor receives a prepare request with number n greater
than that of any prepare request to which it has already responded,
then it responds to the request with a promise not to accept any more
proposals numbered less than n and with the highest-numbered proposal
(if any) that it has accepted.&lt;/p&gt;

&lt;p&gt;Phase 2. (a) If the proposer receives a response to its prepare requests
(numbered n) from a majority of acceptors, then it sends an accept
request to each of those acceptors for a proposal numbered n with a
value v, where v is the value of the highest-numbered proposal among
the responses, or is any value if the responses reported no proposals.
(b) If an acceptor receives an accept request for a proposal numbered
n, it accepts the proposal unless it has already responded to a prepare
request having a number greater than n.&lt;/p&gt;

&lt;p&gt;Itâ€™s easy to construct a scenario in which two proposers each keep issuing
a sequence of proposals with increasing numbers, none of which are ever
chosen. Proposer p completes phase 1 for a proposal number n1. Another
proposer q then completes phase 1 for a proposal number n2 &amp;gt; n1. Proposer
pâ€™s phase 2 accept requests for a proposal numbered n1 are ignored because
the acceptors have all promised not to accept any new proposal numbered
less than n2.&lt;/p&gt;

&lt;p&gt;To guarantee progress, a distinguished proposer must be selected as the
only one to try issuing proposals.&lt;/p&gt;

&lt;p&gt;The Paxos algorithm [5] assumes a network of processes. In its consensus
algorithm, each process plays the role of proposer, acceptor, and learner.
The algorithm chooses a leader, which plays the roles of the distinguished proposer and the distinguished learner. &lt;/p&gt;

&lt;p&gt;All that remains is to describe the mechanism for guaranteeing that no
two proposals are ever issued with the same number. Different proposers
choose their numbers from disjoint sets of numbers, so two different proposers
never issue a proposal with the same number. Each proposer remembers
(in stable storage) the highest-numbered proposal it has tried to issue,
and begins phase 1 with a higher proposal number than any it has already
used.&lt;/p&gt;

&lt;h1&gt;MDCC: Multi-Data Center Consistency&lt;/h1&gt;

&lt;h2&gt;Introduction&lt;/h2&gt;

&lt;p&gt;MDCC (Multi-Data Center Consistency) is an
optimistic commit protocol for geo-replicated transactions,
that does not require a master or static partitioning, and is
strongly consistent at a cost similar to eventually consistent
protocols. &lt;/p&gt;

&lt;p&gt;Replication across geographically diverse data centers
(called geo-replication) is qualitatively different from replication
within a cluster, data center or region, because interdata
center network delays are in the hundreds of milliseconds
and vary significantly. These delays are close enough
to the limit on total latency that users will tolerate, so it becomes
crucial to reduce the number of message round-trips taken between data centers, and desirable to avoid waiting
for the slowest data center to respond.&lt;/p&gt;

&lt;p&gt;The traditional mechanism for transactions that are
distributed across databases is two-phase commit (2PC), but
this has serious drawbacks in a geo-replicated system. 2PC
depends on a reliable coordinator to determine the outcome
of a transaction, so it will block for the duration of a coordinator
failure, and (even worse) the blocked transaction will
be holding locks that prevent other transactions from making
progress until the recovery is completed.&lt;/p&gt;

&lt;p&gt;MDCC requires only a single wide-area message
round-trip to commit a transaction in the common case, and
is â€œmaster-bypassingâ€, meaning it can read or update from
any node in any data center. &lt;/p&gt;

&lt;p&gt;MDCC is the first protocol to use Generalized Paxos [15] as a commit protocol on a per record basis, combining it with techniques from
the database community (escrow transactions [19] and demarcation
[3]). The key idea is to achieve single round-trip
commits by 1) executing parallel Generalized Paxos on each
record, 2) ensuring every prepare has been received by a
fast quorum of replicas, 3) disallowing aborts for successfully
prepared records, and 4) piggybacking notification of
commit state on subsequent transactions.&lt;/p&gt;

&lt;h2&gt;Architecture Overview&lt;/h2&gt;

&lt;p&gt;MDCC uses a library-centric approach similar to the architectures
of DBS3 [5], Megastore [2] or Spanner &lt;a href=&quot;as%0Ashown%20in%20Figure%201&quot;&gt;8&lt;/a&gt;. This architecture separates the stateful
component of a database system as a distributed record manager.
All higher-level functionality (such as query processing
and transaction management) is provided through a stateless
DB library, which can be deployed at the application server.&lt;/p&gt;

&lt;p&gt;As a result, the only stateful component of the architecture,
the storage node, is significantly simplified and scalable
through standard techniques such as range partitioning,
whereas all higher layers of the database can be replicated
freely with the application tier because they are stateless.&lt;/p&gt;

&lt;p&gt;MDCC places storage nodes in geographically distributed
data centers, with every node being responsible for one or more horizontal partitions. we assume
for the remainder of the paper that every data center
contains a full replica of the data, and the data within a single
data center is partitioned across machines.&lt;/p&gt;

&lt;p&gt;The DB library provides a programming model for transactions
and is mainly responsible for coordinating the replication
and consistency of the data using MDCCâ€™s commit
protocol. The DB library also acts as a transaction manager
and is responsible to determine the outcome of a transaction.&lt;/p&gt;

&lt;p&gt;In contrast to many other systems, MDCC supports an individual
master per record, which can either be storage nodes
or app-server and is responsible to coordinate the updates
to a record.&lt;/p&gt;

&lt;h2&gt;The MDCC Protocol&lt;/h2&gt;

&lt;h3&gt;Classic Paxos&lt;/h3&gt;

&lt;p&gt;Paxos distinguishes between clients, proposers, acceptors
and learners. These can be directly mapped to our scenario,
where clients are app-servers, proposers are masters, acceptors
are storage nodes and all nodes are learners.&lt;/p&gt;

&lt;p&gt;The basic idea in Classic Paxos [14], as applied for replicating
a transactionâ€™s updates to data, is as follows: Every
record has a master responsible for coordinating updates to
the record. At the end of a transaction, the app-server sends
the update requests to the masters of each the record. The master informs all
storage nodes responsible for the record that it is the master
for the next update. It is possible that multiple masters exist
for a record, but to make progress, eventually only one
master is allowed. The master processes the client request
by attempting to convince the storage nodes to agree on it.
A storage node accepts an update if and only if it comes
from the most recent master the node knows of, and it has
not already accepted a more recent update for the record.&lt;/p&gt;

&lt;p&gt;the Classic Paxos algorithm operates in
two phases. Phase 1 tries to establish the mastership for
an update for a specific record r. A master P, selects a
proposal number m, also referred to as a ballot number or
round, higher than any known proposal number and sends
a Phase1a request with m to at least a majority of storage
nodes responsible for r. The proposal numbers must be unique for each master because they are used to determine
the latest request. If a storage node receives a Phase1a request
greater than any proposal number it has already responded
to, it responds with a Phase1b message containing
m, the highest-numbered update (if any) including its proposal
number n, and promises not to accept any future requests
less than or equal to m. If P receives responses containing
its proposal number m from a majority QC of storage
nodes, it has been chosen as a master. Now, only P will be
able to commit a value for proposal number m.&lt;/p&gt;

&lt;p&gt;Phase 2 tries to write a value. P sends an accept request
Phase2a to all the storage nodes of Phase 1 with the ballot
number m and value v. v is either the update of the highestnumbered
proposal among the Phase1b responses, or the
requested update from the client if no Phase1b responses
contained a value.&lt;/p&gt;

&lt;h3&gt;Transaction Support&lt;/h3&gt;

&lt;p&gt;We guarantee this consistency level by using a Paxos instance
per record to accept an option to execute the update,
instead of writing the value directly. After the app-server
learns the options for all the records in a transaction, it commits
the transaction and asynchronously notifies the storage
nodes to execute the options. If an option is not yet executed,
it is called an outstanding option.&lt;/p&gt;

&lt;p&gt;Updates to records create new versions, and are represented
in the form vread â†’ vwrite, where vread is the
version of the record read by the transaction and vwrite is
the new version of the record. This allows MDCC to detect
write-write conflicts by comparing the current version of a
record with vread. If they are not equal, the record was modified
between the read and write and a write-write conflict
was encountered.&lt;/p&gt;

&lt;p&gt;The app-server coordinates the transaction by trying to
get the options accepted for all updates. It proposes the options
to the Paxos instances running for each record, with the
participants being the replicas of the record. Every storage
node responds to the app-server with an accept or reject of
the option, depending on if vread is valid. Hence, the storage nodes make an
active decision to accept or reject the option. This is fundamentally
different than existing uses of Paxos , which require to send a fixed value (e.g., the â€œfinalâ€ accept or commit
decision) and only decide based on the ballot number if the
value should be accepted. The reason why this change does
not violate the Paxos assumptions is that we defined at the
end of Section 3.1.1 that a new record version can only be
chosen if the previous version was successfully determined.
Thus, all storage nodes will always make the same abort or
commit decision.&lt;/p&gt;

&lt;p&gt;Just as in 2PC, the app-server commits a transaction when
it learns all options as accepted, and aborts a transaction
when it learns any option as rejected. The app-server learns
an option if and only if a majority of storage nodes agrees
on the option. &lt;/p&gt;

&lt;p&gt;In contrast to 2PC we made another important
change: MDCC does not allow clients or app-servers
to abort a transaction once it has been proposed. Decisions
are determined and stored by the distributed storage nodes
with MDCC, instead of being decided by a single coordinator
with 2PC. This ensures that the commit status of a
transaction depends only on the status of the learned options
and hence is always deterministic even with failures.&lt;/p&gt;

&lt;p&gt;If the app-server determines that the transaction is aborted
or committed, it informs involved storage nodes through a
Learned message about the decision. The storage nodes in
turn execute the option (make visible) or mark it as rejected.&lt;/p&gt;

&lt;p&gt;We apply a simple
pessimistic strategy to avoid deadlocks. The core idea is to
relax the requirement that we can only learn a new version if
the previous instance is committed.&lt;/p&gt;
</description>
        <pubDate>Thu, 11 Jan 2018 22:14:04 +0800</pubDate>
        <link>http://masutangu.com/2018/01/mit-6824-note-5/</link>
        <guid isPermaLink="true">http://masutangu.com/2018/01/mit-6824-note-5/</guid>
        
        
        <category>è¯»ä¹¦ç¬”è®°</category>
        
      </item>
    
      <item>
        <title>MIT 6.824 å­¦ä¹ ç¬”è®°ï¼ˆå››ï¼‰</title>
        <description>&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« æ˜¯å¯¹ &lt;a href=&quot;https://pdos.csail.mit.edu/6.824/schedule.html&quot;&gt;MIT 6.824&lt;/a&gt; è¯¾ç¨‹çš„å­¦ä¹ ç¬”è®°ã€‚&lt;/p&gt;

&lt;h1&gt;ZooKeeper&lt;/h1&gt;

&lt;h2&gt;Abstract&lt;/h2&gt;

&lt;p&gt;ZooKeeper æ—¨åœ¨æä¾›ç®€å•é«˜æ•ˆçš„å†…æ ¸ä»¥ä¾›å®¢æˆ·ç«¯å®ç°æ›´å¤æ‚çš„ coordination primitivesã€‚In addition to the wait-free
property, ZooKeeper provides a &lt;strong&gt;per client guarantee of FIFO execution of requests&lt;/strong&gt; and &lt;strong&gt;linearizability for all requests that change the ZooKeeper state&lt;/strong&gt;.&lt;/p&gt;

&lt;h2&gt;Introduction&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†ä¿è¯çŠ¶æ€æ›´æ–°æ“ä½œï¼ˆå†™è¯·æ±‚ï¼‰çš„ linearizabilityï¼ŒZooKeeper å®ç°äº† &lt;strong&gt;Zabï¼Œä¸€ä¸ªåŸºäº leader çš„åŸå­å¹¿æ’­åè®®&lt;/strong&gt;ã€‚In ZooKeeper, &lt;strong&gt;servers process read operations locally, and we do not use Zab to totally order them&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;åœ¨å®¢æˆ·ç«¯ç¼“å­˜æ•°æ®æ˜¯æé«˜è¯»æ€§èƒ½çš„é‡è¦æŠ€æœ¯ï¼Œ&lt;strong&gt;ZooKeeper æä¾›äº† watch æœºåˆ¶&lt;/strong&gt;ï¼Œä¸ç›´æ¥ç®¡ç†å®¢æˆ·ç«¯ç¼“å­˜ã€‚&lt;/p&gt;

&lt;h2&gt;Service overview&lt;/h2&gt;

&lt;p&gt;ZooKeeper æä¾›ç»™å®¢æˆ·ç«¯ znode çš„æŠ½è±¡ï¼Œznode æœ‰ä¸‹åˆ—ä¸¤ç§ç±»å‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Regular&lt;/strong&gt; : ç”±å®¢æˆ·ç«¯æ˜¾å¼åˆ›å»ºå’Œåˆ é™¤&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ephemeral&lt;/strong&gt;: ç”±å®¢æˆ·ç«¯åˆ›å»ºï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯æ˜¾å¼åˆ é™¤ï¼Œå½“ä¼šè¯ç»ˆæ­¢æ—¶ç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ZooKeeper å®ç°äº† watch æœºåˆ¶ï¼Œå½“æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶é€šçŸ¥å®¢æˆ·ç«¯ï¼Œè€Œä¸å¿…é€šè¿‡è®©å®¢æˆ·ç«¯è½®è¯¢æœåŠ¡å™¨çš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;å®¢æˆ·ç«¯è¿æ¥åˆ° ZooKeeper æ—¶ä¼šåˆå§‹åŒ–ä¸€ä¸ª sessionã€‚Session æœ‰è¶…æ—¶æœºåˆ¶ï¼Œå½“ ZooKeeper åœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯ sessionçš„ä»»ä½•ä¿¡æ¯æ—¶ï¼Œä¼šåˆ¤å®šè¯¥å®¢æˆ·ç«¯å·²ç»æŒ‚æ‰ã€‚&lt;/p&gt;

&lt;h2&gt;ZooKeeper guarantees&lt;/h2&gt;

&lt;p&gt;ZooKeeper å…·å¤‡ä»¥ä¸‹ä¸¤ä¸ªåŸºç¡€ä¿è¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Linearizable writes&lt;/strong&gt;: all requests that update the state of ZooKeeper are serializable and respect precedence;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;FIFO client order&lt;/strong&gt;: all requests from a given client are executed in the order that they were sent by the client.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Examples of primitives&lt;/h2&gt;

&lt;h3&gt;Simple Locks without Herd Effect&lt;/h3&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Lock
1 n = create(l + â€œ/lock-â€, EPHEMERAL|SEQUENTIAL)
2 C = getChildren(l, false)
3 if n is lowest znode in C, exit
4 p = znode in C ordered just before n
5 if exists(p, true) wait for watch event
6 goto 2

Unlock
1 delete(n)
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Write Lock
1 n = create(l + â€œ/write-â€, EPHEMERAL|SEQUENTIAL)
2 C = getChildren(l, false)
3 if n is lowest znode in C, exit
4 p = znode in C ordered just before n
5 if exists(p, true) wait for event
6 goto 2

Read Lock
1 n = create(l + â€œ/read-â€, EPHEMERAL|SEQUENTIAL)
2 C = getChildren(l, false)
3 if no write znodes lower than n in C, exit
4 p = write znode in C ordered just before n
5 if exists(p, true) wait for event
6 goto 3
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;h2&gt;ZooKeeper Implementation&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-4/illustration-1.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œç”± request processor å¤„ç†ã€‚å¦‚æœæ˜¯å†™è¯·æ±‚ï¼Œåˆ™ä½¿ç”¨ zab åè®®ï¼Œæœ€ç»ˆæäº¤åˆ° ZooKeeper æ•°æ®åº“çš„ä¿®æ”¹å°†ä¼šè¢«å¤åˆ¶åˆ°è¯¥ç³»ç»Ÿä¸Šæ‰€æœ‰çš„æœåŠ¡å™¨ã€‚&lt;/p&gt;

&lt;p&gt;å¤åˆ¶æ•°æ®åº“æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œ&lt;strong&gt;åœ¨å˜æ›´è¢«åº”åˆ°åˆ°å†…å­˜æ•°æ®åº“ä¹‹å‰ï¼Œæˆ‘ä»¬å¼ºåˆ¶å°†æ›´æ–°è®°å½•åˆ·åˆ°ç£ç›˜ä¸Šä»¥å®ç° recoverability&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ¯ä¸ª ZooKeeper æœåŠ¡å™¨éƒ½æ¥æ”¶å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ è¯»æ“ä½œç”±æ¯ä¸ªæœåŠ¡å™¨çš„æœ¬åœ°æ•°æ®åº“æ¥å¤„ç†ï¼Œå†™è¯·æ±‚åˆ™ç”± zab åè®®å¤„ç†ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h3&gt;Request Processor&lt;/h3&gt;

&lt;p&gt;ä¸å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¸åŒï¼Œ&lt;strong&gt;äº‹åŠ¡æ˜¯å¹‚ç­‰çš„&lt;/strong&gt;ã€‚When the leader receives a write request, it calculates what the state of the system will be when the write is applied and transforms it into a transaction that captures this new state. The future state must be calculated because there may be outstanding transactions that have not yet been applied to the database. ï¼ˆå°½ç®¡ transaction å¯èƒ½æ‰§è¡Œå¤šæ¬¡ï¼Œä½†é€šè¿‡è®¡ç®— state çš„æ–¹å¼ï¼Œä¸”ä¿è¯å¤šæ¬¡æ‰§è¡Œçš„ transaction ä¹ŸæŒ‰ç…§åŸå…ˆçš„é¡ºåºï¼Œå°±èƒ½ä¿è¯å¹‚ç­‰æ€§ï¼‰&lt;/p&gt;

&lt;h3&gt;Atomic Broadcast&lt;/h3&gt;

&lt;p&gt;æ‰€æœ‰æ›´æ–° ZooKeeper çŠ¶æ€çš„è¯·æ±‚éƒ½è¢«è½¬å‘åˆ° leaderã€‚ Leader æ‰§è¡Œè¯·æ±‚å¹¶é€šè¿‡ Zabï¼Œä¸€ä¸ªåŸå­å¹¿æ’­åè®®å¹¿æ’­è¯¥å˜æ›´ã€‚Zab é‡‡ç”¨majority quorums æ¥å†³å®šä¸€ä¸ªå»ºè®®ï¼Œå› æ­¤ ZooKeeper åœ¨ 2F + 1 æœåŠ¡å™¨çš„åœºæ™¯ä¸‹æœ€å¤šå¯ä»¥å®¹å¿ F å°æœåŠ¡å™¨æ•…éšœã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Because state changes depend on the application of previous state changes, Zab provides stronger order guarantees than regular atomic broadcast.&lt;/strong&gt; More specifically, Zab guarantees that &lt;strong&gt;changes broadcast by a leader are delivered in the order they were sent&lt;/strong&gt; and &lt;strong&gt;all changes from previous leaders are delivered to an established leader before it broadcasts its own changes&lt;/strong&gt;.&lt;/p&gt;

&lt;h3&gt;Replicated Database&lt;/h3&gt;

&lt;p&gt;é‡æ”¾æ¶ˆæ¯ä»¥æ¢å¤çŠ¶æ€éå¸¸è€—æ—¶ï¼Œå› æ­¤ ZooKeeper å®šæœŸè¿›è¡Œå¿«ç…§ï¼Œæ¢å¤æ—¶åªéœ€è¦é‡æ”¾å¿«ç…§åçš„æ¶ˆæ¯ã€‚ ä¸ºäº†ä¸é”ä½çŠ¶æ€ï¼ŒZooKeeper é‡‡ç”¨&lt;strong&gt;æ¨¡ç³Šå¿«ç…§&lt;/strong&gt;çš„æ–¹å¼ã€‚å¯¹æ ‘è¿›è¡Œæ·±åº¦ä¼˜å…ˆæ‰«æï¼ŒåŸå­è¯»å–æ¯ä¸ª znode çš„æ•°æ®å’Œå…ƒæ•°æ®å¹¶å†™å…¥ç£ç›˜ã€‚Since the resulting fuzzy snapshot may have applied some subset of the state changes delivered during the generation of the snapshot, the result may not correspond to the state of ZooKeeper at any point in time. However, since state changes are idempotent, we can apply them twice as long as we apply the state changes in order.&lt;/p&gt;

&lt;h3&gt;Client-Server Interactions&lt;/h3&gt;

&lt;p&gt;è¯»è¯·æ±‚ç”±æœåŠ¡å™¨æœ¬åœ°å¤„ç†ã€‚æ¯ä¸ªè¯»è¯·æ±‚éƒ½è¢«ä¸€ä¸ª zxid æ ‡è®°ï¼Œè¡¨ç¤ºæœåŠ¡å™¨çœ‹åˆ°çš„æœ€åä¸€ä¸ªäº‹åŠ¡ã€‚æœ¬åœ°è¯»å–çš„æ–¹å¼æé«˜äº†æ€§èƒ½ï¼Œä½†å¯èƒ½è¿”å›æ—§æ•°æ®ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨è¯»æ“ä½œåè°ƒç”¨ sync æ¥ä¿è¯è¿”å›çš„æ˜¯æœ€æ–°çš„å€¼ã€‚In our implementation, we do not need to atomically broadcast sync as we use a leader-based algorithm, and we simply place the sync operation at the end of the queue of requests between the leader and the server executing the call to sync. In order for this to work, the follower must be sure that the leader is still the leader. If there are pending transactions that commit, then the server does not suspect the leader. If the pending queue is empty, the leader needs to issue a null transaction to commit and orders the sync after that transaction.&lt;/p&gt;

&lt;p&gt;ZooKeeper æœåŠ¡å™¨ä»¥ FIFO çš„é¡ºåºæ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚Response åŒ…å«äº† zxidã€‚Even heartbeat messages during intervals of no activity include the last zxid seen by the server that the client is connected to. If the client connects to a new server, that new server ensures that its view of the ZooKeeper data is at least as recent as the view of the client by checking the last zxid of the client against its last zxid. If the client has a more recent view than the server, the server does not reestablish the session with the client until the server has caught up.&lt;/p&gt;

&lt;h1&gt;Linearizability versus Serializability&lt;/h1&gt;

&lt;p&gt;æ³¨ï¼šæ‘˜è‡ª &lt;a href=&quot;http://www.bailis.org/blog/linearizability-versus-serializability/&quot;&gt;Linearizability versus Serializability&lt;/a&gt;&lt;/p&gt;

&lt;h2&gt;Linearizability: single-operation, single-object, real-time order&lt;/h2&gt;

&lt;p&gt;Linearizability is a guarantee about single operations on single objects. It provides a real-time  guarantee on the behavior of a set of single operations.&lt;/p&gt;

&lt;p&gt;In plain English, under linearizability, writes should appear to be instantaneous. Imprecisely, once a write completes, all later reads (where â€œlaterâ€ is defined by wall-clock start time) should return the value of that write or the value of a later write. Once a read returns a particular value, all later reads should return that value or the value of a later write.&lt;/p&gt;

&lt;p&gt;Linearizability for read and write operations is synonymous with the term â€œatomic consistencyâ€ and is the â€œC,â€ or â€œconsistency,â€ in Gilbert and Lynchâ€™s proof of the CAP Theorem. We say linearizability is composable (or â€œlocalâ€) because, if operations on each object in a system are linearizable, then all operations in the system are linearizable.&lt;/p&gt;

&lt;h2&gt;Serializability: multi-operation, multi-object, arbitrary total order&lt;/h2&gt;

&lt;p&gt;Serializability is a guarantee about transactions, or groups of one or more operations over one or more objects. It guarantees that the execution of a set of transactions (usually containing read and write operations) over multiple items is equivalent to some serial execution (total ordering) of the transactions.&lt;/p&gt;

&lt;p&gt;Serializability is the traditional â€œI,â€ or isolation, in ACID. If usersâ€™ transactions each preserve application correctness (â€œC,â€ or consistency, in ACID), a serializable execution also preserves correctness. Therefore, serializability is a mechanism for guaranteeing database correctness.&lt;/p&gt;

&lt;p&gt;Serializability is not composable. Serializability does not imply any kind of deterministic orderâ€”it simply requires that some equivalent serial execution exists.&lt;/p&gt;

&lt;p&gt;å…³äº Serializability å’Œ Linearizabilityï¼Œå¯ä»¥è¯»è¯»&lt;a href=&quot;https://36kr.com/p/5037166.html&quot;&gt;åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§çš„å‘å±•å†å²&lt;/a&gt;&lt;/p&gt;

&lt;h1&gt;Transaction Management in the R* Distributed Database Management System&lt;/h1&gt;

&lt;p&gt;è¿™ç¯‡è®ºæ–‡çš„ä¸»é¢˜æ˜¯å…³äºåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿçš„äº‹åŠ¡ç®¡ç†ï¼Œç€é‡æè¿°äº† R* æäº¤åè®®ï¼šPresumed Abortï¼ˆPAï¼‰å’Œ Presumed Commitï¼ˆPCï¼‰ã€‚PA å’Œ PC æ˜¯è‘—åçš„ two-phaseï¼ˆ2Pï¼‰æäº¤åè®®çš„æ‰©å±•ã€‚&lt;/p&gt;

&lt;h2&gt;Introduction&lt;/h2&gt;

&lt;p&gt;R* is an experimental, distributed database management system (DDBMS). In a distributed database
system, the actions of a transaction (an atomic unit of consistency and recovery) may occur at more than one site. &lt;strong&gt;A commit protocol is needed to guarantee the uniform commitment of distributed transaction executions.&lt;/strong&gt; &lt;/p&gt;

&lt;p&gt;Some of the desirable characteristics in a commit protocol are&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;guaranteed transaction atomicity always&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ability to â€œforgetâ€ outcome of commit processing after a short amount of timeï¼ˆä¸éœ€è¦ä¸€ç›´è®°å½•ç»“æœï¼‰&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;minimal overhead in terms of log writes and message traffic&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;optimized performance in the no-failure case&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;exploitation of completely or partially read-only transactions&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;maximizing the ability to perform unilateral aborts&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Multilevel hierarchical commit protocols are suggested to be more natural than the conventional two-level (one coordinator and a set of subordinates) protocols.&lt;/strong&gt; With these goals in mind, we extended the conventional 2P commit protocol to support a tree of processes and defined the &lt;strong&gt;Presumed Abort (PA)&lt;/strong&gt; and the &lt;strong&gt;Presumed Commit (PC)&lt;/strong&gt; protocols to improve the performance of distributed transaction commit. &lt;/p&gt;

&lt;h2&gt;The Two-Phase Commit Protocol&lt;/h2&gt;

&lt;p&gt;åœ¨ 2P æäº¤åè®®ä¸­ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œæ¨¡å‹åŒ…æ‹¬äº†ä¸€ä¸ª coordinator è¿›ç¨‹ï¼Œå®ƒè¿æ¥äº†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’Œå…¶ä»–ç§°ä¸º subordinates çš„è¿›ç¨‹ã€‚Subordinates è¿›ç¨‹å½¼æ­¤ä¹‹é—´ä¸äº¤äº’ï¼Œåªå’Œ coordinator äº¤äº’ã€‚æ¯ä¸ªäº‹åŠ¡åˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„åå­—ã€‚&lt;/p&gt;

&lt;h3&gt;2P Under Normal Operation&lt;/h3&gt;

&lt;p&gt;å½“ coordinator æ¥æ”¶åˆ°æ¥è‡ªç”¨æˆ·çš„äº‹åŠ¡æäº¤è¯·æ±‚æ—¶ï¼Œå¹¶è¡Œçš„å‘é€ PREPARE æ¶ˆæ¯ç»™ subordinatesï¼Œæ­¤æ—¶è¿›å…¥æäº¤åè®®çš„ç¬¬ä¸€é˜¶æ®µã€‚å¦‚æœè¯¥äº‹åŠ¡å¯ä»¥æäº¤ï¼Œsubordinate å…ˆ force-write ä¸€æ¡ prepare log recordï¼Œä¹‹åå‘é€ YES VOTE ç»™ coordinatorï¼Œå†ç­‰å¾… coordinator è¿”å›æœ€åçš„å†³ç­–ï¼ˆcommit è¿˜æ˜¯ abortï¼‰ï¼Œä¹‹å subordinate è¿›å…¥ &lt;strong&gt;prepare&lt;/strong&gt; çŠ¶æ€ï¼Œæ— æ³•å•æ–¹é¢ç»ˆæ­¢æˆ–æäº¤äº‹åŠ¡ã€‚å¦‚æœ subordinate å†³å®šç»ˆæ­¢äº‹åŠ¡ï¼Œå…ˆ force-write ä¸€æ¡ abort recordï¼Œä¹‹åå‘é€ NO VOTE ç»™ coordinatorã€‚å› ä¸º NO VOTE è¡¨ç¤ºå¦å†³ï¼Œsubordinate ä¸éœ€è¦ç­‰å¾… coordinatorï¼Œç›´æ¥ç»ˆæ­¢è¯¥äº‹åŠ¡ï¼Œé‡Šæ”¾é”å¹¶â€œå¿˜è®°â€è¯¥äº‹åŠ¡ï¼ˆä¸éœ€è¦è®°å½•ä»»ä½•ä¿¡æ¯äº†ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å½“ coordinator æ¥æ”¶åˆ°æ‰€æœ‰ subordinates çš„æŠ•ç¥¨æ—¶ï¼Œè¿›å…¥æäº¤åè®®çš„ç¬¬äºŒé˜¶æ®µã€‚å¦‚æœæ‰€æœ‰æŠ•ç¥¨éƒ½æ˜¯ YESï¼Œåˆ™ coordinator è¿›å…¥ &lt;strong&gt;committing&lt;/strong&gt; çŠ¶æ€ï¼šé¦–å…ˆ force-write ä¸€æ¡ commit recordï¼Œå‘é€ COMMIT æ¶ˆæ¯ç»™æ‰€æœ‰ subordinates. åœ¨ force-write æˆåŠŸæ‰§è¡Œåï¼Œäº‹åŠ¡å³å¯æäº¤ï¼Œä¸”é€šçŸ¥å®¢æˆ·ç«¯äº‹åŠ¡å·²ç»æˆåŠŸæäº¤ã€‚å¦‚æœ coordinator æœ‰æ”¶åˆ° NO VOTEï¼Œåˆ™è¿›å…¥ &lt;strong&gt;aborting&lt;/strong&gt; çŠ¶æ€ï¼šforce-write ä¸€æ¡ abort recordï¼Œå‘é€ ABORT æ¶ˆæ¯ç»™å¤„äºå‡†å¤‡çŠ¶æ€çš„æˆ–è€…æ²¡æœ‰å› PREPARE æ¶ˆæ¯çš„ subordinatesã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœ subordinate æ”¶åˆ° COMMIT æ¶ˆæ¯ï¼Œåˆ™è¿›å…¥ &lt;strong&gt;committing&lt;/strong&gt; çŠ¶æ€ï¼šå…ˆ force-write ä¸€æ¡ commit recordï¼Œå‘é€ ACK æ¶ˆæ¯ç»™ coordinatorï¼Œç„¶åæäº¤äº‹åŠ¡å¹¶ä¸”â€œå¿˜è®°â€è¯¥äº‹åŠ¡ã€‚å¦‚æœæ”¶åˆ°çš„æ˜¯ ABORT æ¶ˆæ¯ï¼Œè¿›å…¥ &lt;strong&gt;aborting&lt;/strong&gt; çŠ¶æ€ï¼šforce-write ä¸€æ¡ abort recordï¼Œå‘é€ ACK æ¶ˆæ¯ç»™ coordinatorï¼Œç„¶åç»ˆæ­¢äº‹åŠ¡å¹¶ä¸”â€œå¿˜è®°â€è¯¥äº‹åŠ¡ã€‚å½“ coordinator æ”¶åˆ°æ‰€æœ‰ subordinates çš„ ACK æ¶ˆæ¯ï¼ˆä¸åŒ…æ‹¬ NO VOTE çš„ subordinatesï¼‰ï¼Œå†™ä¸€æ¡ end record ç„¶åâ€œå¿˜è®°â€è¯¥äº‹åŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;The general principle on which the protocols described in this paper are based is that if a subordinate acknowledges the receipt of any particular message, then it should make sure (by forcing a log record with the information in that message before sending the ACK) that it will never ask the coordinator about that piece of information. &lt;/p&gt;

&lt;p&gt;log åŒ…å«äº†å¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;the type (prepare, end, etc.) of the record&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;the identity of the process that writes the record&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;the name of the transaction&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;the identity of the coordinator&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;the names of the exclusive locks held by the writer in the case of prepare records&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;the identities of the subordinates in the case of the commit/abort records written by the coordinator&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»ç»“ä¸‹ï¼Œæäº¤äº‹åŠ¡æ€»å…±éœ€è¦ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;subordinate å†™ä¸¤æ¡è®°å½•ï¼šprepare record å’Œ commit recordï¼Œä¸”å‘é€ä¸¤æ¡æ¶ˆæ¯ï¼šYES VOTE å’Œ ACK&lt;/li&gt;
&lt;li&gt;coordinator å‘é€ä¸¤æ¡æ¶ˆæ¯ï¼šPREPARE å’Œ COMMITï¼Œä»¥åŠå†™ä¸¤æ¡è®°å½•ï¼šcommit recordï¼ˆforce-writeï¼‰å’Œ end recordï¼ˆé force-writeï¼‰ &lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;2P and Failures&lt;/h3&gt;

&lt;p&gt;æ¯ä¸ªç«™ç‚¹éƒ½å­˜åœ¨ä¸€ä¸ª recovery è¿›ç¨‹ï¼Œå¤„ç†æ¥è‡ªå…¶ä»–ç«™ç‚¹çš„ recovery è¿›ç¨‹çš„ä¿¡æ¯ã€‚å½“ä» crash ä¸­æ¢å¤æ—¶ï¼Œrecovery è¿›ç¨‹è¯»å– stable storage çš„ logï¼Œå¹¶ä¸”åœ¨ virtual storage ä¸­é‡å»ºã€‚åœ¨ virtual storage çš„è¿™éƒ¨åˆ†ä¿¡æ¯æœ‰ä¸‹åˆ—ç”¨é€”ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åº”ç­”å…¶ä»–ç«™ç‚¹å‘æ¥çš„äº‹åŠ¡æŸ¥è¯¢è¯·æ±‚ï¼Œè¿™äº›äº‹åŠ¡çš„ coordinators æ˜¯è¿è¡Œåœ¨è¯¥æŒ‚æ‰çš„ç«™ç‚¹ä¸Šï¼ˆanswer queries from other sites about transactions that had their coordinators at this siteï¼‰&lt;/li&gt;
&lt;li&gt;å‘é€äº‹åŠ¡çš„æŸ¥è¯¢ä¿¡æ¯ç»™å…¶ä»–ç«™ç‚¹çš„ subordinatesï¼Œè¿™äº›äº‹åŠ¡çš„ coordinators æ˜¯è¿è¡Œåœ¨è¯¥æŒ‚æ‰çš„ç«™ç‚¹ä¸Šï¼ˆsend unsolicited information to other sites that had subordinates for transactions that had their coordinators at this siteï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ virtual storage æ„å»ºçš„å¥½å¤„åœ¨äºå¯ä»¥å¿«é€Ÿå›åº”å…¶ä»–ç«™ç‚¹çš„æŸ¥è¯¢ï¼Œè€Œä¸éœ€è¦ä» stable storage æŸ¥è¯¢æ—¥å¿—ã€‚&lt;/p&gt;

&lt;p&gt;å½“ recovery è¿›ç¨‹å‘ç°æœ‰äº‹åŠ¡å¤„äº &lt;strong&gt;prepare&lt;/strong&gt; çŠ¶æ€ï¼Œåˆ™ä¼šå®šæœŸå‘ coordinator è¯¢é—®è¯¥äº‹åŠ¡åº”è¯¥å¦‚ä½•å¤„ç†ï¼ˆcommit è¿˜æ˜¯ abortï¼‰ã€‚å¦‚æœ recovery è¿›ç¨‹å‘ç°æœ‰äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å´©æºƒï¼Œæ²¡æœ‰ç•™ä¸‹ä»»ä½•æ—¥å¿—ï¼Œåˆ™ç›´æ¥å›æ»šæ“ä½œï¼Œå†™ä¸€æ¡ abort recordï¼Œç„¶åâ€œå¿˜è®°â€ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœ recovery è¿›ç¨‹å‘ç°äº‹åŠ¡å¤„äº &lt;strong&gt;committing/aborting&lt;/strong&gt; çŠ¶æ€ï¼Œå®ƒå°†å°è¯•å®šæœŸå‘é€ COMMIT/ABORT ç»™æ‰€æœ‰è¿˜æ²¡ ACK è¿‡çš„ subordinatesã€‚ä¸€æ—¦æ”¶åˆ°æ‰€æœ‰ ACKï¼Œåˆ™å†™ä¸€æ¡ end record å¹¶ä¸”â€œå¿˜è®°â€è¯¥äº‹åŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœ recovery è¿›ç¨‹æ”¶åˆ°ä¸€æ¡äº‹åŠ¡æŸ¥è¯¢ï¼Œä½† virtual storage ä¸­æ²¡æœ‰è¯¥äº‹åŠ¡çš„ä¿¡æ¯ï¼Œåˆ™ç›´æ¥è¿”å› ABORTã€‚&lt;/p&gt;

&lt;h2&gt;The Presumed Abort Protocol&lt;/h2&gt;

&lt;p&gt;ä¸Šä¸€èŠ‚æåˆ°ï¼Œåœ¨æ‰¾ä¸åˆ°å…³äºäº‹åŠ¡çš„ä¿¡æ¯æ—¶ï¼Œrecovery è¿›ç¨‹å°†è¿”å› ABORTã€‚è¿™æ„å‘³ç€å½“ coordinator å†³å®šè¦ abort äº‹åŠ¡æ—¶ï¼Œå¯ä»¥ç›´æ¥â€œå¿˜è®°â€è¯¥äº‹åŠ¡ï¼Œcoordinator å’Œ subordinates ä¸å†éœ€è¦ force-write ä¸€æ¡ abort recordï¼Œsubordinates ä¹Ÿä¸éœ€è¦ ACK æ¥è‡ª coordinator çš„ ABORT æ¶ˆæ¯ã€‚coordinator ä¹Ÿä¸åœ¨éœ€è¦è®°å½• end record äº†ã€‚&lt;/p&gt;

&lt;p&gt;åªè¯»äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œleaf è¿›ç¨‹ç›´æ¥è¿”å› READ VOTEï¼Œé‡Šæ”¾é”ï¼Œä¸”â€œå¿˜è®°â€è¯¥äº‹åŠ¡ã€‚ A nonroot, nonleaf sends a READ VOTE only if its own vote and those of its subordinatesâ€™ are also READ VOTES. Otherwise, as long as none of the latter is a NO VOTE, it sends a YES VOTE.ï¼ˆå­˜åœ¨éƒ¨åˆ†åªè¯»äº‹åŠ¡ï¼‰&lt;/p&gt;

&lt;p&gt;There will not be a second phase of the protocol if the root process is readonly and it gets only READ VOTES. In this case the root process, just like the other processes, writes no log records for the transaction. &lt;/p&gt;

&lt;p&gt;æ€»ç»“ä¸‹ï¼Œå®Œå…¨åªè¯»äº‹åŠ¡ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½ä¸éœ€è¦å†™ä»»ä½• log recordã€‚æ¯ä¸ª nonleaf è¿›ç¨‹å‘é€ä¸€æ¡ PREPARE æ¶ˆæ¯ï¼Œæ¯ä¸ª nonroot è¿›ç¨‹å‘é€ä¸€æ¡ä¿¡æ¯ READ VOTE æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;h2&gt;ZooKeeper Note&lt;/h2&gt;

&lt;p&gt;Zookeeper: &lt;strong&gt;a generic &amp;quot;master&amp;quot; service&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Design challenges:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;What API?&lt;/li&gt;
&lt;li&gt;How to make master fault tolerant?&lt;/li&gt;
&lt;li&gt;How to get good performance?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Challenges interact: good performance may influence API e.g., asynchronous interface to allow pipelining&lt;/p&gt;

&lt;p&gt;Sessions: clients sign into zookeeper&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Session allows a client to fail-over to another zookeeper service
Client know the term and index of last completed operationsend it on each request. &lt;strong&gt;Service performs operation only if caught up with what client has seen.&lt;/strong&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Sessions can timeout
Client must refresh a session continuously send a heartbeat to the server (like a lease). &lt;strong&gt;Zookeeper considers client &amp;quot;dead&amp;quot; if doesn&amp;#39;t hear from a client.&lt;/strong&gt; Client may keep doing its thing (e.g., network partition) but cannot perform other zookeeper ops in that session&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Challenge: Duplicates client requests&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Scenario
Primary receives client request, fails
Client resends client request to new primary&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Lab 3: 
&lt;strong&gt;Table to detect duplicates&lt;/strong&gt;
&lt;strong&gt;Limitation: one outstanding op per client&lt;/strong&gt;ï¼ˆç¼“å­˜å›åŒ…ï¼Œæ‰€ä»¥éœ€è¦ç­‰ä¸Šä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œï¼Œæ‰èƒ½å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œå¯¹æ¯”æ˜¯å¦é‡å¤ï¼Œé‡å¤çš„è¯è¿”å›å·²ç»ç¼“å­˜å¥½çš„å›åŒ…ï¼‰
Problem problem: cannot pipeline client requests&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Zookeeper:
Some ops are idempotent period
Some ops are easy to make idempotent: &lt;strong&gt;test-version-and-then-do-op&lt;/strong&gt;
Some ops &lt;strong&gt;the client is responsible for detecting dups&lt;/strong&gt;
 Consider the lock example.
   Create a file name that includes its session ID
     &amp;quot;app/lock/request-sessionID-seqno&amp;quot;
     zookeeper informs client when switch to new primary
 client runs getChildren()
   if new requests is there, all set
   if not, re-issue create&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Problem: read may return stale data if only master performs it&lt;/p&gt;

&lt;p&gt;Zookeeper solution: don&amp;#39;t promise non-stale data (by default)&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Reads are allowed to return stale data&lt;/li&gt;
&lt;li&gt;Reads can be executed by any replica&lt;/li&gt;
&lt;li&gt;Read throughput increases as number of servers increases&lt;/li&gt;
&lt;li&gt;Read returns the last zxid it has seen
 So that new primary can catch up to zxid before serving the read
 Avoids reading from past&lt;/li&gt;
&lt;li&gt;Only sync-read() guarantees data is not stale&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Sync optimization: &lt;strong&gt;avoid ZAB layer for sync-read&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Must ensure that read observes last committed txn. &lt;strong&gt;Leader puts sync in queue between it and replica.&lt;/strong&gt; If ops ahead of in the queue commit, then leader must be leader, otherwise, issue null transaction.(&lt;strong&gt;In same spirit read optimization in Raft paper&lt;/strong&gt;, see last par section 8 of raft paper)&lt;/p&gt;

&lt;h2&gt;2P Note&lt;/h2&gt;

&lt;p&gt;What about concurrent transactions?&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;x and y are bank balances
x and y start out as $10

T1 is doing a transfer of $1 from x to y
T1:
  add(x, 1)  -- server A
  add(y, -1) -- server B
T2:
  tmp1 = get(x)
  tmp2 = get(y)
  print tmp1, tmp2
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;Problem: &lt;strong&gt;What if T2 runs between the two add() RPCs?&lt;/strong&gt; Then T2 will print 11, 10 money will have been created!  T2 should print 10,10 or 9,11.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The traditional correctness definition is &amp;quot;serializability&amp;quot;.&lt;/strong&gt;  Results should be as if transactions ran one at a time in some order as if T1, then T2; or T2, then T1. The results for the two differ, either is OK.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&amp;quot;Two-phase locking&amp;quot; is one way to implement serializability&lt;/strong&gt;. Each database record has a lock. The lock is stored at the server that stores the record. Transaction must wait for and acquire a record&amp;#39;s lock before using it. Thus add() handler implicitly acquires lock when it uses record. x or y transaction holds its locks until &lt;em&gt;after&lt;/em&gt; commit or abort.&lt;/p&gt;

&lt;p&gt;What are locks really doing?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;When transactions conflict, locks delay one to force serial execution.&lt;/li&gt;
&lt;li&gt;When transactions don&amp;#39;t conflict, locks allow fast parallel execution.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Raft and two-phase commit solve different problems!&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Use Raft to get high availability by replicating&lt;/strong&gt;, i.e. to be able to operate when some servers are crashed. The servers all do the &lt;em&gt;same&lt;/em&gt; thing&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Use 2PC when each subordinate does something different&lt;/strong&gt; and &lt;strong&gt;all of them must do their part&lt;/strong&gt;. &lt;strong&gt;2PC does not help availability&lt;/strong&gt; since all servers must be up to get anything done. &lt;strong&gt;Raft does not ensure that all servers do something&lt;/strong&gt; since only a majority have to be alive.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;What if you want &lt;strong&gt;high availability and distributed commit&lt;/strong&gt;?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Each &amp;quot;server&amp;quot; should be a Raft-replicated service&lt;/li&gt;
&lt;li&gt;And the Transaction Coordinator(TC) should be Raft-replicated&lt;/li&gt;
&lt;li&gt;Run two-phase commit among the replicated services&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Then you can tolerate failures and still make progress.&lt;/p&gt;
</description>
        <pubDate>Wed, 10 Jan 2018 19:53:45 +0800</pubDate>
        <link>http://masutangu.com/2018/01/mit-6824-note-4/</link>
        <guid isPermaLink="true">http://masutangu.com/2018/01/mit-6824-note-4/</guid>
        
        
        <category>è¯»ä¹¦ç¬”è®°</category>
        
      </item>
    
      <item>
        <title>å†è§ï¼Œ2017</title>
        <description>&lt;p&gt;å›çœ‹èµ·å»å¹´çš„æ€»ç»“ &lt;a href=&quot;http://masutangu.com/2016/12/review/&quot;&gt;æˆ‘çš„2016&lt;/a&gt;ï¼Œå¿ƒé‡ŒæŒºæœ‰æ„Ÿæ…¨çš„ã€‚17 å¹´æ˜¯å‡ºç°è½¬æœºçš„ä¸€å¹´ï¼Œåœ¨è¿™æœ€åä¸€å¤©ï¼ŒæŒ‰ç…§æƒ¯ä¾‹ï¼Œæ•´ç†ä¸‹è¿™ä¸€å¹´çš„å†ç¨‹å’Œæƒ³æ³•ã€‚&lt;/p&gt;

&lt;h1&gt;å…³äºè‡ªå·±&lt;/h1&gt;

&lt;p&gt;åœ¨å»å¹´çš„æ—¶å€™ï¼Œæˆ‘æ€»è§‰å¾—è‡ªå·±åœ¨å·¥ä½œä¸ŠæŒºå¤±æ„çš„ï¼Œå„ç§åŸå› ä¸‹è¾¾ä¸åˆ°è‡ªå·±çš„æœŸæœ›ã€‚è¿˜å¥½ï¼Œä»Šå¹´åœ¨å·¥ä½œæ–¹é¢å¯¹è‡ªå·±è¿˜ç®—æ»¡æ„ã€‚&lt;strong&gt;æœ€å¤§çš„è¿›æ­¥æ˜¯å¯¹å·¥ä½œçš„å¿ƒæ€ä¸Šï¼Œä¸å†æœ‰ä¸€äº›å›°æƒ‘å’Œçº ç»“ã€‚&lt;/strong&gt;å·¥ä½œä¸ŠåŠªåŠ›å»äº‰å–æœ‰æŒ‘æˆ˜çš„éœ€æ±‚ï¼Œç©ºé—²çš„æ—¶å€™åˆ™æŠ½æ›´å¤šçš„æ—¶é—´åœ¨ä¸ªäººå­¦ä¹ ä¸Šï¼Œç»´æŒå¥½å·¥ä½œå’Œè‡ªå­¦çš„å¹³è¡¡ã€‚æˆ‘æŒºå–œæ¬¢è¿™æ ·çš„èŠ‚å¥ï¼Œå¿™çš„æ—¶å€™å…¨å¿ƒå…¨æ„æŠŠå·¥ä½œåšå¥½ï¼Œä¸å¿™çš„æ—¶å€™å°±æŠŠæ›´å¤šçš„æ—¶é—´æŠ•å…¥åˆ°è‡ªå·±æ„Ÿå…´è¶£çš„é¢†åŸŸã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç»å† 16 å¹´é‚£æ®µçº ç»“çš„æ—¶é—´ï¼Œå¦‚ä»Šè‡ªå·±åŠªåŠ›ä¸€ç‚¹ç‚¹æ‰­è½¬ï¼Œæˆ‘ä¹Ÿæ›´åŠ ç›¸ä¿¡ï¼Œ&lt;strong&gt;åœ¨ä»»ä½•æ—¶å€™éƒ½è¦æŠŠä¸»åŠ¨æƒæ¡åœ¨è‡ªå·±æ‰‹é‡Œ&lt;/strong&gt;ã€‚ä¸ç®¡è‡ªå·±å¤„åœ¨ä¸€ä¸ªä»€ä¹ˆæ ·çš„ç¯å¢ƒï¼Œå¯¹ä½ æ˜¯æœ‰åˆ©æˆ–è€…æ˜¯ä¸åˆ©çš„ã€æœ‰æ²¡æœ‰æœºé‡ã€å…¬ä¸å…¬å¹³ï¼Œ&lt;strong&gt;æŠŠè‡ªå·±èƒ½æ§åˆ¶çš„åšå¥½ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½ä¼šæœ‰é€‰æ‹©æƒ&lt;/strong&gt;ã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œç¯å¢ƒä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ä¸€ä¸ªå› ç´ ï¼Œæ˜¯é‡‘å­æ€»ä¼šå‘å…‰ï¼Œæˆ‘è§‰å¾—æ˜¯æ‚–è®ºã€‚æˆ–è€…è¯´ï¼Œ&lt;strong&gt;æ˜¯é‡‘å­çš„è¯ï¼Œåº”è¯¥ä¸»åŠ¨å¯»æ‰¾èƒ½è®©è‡ªå·±å‘å…‰çš„æœºä¼š&lt;/strong&gt;ï¼Œè€Œä¸æ˜¯å‘†åœ¨æ²™å †ä¸­ï¼Œç­‰ç€åˆ«äººæ¥å‘æ˜ä½ ï¼Œè¯¥äº‰å–çš„ä¸œè¥¿å°±ä¸€å®šè¦å»äº‰å–ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ªäººå­¦ä¹ ä¸Šï¼Œä¸‹åŠå¹´çš„ä¸»è¦ç²¾åŠ›éƒ½æ”¾åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šï¼Œè·Ÿç€ &lt;a href=&quot;https://pdos.csail.mit.edu/6.824/schedule.html&quot;&gt;MIT 6.824&lt;/a&gt; çš„è¯¾ç¨‹ï¼Œè¯»è®ºæ–‡ï¼Œåšå®éªŒï¼Œè®°&lt;a href=&quot;http://masutangu.com/2017/11/mit-6824-note-1/&quot;&gt;ç¬”è®°&lt;/a&gt;ã€‚è¿™ä¸ªè¯¾ç¨‹å—ç›ŠåŒªæµ…ï¼Œæœ‰äº›æ€è·¯æˆ‘ä¹Ÿèƒ½é¡ºåˆ©è¿ç”¨åˆ°å·¥ä½œä¸Šï¼Œè¿™æ ·çš„æ„Ÿè§‰æŒºä¸é”™çš„ã€‚&lt;/p&gt;

&lt;h1&gt;å…³äºå›¢é˜Ÿ&lt;/h1&gt;

&lt;p&gt;å¹³æ—¶å–œæ¬¢ç¯®çƒï¼Œä¹Ÿç»å¸¸å…³æ³¨ NBAã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå›¢é˜Ÿæ°›å›´å’Œæ–‡åŒ–åŠå…¶é‡è¦ã€‚å‹‡å£«ã€é©¬åˆºçš„æˆåŠŸï¼Œå’Œä»–ä»¬çš„çƒé˜Ÿæ–‡åŒ–ã€ç®¡ç†å±‚çš„ç†å¿µæ˜¯åˆ†ä¸å¼€çš„ã€‚&lt;strong&gt;çƒé˜Ÿçš„å‡èšåŠ›ã€çƒå‘˜ä¹‹é—´çš„åŒ–å­¦ååº”ï¼Œæ˜¯æ— æ³•ä½“ç°åœ¨å†·å†°å†°çš„æ•°æ®ä¸Šçš„ã€‚&lt;/strong&gt;è¯»åˆ°è¿™ç¯‡æ–‡ç« &lt;a href=&quot;https://zhuanlan.zhihu.com/p/31997176&quot;&gt;ã€Šä½ å¯èƒ½è§è¯äº†å‹‡å£«é˜Ÿçš„æˆåŠŸï¼Œå´å¾ˆå°‘äº†è§£ä»–ä»¬èƒŒåçš„çƒé˜Ÿæ–‡åŒ–ã€‹&lt;/a&gt;çš„æ—¶å€™ï¼Œæˆ‘å†…å¿ƒæœ‰ç‚¹è¢«è§¦åŠ¨ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å³ä¾¿å…‹æ‹‰å…‹ç¦»å¼€äº†å‹‡å£«é˜Ÿï¼Œå‹‡å£«çš„ä¸»åœºçƒé¦†å†…ä¾ç„¶æŒ‚ç€ä»–èº«ç©¿å‹‡å£«çƒè¡£çš„ç…§ç‰‡ï¼Œè€Œå…‹æ‹‰å…‹è‡ªå·±ä¹Ÿè¡¨ç¤ºï¼Œè™½ç„¶è‡ªå·±ä¸åœ¨å‹‡å£«ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šå’Œè¿™äº›çƒå‘˜ä¿æŒç´§å¯†çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¸€æ”¯çƒé˜Ÿä¸­ï¼Œæœ‰ä¸åŒçš„è§’è‰²ï¼šå…¨æ˜æ˜Ÿã€å…ˆå‘ã€æ›¿è¡¥ã€é¥®æ°´æœºç®¡ç†å‘˜ã€‚ä½†ç›¸ä¿¡æˆ‘ï¼Œ&lt;strong&gt;æ— è®ºä½ åœ¨çƒé˜Ÿä¸­æ‰®æ¼”ä»€ä¹ˆæ ·çš„è§’è‰²ï¼Œæ¯ä¸ªäººéƒ½å¸Œæœ›è‡ªå·±æ˜¯çƒé˜Ÿçš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯æ¯”èµ›çš„ä¸€éƒ¨åˆ†ï¼Œæ¯ä¸ªäººéƒ½å¸Œæœ›çƒé˜Ÿçš„èƒœåˆ©ï¼Œä¹Ÿæœ‰è‡ªå·±è´¡çŒ®çš„é‚£éƒ¨åˆ†å› ç´ ã€‚&lt;/strong&gt;åœ¨è¿™ä¸€å¹´ï¼Œæˆ‘å‚ä¸äº†é¡¹ç›®ç»„æ–°é¡¹ç›®çš„ç ”å‘ï¼Œå¤§å®¶ä¸€èµ·å¯¹éœ€æ±‚ã€è®¨è®ºæ–¹æ¡ˆã€å‰åå°å®šåè®®ã€è”è°ƒã€æ”¹bugï¼Œæ²¡æœ‰ä»€ä¹ˆæ’•é€¼ã€ç”©é”…ï¼Œæˆ‘æ„Ÿè§‰åˆ°è‡ªå·±åœ¨å›¢é˜Ÿä¸­çš„è§’è‰²ï¼Œæˆ‘çŸ¥é“è‡ªå·±èƒ½åšäº›ä»€ä¹ˆï¼Œè¿™äº›éƒ½è®©æˆ‘æ›´åŠ æœ‰åŠ¨åŠ›å»æ‰®æ¼”å¥½å›¢é˜Ÿä¸­çš„ä¸€ä»½å­ã€‚&lt;/p&gt;

&lt;h1&gt;ä¸€äº›ä¸è¶³&lt;/h1&gt;

&lt;p&gt;ä¸€ç›´ä»¥æ¥ï¼Œæˆ‘éƒ½æ¯”è¾ƒéš¾ä»¥ä¿æŒç¨³å®šçš„çŠ¶æ€ã€‚æœ‰æ—¶çŠ¶æ€å¥½çš„æ—¶å€™ï¼Œå°±ä¸€å¤´æ‰è¿›å»ã€‚å‰é˜µå­æœ‰ä¸€æ®µæ—¶é—´ï¼Œæ¯å¤©éƒ½ 6 ç‚¹å°±è‡ªç„¶é†’ï¼Œé‚£æ®µæ—¶é—´å°±å¤©å¤©å¾ˆæ—©åˆ°å…¬å¸ï¼Œåƒå®Œæ—©é¤åå¼€å§‹è¯»è®ºæ–‡ï¼Œå°±è¿™æ ·æ¯å¤©éƒ½æŠ½æ›´å¤šçš„æ—¶é—´å»å­¦ä¹ ã€‚ä½†æŒç»­äº†å¤§æ¦‚ä¸€ä¸ªæœˆä¹‹åå°±ç´¯å®äº†ï¼Œä½è¿·äº†ä¸€ä¸¤å‘¨ã€‚è€Œä¸”çŠ¶æ€ä½è¿·çš„æ—¶å€™ï¼Œè‡ªå·±ä¹Ÿç»å¸¸ä¼šç„¦è™‘ï¼Œå¯¼è‡´æœ‰äº›æ¶æ€§å¾ªç¯ã€‚æ–°çš„ä¸€å¹´ï¼Œå¸Œæœ›è‡ªå·±èƒ½ç»´æŒç¨³å®šäº›çš„çŠ¶æ€ï¼Œå¯¹è‡ªå·±ä¹Ÿæ›´æœ‰è€å¿ƒäº›ã€‚&lt;strong&gt;ç»†æ°´é•¿æµ&lt;/strong&gt;ï¼Œåšé•¿è¿œæ‰“ç®—ã€‚&lt;/p&gt;

&lt;h1&gt;æ–°å¹´å±•æœ›&lt;/h1&gt;

&lt;p&gt;æ–°çš„ä¸€å¹´ï¼Œå¸Œæœ›è‡ªå·±èƒ½åœ¨&lt;strong&gt;å·¥ä½œä¸Šèƒ½æœ‰æ›´å¤§çš„çªç ´&lt;/strong&gt;ï¼Œä¸ªäººå­¦ä¹ ä¸Šç»§ç»­æŒ‰è‡ªå·±è§„åˆ’çš„è·¯çº¿èµ°ï¼Œ&lt;strong&gt;æ‰©å±•æ›´å¤šé¢†åŸŸçš„çŸ¥è¯†ï¼Œæå‡è‡ªå·±çš„æ ¸å¿ƒç«äº‰åŠ›&lt;/strong&gt;ã€‚è¿˜æ˜¯ç›¸ä¿¡é‚£å¥è¯ï¼š&lt;strong&gt;Pursue excellence, and success will followï¼&lt;/strong&gt;&lt;/p&gt;
</description>
        <pubDate>Sun, 31 Dec 2017 16:28:17 +0800</pubDate>
        <link>http://masutangu.com/2017/12/2017-review/</link>
        <guid isPermaLink="true">http://masutangu.com/2017/12/2017-review/</guid>
        
        
        <category>éšç¬”</category>
        
      </item>
    
      <item>
        <title>MIT 6.824 å­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰</title>
        <description>&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« æ˜¯å¯¹ &lt;a href=&quot;https://pdos.csail.mit.edu/6.824/schedule.html&quot;&gt;MIT 6.824&lt;/a&gt; è¯¾ç¨‹çš„å­¦ä¹ ç¬”è®°ã€‚&lt;/p&gt;

&lt;h1&gt;Spinnaker&lt;/h1&gt;

&lt;h2&gt;Introduction&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;Spinnaker is an experimental datastore that is designed to run on a large cluster of commodity servers in a single datacenter. This paper describes Spinnakerâ€™s Paxos-based replication protocol. The use of Paxos ensures that a data partition in Spinnaker will be available for reads and writes as long a majority of its replicas are alive.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å®ç°æŒç»­å¯ç”¨æ€§çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯&lt;strong&gt;ä¸»ä»å¤åˆ¶&lt;/strong&gt;ï¼Œä½†ä¸»ä»å¤åˆ¶å­˜åœ¨ä»¥ä¸‹ç¼ºé™·ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-3/illustration-1.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä¸Šå›¾çš„ä¾‹å­ä¸­ï¼Œä¸»ä»èŠ‚ç‚¹éƒ½ä» LSN=10 å¼€å§‹ï¼ˆaï¼‰ï¼Œä¹‹å slave èŠ‚ç‚¹æŒ‚äº†ï¼ˆbï¼‰ï¼Œmaster èŠ‚ç‚¹ç»§ç»­æ¥æ”¶å†™è¯·æ±‚ï¼Œä¸€ç›´åˆ° LSN=20ã€‚ä¹‹å master èŠ‚ç‚¹ä¹ŸæŒ‚äº†ï¼ˆcï¼‰ï¼Œä¹‹å slave èŠ‚ç‚¹æ¢å¤ï¼ˆdï¼‰ï¼Œç„¶è€Œï¼Œåœ¨æ­¤æ—¶ slave èŠ‚ç‚¹ä¸èƒ½æ¥æ”¶ä»»ä½•è¯»å†™è¯·æ±‚å› ä¸ºå®ƒç¼ºå¤±äº† LSN=11 åˆ°LSNï¼20 ä¹‹é—´çš„è®°å½•ã€‚å¦‚æœè¦é¿å…è¿™ç§æƒ…å†µï¼Œåªæœ‰åœ¨ä»»æ„èŠ‚ç‚¹æŒ‚æ‰çš„æ—¶å€™ï¼Œéƒ½é˜»å¡å†™è¯·æ±‚ã€‚ä½†è¿™æ ·å°±é™ä½äº†æ•´ä¸ªç³»ç»Ÿçš„ availabilityã€‚&lt;/p&gt;

&lt;p&gt;åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ&lt;strong&gt;ä¸€è‡´æ€§æ¨¡å‹æè¿°äº†å¦‚ä½•ä½¿ä¸åŒçš„ relicas ä¿æŒåŒæ­¥&lt;/strong&gt;ã€‚&lt;strong&gt;å¼ºä¸€è‡´æ€§&lt;/strong&gt;ä¿è¯äº†æ‰€æœ‰çš„ replicas éƒ½æ˜¯ä¸€è‡´çš„ï¼Œä½†è¦å®ç°å¼ºä¸€è‡´æ€§éœ€è¦ç‰ºç‰² availability æˆ–ç½‘ç»œåˆ†åŒºå®¹å¿æ€§ã€‚CAP ç†è®ºæå‡º &lt;strong&gt;Consistency&lt;/strong&gt;ã€&lt;strong&gt;Availability&lt;/strong&gt; å’Œ &lt;strong&gt;Partition tolerance&lt;/strong&gt; ä¸‰è€…æœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸¤é¡¹ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚ Dynamo è¿™æ ·çš„ç³»ç»Ÿï¼Œä½¿ç”¨&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;æ¨¡å‹æ¥æä¾›é«˜å¯ç”¨æ€§å’Œåˆ†åŒºå®¹å¿æ€§ã€‚Dynamo æ˜¯ä¸€ä¸ª AP ç³»ç»Ÿï¼Œç‰ºç‰²äº† Consistencyã€‚&lt;/p&gt;

&lt;p&gt;Spinnaker ä½¿ç”¨åŸºäº Paxos çš„åè®®æ¥å®ç°æ—¥å¿—æäº¤å’Œæ•…éšœæ¢å¤ã€‚Paxos ç¡®ä¿äº†ç³»ç»Ÿåœ¨å¤§å¤šæ•°èŠ‚ç‚¹å­˜æ´»çš„æƒ…å†µä¸‹å¯ä»¥è¿ä½œã€‚Spinnaker æ˜¯ä¸€ä¸ª CA ç³»ç»Ÿï¼Œç”¨äºå•ä¸€çš„ datacenterï¼Œå¹¶ä½¿ç”¨å¦å¤–çš„ replication strategy æ¥ä¿è¯è·¨ datacenter çš„å®¹é”™æ€§ã€‚ &lt;/p&gt;

&lt;h2&gt;Related work&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Two-phase commit (2PC)&lt;/strong&gt; æ˜¯ä¿æŒ replicas ä¸€è‡´çš„ä¸€ç§æ–¹å¼ã€‚ä½† 2PC æ›´åå‘äºå°†æ¯ä¸ª participant å½“ä½œä¸€ä¸ªç‹¬ç«‹çš„èµ„æºç®¡ç†è€…ï¼Œè€Œä¸ä»…ä»…æ˜¯ replicaã€‚ä½¿ç”¨ 2PC æ¥å®ç° replication æœ‰äº› overkillï¼Œå¹¶ä¸”è¿˜æœ‰ä¸å°‘ç¼ºé™·ã€‚é¦–å…ˆå•ä¸€èŠ‚ç‚¹å¤±è´¥ä¼šå¯¼è‡´ç³»ç»Ÿ abortã€‚å…¶æ¬¡æ¯ä¸ª transaction éƒ½å‘èµ· 2PC ä¼šå¯¼è‡´æå·®çš„æ€§èƒ½ã€‚æ¯æ¬¡ 2PC éƒ½éœ€è¦ä¸¤æ¬¡ç£ç›˜å¼ºåˆ¶å†™å’Œä¼ è¾“ä¸¤æ¡ä¿¡æ¯çš„æ—¶å»¶ã€‚æœ€åï¼Œ2PC åœ¨ coordinator æŒ‚æ‰æ—¶æ— æ³•è¿ä½œã€‚&lt;/p&gt;

&lt;p&gt;Amazon çš„ Dynamo é€šè¿‡&lt;strong&gt;åˆ†å¸ƒå¼æ—¶é’Ÿ&lt;/strong&gt;æ¥è§£å†³æœ€ç»ˆä¸€è‡´æ€§çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;Google çš„ Bigtable æä¾›äº†å¼ºä¸€è‡´æ€§ï¼Œå’Œ spinnaker ä¸åŒçš„æ˜¯ï¼ŒBigtable ä¾èµ– GFS æ¥å­˜å‚¨æ•°æ®å’Œæ—¥å¿—ï¼Œè¿˜æœ‰å®ç° replicationã€‚è¿™æ ·æ¯ä¸ª transaction çš„ workload å°±åŠ é‡äº†ï¼ˆéœ€è¦å’Œ gfs çš„ master äº¤äº’ï¼‰ã€‚&lt;/p&gt;

&lt;h2&gt;Architecture&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;Like Bigtable and PNUTS, Spinnaker distributes the rows of a table across its cluster using range partitioning. Each node is assigned a base key range, which is replicated on the next N âˆ’ 1 nodes (N = 3 by default).&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-3/illustration-2.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Each group of nodes involved in replicating a key range is denoted as a &lt;strong&gt;cohort&lt;/strong&gt;. Note that cohorts overlap.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ¯ä¸ªæ—¥å¿—ç”±ä¸€ä¸ª LSN å”¯ä¸€çš„æ ‡è®°ã€‚Commit queue æ˜¯åœ¨å†…å­˜çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜æ”¾ pending writesã€‚å†™æ“ä½œåªæœ‰åœ¨æ¥æ”¶åˆ°å¤§å¤šæ•° cohort çš„ ack ä¹‹åæ‰èƒ½æäº¤ã€‚åœ¨æ­¤ä¹‹å‰éƒ½å­˜æ”¾åœ¨ commit queue ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-3/illustration-3.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å·²ç»æäº¤çš„å†™æ“ä½œå­˜äº memtable ä¸­ï¼Œå¹¶è¢«å®šæœŸåˆ·åˆ°è¢«ç§°ä¸º SSTable çš„ immutable disk structureã€‚SSTable ä¼šè¢«å®šæœŸåˆå¹¶ä»¥æå‡è¯»æ€§èƒ½å¹¶åˆ é™¤ä¸éœ€è¦çš„æ•°æ®ã€‚&lt;/p&gt;

&lt;h2&gt;The replication protocol&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-3/illustration-4.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æäº¤ä¸€ä¸ªå†™æ“ä½œéœ€è¦ä¸‰æ¬¡æ—¥å¿—å¼ºåˆ¶å†™å’Œå››æ¡ä¿¡æ¯äº¤äº’ï¼Œä¸è¿‡å¤§å¤šæ•°æ“ä½œéƒ½æ˜¯é‡å çš„ï¼ˆå¯ä»¥å¹¶è¡Œï¼‰ã€‚&lt;/p&gt;

&lt;h2&gt;Recovery&lt;/h2&gt;

&lt;p&gt;Follower çš„æ¢å¤éœ€è¦ä¸¤ä¸ªé˜¶æ®µï¼š&lt;strong&gt;local recovery&lt;/strong&gt; å’Œ &lt;strong&gt;catch up&lt;/strong&gt;ã€‚å®šä¹‰ f.cmt è¡¨ç¤º follower çš„æœ€åä¸€ä¸ªæäº¤æ—¥å¿—çš„ LSNï¼Œf.lst è¡¨ç¤º follower çš„æœ€åä¸€ä¸ªæ—¥å¿—çš„ LSNã€‚Local recovery é˜¶æ®µï¼Œfollower ä»æœ€è¿‘ä¸€æ¬¡ checkpoint å¼€å§‹é‡æ–°æ‰§è¡Œæ—¥å¿—ç›´åˆ° f.cmtï¼Œä¹‹åè¿›å…¥ catch up é˜¶æ®µã€‚Catch up é˜¶æ®µï¼Œfollower é€šçŸ¥ leader è‡ªå·±çš„ f.cmtï¼Œleader å›å¤ f.cmt ä¹‹åæ‰€æœ‰çš„ commit writesã€‚Leader å°†ä¼šé˜»å¡æ‰€æœ‰æ–°çš„å†™è¯·æ±‚ç›´åˆ° follower å·²ç»è·Ÿä¸Šã€‚&lt;/p&gt;

&lt;p&gt;å½“ leader æŒ‚æ‰ï¼Œæ–°çš„ leader å°†è¢«é€‰ä¸¾ï¼Œå¹¶ä¸”ä¼šç¡®ä¿æ–°çš„ leader ä¼šåŒ…å«æ‰€æœ‰å·²æäº¤çš„å†™æ“ä½œã€‚åœ¨è€çš„ leader æŒ‚æ‰æ—¶ï¼Œæœ‰å¯èƒ½å…¶æäº¤çš„å†™æ“ä½œåœ¨æŸäº› followers è¿˜å¤„äº pending çš„çŠ¶æ€ã€‚æ–° leader å°†ä½¿ç”¨ä¸‹å›¾çš„ç®—æ³•ï¼Œç»§ç»­æäº¤æ‰€æœ‰ unresolved å†™æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-3/illustration-5.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;h2&gt;Leader election&lt;/h2&gt;

&lt;p&gt;é€‰ä¸¾ç®—æ³•å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-3/illustration-6.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;h1&gt;Dynamo&lt;/h1&gt;

&lt;h2&gt;Introduction&lt;/h2&gt;

&lt;p&gt;ä¸€ä¸ªç³»ç»Ÿçš„&lt;strong&gt;å¯é æ€§&lt;/strong&gt;å’Œ&lt;strong&gt;å¯æ‰©å±•æ€§&lt;/strong&gt;å–å†³äºå¦‚ä½•ç®¡ç†åº”ç”¨çŠ¶æ€ã€‚Amazon é‡‡ç”¨ä¸€ç§é«˜åº¦å»ä¸­å¿ƒåŒ–ï¼Œæ¾è€¦åˆï¼Œç”±æ•°ç™¾ä¸ªæœåŠ¡ç»„æˆçš„é¢å‘æœåŠ¡æ¶æ„ã€‚åœ¨è¿™ç§ç¯å¢ƒä¸­å°¤å…¶éœ€è¦ä¸€ä¸ªé«˜å¯ç”¨çš„å­˜å‚¨æŠ€æœ¯ã€‚&lt;/p&gt;

&lt;p&gt;Dynamo è¢«è®¾è®¡ç”¨äºç®¡ç†æœåŠ¡çŠ¶æ€ï¼Œè¦æ±‚å…·å¤‡éå¸¸é«˜çš„å¯é æ€§ï¼Œè€Œä¸”éœ€è¦ä¸¥æ ¼æ§åˆ¶&lt;strong&gt;å¯ç”¨æ€§ã€ä¸€è‡´æ€§ã€æˆæœ¬æ•ˆç›Šå’Œæ€§èƒ½&lt;/strong&gt;çš„ä¹‹é—´çš„æƒè¡¡ã€‚&lt;/p&gt;

&lt;p&gt;Amazon æœåŠ¡å¹³å°ä¸­è®¸å¤šæœåŠ¡åªéœ€è¦ä¸»é”®è®¿é—®æ•°æ®å­˜å‚¨ã€‚é€šå¸¸å…³ç³»æ•°æ®åº“æ¨¡å¼ä¼šå¯¼è‡´æ•ˆç‡ä½ä¸‹ï¼Œä¸”å¯æ‰©å±•æ€§å’Œå¯ç”¨æ€§ä¹Ÿæœ‰é™ã€‚Dynamo æä¾›äº†ä¸€ä¸ªç®€å•ä¸”å”¯ä¸€çš„ä¸»é”®æ¥å£ï¼Œä»¥æ»¡è¶³è¿™äº›åº”ç”¨çš„è¦æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;Dynamo ç»¼åˆä¸€äº›è‘—åçš„æŠ€æœ¯æ¥å®ç°å¯ä¼¸ç¼©æ€§å’Œå¯ç”¨æ€§ï¼šä½¿ç”¨&lt;strong&gt;ä¸€è‡´æ€§å“ˆå¸Œ&lt;/strong&gt;åˆ’åˆ†å’Œå¤åˆ¶æ•°æ®ï¼Œä¸€è‡´æ€§ç”±&lt;strong&gt;å¯¹è±¡ç‰ˆæœ¬&lt;/strong&gt;æ¥å®ç°ã€‚æ›´æ–°æ—¶å‰¯æœ¬ä¹‹é—´çš„ä¸€è‡´æ€§æ˜¯ç”±&lt;strong&gt;ç±»ä¼¼ä»²è£ï¼ˆquorum-likeï¼‰&lt;/strong&gt;çš„æŠ€æœ¯å’Œ&lt;strong&gt;å»ä¸­å¿ƒåŒ–çš„å‰¯æœ¬åŒæ­¥åè®®&lt;/strong&gt;æ¥ä¿è¯ã€‚Dynamo é‡‡ç”¨äº†&lt;strong&gt;åŸºäº gossip&lt;/strong&gt; çš„åˆ†å¸ƒå¼æ•…éšœæ£€æµ‹å’Œ membership protocolã€‚&lt;/p&gt;

&lt;h2&gt;System Assumptions and Requirements&lt;/h2&gt;

&lt;p&gt;Dynamo çš„ç›®æ ‡åº”ç”¨ç¨‹åºæ˜¯é€šè¿‡è¾ƒå¼±çš„ä¸€è‡´æ€§ï¼ˆACIDä¸­çš„â€œCâ€ï¼‰æ¥è¾¾åˆ°é«˜å¯ç”¨æ€§ã€‚Dynamo ä¸æä¾›ä»»ä½•æ•°æ®éš”ç¦»ï¼ˆACIDä¸­çš„â€œIâ€ï¼‰ä¿è¯ï¼Œåªå…è®¸å•ä¸€ä¸»é”®æ›´æ–°ã€‚&lt;/p&gt;

&lt;h2&gt;Design Considerations&lt;/h2&gt;

&lt;p&gt;å¯¹äºå®¹æ˜“å‡ºç°æœåŠ¡å™¨å’Œç½‘ç»œæ•…éšœçš„ç³»ç»Ÿï¼Œå¯ä½¿ç”¨&lt;strong&gt;ä¹è§‚å¤åˆ¶&lt;/strong&gt;æ¥æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œæ•°æ®å˜åŒ–å…è®¸åœ¨åå°å‘é€åˆ°å‰¯æœ¬ï¼ŒåŒæ—¶å®¹å¿ç½‘ç»œæ–­å¼€ã€‚è¿™ç§åšæ³•å¸¦æ¥çš„æŒ‘æˆ˜æ˜¯å¦‚ä½•æ£€æµ‹å’Œåè°ƒç”±æ­¤å¼•å‘çš„å†²çªã€‚åè°ƒçš„è¿‡ç¨‹å¼•å…¥äº†ä¸¤ä¸ªé—®é¢˜ï¼š&lt;strong&gt;ä½•æ—¶åè°ƒ&lt;/strong&gt;ä»¥åŠ&lt;strong&gt;è°è´Ÿè´£åè°ƒ&lt;/strong&gt;ã€‚Dynamo è¢«è®¾è®¡æˆ&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§ï¼ˆeventually consistentï¼‰&lt;/strong&gt;çš„æ•°æ®å­˜å‚¨ï¼Œæ‰€æœ‰çš„æ›´æ–°æ“ä½œæœ€ç»ˆä¼šåˆ†å‘åˆ°æ‰€æœ‰å‰¯æœ¬ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ªé‡è¦çš„è®¾è®¡è€ƒè™‘çš„å› ç´ æ˜¯ä½•æ—¶å»åè°ƒæ›´æ–°æ“ä½œå†²çªï¼Œä¾‹å¦‚æ˜¯åœ¨è¯»è¿˜æ˜¯å†™è¿‡ç¨‹ä¸­åè°ƒå†²çªã€‚è®¸å¤šä¼ ç»Ÿ data store åœ¨å†™çš„è¿‡ç¨‹ä¸­åè°ƒå†²çªï¼Œä»è€Œä¿æŒè¯»çš„å¤æ‚åº¦ç›¸å¯¹ç®€å•ã€‚å¦ä¸€æ–¹é¢ï¼Œ&lt;strong&gt;Dynamo çš„ç›®æ ‡æ˜¯â€œæ°¸è¿œå¯å†™â€&lt;/strong&gt;ã€‚å¯¹äº Amazon è®¸å¤šæœåŠ¡æ¥è®²ï¼Œæ‹’ç»å®¢æˆ·çš„æ›´æ–°æ“ä½œå¯èƒ½å¯¼è‡´ç³Ÿç³•çš„å®¢æˆ·ä½“éªŒã€‚è¿™è¿«ä½¿æˆ‘ä»¬&lt;strong&gt;å°†åè°ƒå†²çªçš„å¤æ‚æ€§æ¨ç»™â€œè¯»â€&lt;/strong&gt;ï¼Œä»¥ç¡®ä¿â€œå†™â€æ°¸è¿œä¸ä¼šæ‹’ç»ã€‚&lt;/p&gt;

&lt;p&gt;å…¶ä»–é‡è¦çš„è®¾è®¡åŸåˆ™ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;å¢é‡çš„å¯æ‰©å±•æ€§ï¼ˆIncremental scalabilityï¼‰&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Dynamo éœ€è¦èƒ½å¤Ÿæ°´å¹³æ‰©å±•ä¸€å°å­˜å‚¨ä¸»æœºï¼Œè€Œå¯¹ç³»ç»Ÿæ“ä½œè€…å’Œç³»ç»Ÿæœ¬èº«çš„å½±å“å¾ˆå°ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;å¯¹ç§°æ€§ï¼ˆSymmetryï¼‰&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ¯ä¸ª Dynamo èŠ‚ç‚¹åº”è¯¥æœ‰ä¸€æ ·çš„è´£ä»»ï¼Œä¸åº”è¯¥å­˜åœ¨æœ‰åŒºåˆ«æˆ–å…·å¤‡ç‰¹æ®Šçš„è§’è‰²æˆ–é¢å¤–çš„è´£ä»»çš„èŠ‚ç‚¹ã€‚æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œå¯¹ç§°æ€§(symmetry)ç®€åŒ–äº†ç³»ç»Ÿçš„é…ç½®å’Œç»´æŠ¤ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;å»ä¸­å¿ƒåŒ–ï¼ˆDecentralizationï¼‰&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ˜¯å¯¹å¯¹ç§°æ€§çš„å»¶ä¼¸ï¼Œè®¾è®¡åº”é‡‡ç”¨æœ‰åˆ©äºå»ä¸­å¿ƒåŒ–è€Œä¸æ˜¯é›†ä¸­æ§åˆ¶çš„æŠ€æœ¯ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;å¼‚è´¨æ€§ï¼ˆHeterogeneityï¼‰&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿåˆ©ç”¨å…¶è¿è¡Œæ‰€åœ¨çš„åŸºç¡€è®¾æ–½çš„å¼‚è´¨æ€§ã€‚ä¾‹å¦‚ï¼Œè´Ÿè½½çš„åˆ†é…å¿…é¡»ä¸å„ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨çš„èƒ½åŠ›æˆæ¯”ä¾‹ã€‚è¿™æ ·å°±å¯ä»¥ä¸€æ¬¡åªå¢åŠ ä¸€ä¸ªé«˜å¤„ç†èƒ½åŠ›çš„èŠ‚ç‚¹ï¼Œè€Œæ— éœ€ä¸€æ¬¡å‡çº§æ‰€æœ‰çš„ä¸»æœºã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Partitioning Algorithm&lt;/h2&gt;

&lt;p&gt;Dynamo çš„å…³é”®è®¾è®¡è¦æ±‚ä¹‹ä¸€æ˜¯&lt;strong&gt;å¢é‡å¯æ‰©å±•æ€§&lt;/strong&gt;ï¼Œè¿™éœ€è¦ä¸€ä¸ªæœºåˆ¶æ¥å°†æ•°æ®åŠ¨æ€åˆ’åˆ†åˆ°ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹ä¸Šã€‚Dynamo çš„åˆ†åŒºæ–¹æ¡ˆä¾èµ–äºä¸€è‡´å“ˆå¸Œã€‚&lt;strong&gt;ä¸€è‡´æ€§å“ˆå¸Œçš„ä¸»è¦ä¼˜ç‚¹æ˜¯èŠ‚ç‚¹çš„æ–°å¢æˆ–å‡å°‘åªå½±å“å…¶æœ€ç›´æ¥çš„é‚»å±…&lt;/strong&gt;ï¼Œè€Œå¯¹å…¶ä»–èŠ‚ç‚¹æ²¡å½±å“ã€‚&lt;/p&gt;

&lt;p&gt;åŸºæœ¬çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å­˜åœ¨ä¸€äº›ä¸è¶³ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç¯ä¸Šâ€‹â€‹çš„èŠ‚ç‚¹éšæœºåˆ†é…ä½ç½®å¯¼è‡´æ•°æ®å’Œè´Ÿè½½çš„ä¸å‡åŒ€åˆ†å¸ƒ&lt;/li&gt;
&lt;li&gt;åŸºæœ¬ç®—æ³•æ— æ³•æ»¡è¶³èŠ‚ç‚¹æ€§èƒ½çš„&lt;strong&gt;å¼‚è´¨æ€§ï¼ˆHeterogeneityï¼‰&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œ&lt;strong&gt;Dynamo å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹&lt;/strong&gt;ï¼šæ¯ä¸ªèŠ‚ç‚¹è¢«åˆ†é…åˆ°ç¯ä¸Šå¤šç‚¹ï¼Œè€Œä¸æ˜¯åªæ˜ å°„åˆ°ç¯ä¸Šçš„ä¸€ä¸ªå•ç‚¹ã€‚ç³»ç»Ÿä¸­æ¯ä¸ªèŠ‚ç‚¹å¯¹å¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹è´Ÿè´£ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½å°†å‡åŒ€åœ°åˆ†æ•£ç»™å…¶ä½™çš„å¯ç”¨èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;å½“ä¸€ä¸ªèŠ‚ç‚¹å†æ¬¡å¯ç”¨ï¼Œæˆ–è€…æ˜¯æ–°æ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼Œthe newly available node accepts a roughly equivalent amount of load from each of the other available nodes. &lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªèŠ‚ç‚¹è´Ÿè´£çš„è™šæ‹ŸèŠ‚ç‚¹æ•°ç›®ç”±å…¶å¤„ç†èƒ½åŠ›æ¥å†³å®šï¼ˆheterogeneityï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Replication&lt;/h2&gt;

&lt;p&gt;æ¯ä¸ªé”® K è¢«åˆ†é…åˆ°ä¸€ä¸ªåè°ƒå™¨èŠ‚ç‚¹ã€‚åè°ƒå™¨èŠ‚ç‚¹è´Ÿè´£å…¶ç®¡è¾–èŒƒå›´å†…çš„æ•°æ®çš„å¤åˆ¶ã€‚é™¤äº†åœ¨æœ¬åœ°å­˜å‚¨æ¯ä¸ª key å¤–ï¼Œåè°ƒå™¨èŠ‚ç‚¹ä¹Ÿå°† key å¤åˆ¶åˆ°ç¯ä¸Šé¡ºæ—¶é’ˆæ–¹å‘çš„ N-1 åç»§èŠ‚ç‚¹ã€‚ç³»ç»Ÿä¸­æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç¯ä¸Šçš„ä»å…¶è‡ªå·±åˆ°ç¬¬ N ä¸ªå‰ç»§èŠ‚ç‚¹é—´çš„åŒºåŸŸã€‚&lt;/p&gt;

&lt;p&gt;è´Ÿè´£å­˜å‚¨ä¸€ä¸ªç‰¹å®šçš„é”®çš„èŠ‚ç‚¹åˆ—è¡¨è¢«ç§°ä¸º&lt;strong&gt;é¦–é€‰åˆ—è¡¨&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2&gt;Data Versioning&lt;/h2&gt;

&lt;p&gt;Dynamo æä¾›æœ€ç»ˆä¸€è‡´æ€§ï¼Œå…è®¸æ›´æ–°æ“ä½œå¼‚æ­¥åœ°ä¼ æ’­åˆ°æ‰€æœ‰å‰¯æœ¬ã€‚put è°ƒç”¨å¯èƒ½åœ¨æ›´æ–°æ“ä½œè¢«æ‰€æœ‰çš„å‰¯æœ¬æ‰§è¡Œä¹‹å‰å°±è¿”å›ç»™è°ƒç”¨è€…ï¼Œè¿™ä¼šå¯¼è‡´åœ¨éšåçš„ get æ“ä½œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªä¸æ˜¯æœ€æ–°çš„å¯¹è±¡ã€‚&lt;/p&gt;

&lt;p&gt;Dynamo å°†æ¯æ¬¡æ•°æ®ä¿®æ”¹çš„ç»“æœå½“ä½œä¸€ä¸ªå…¨æ–°ä¸”ä¸å¯ä¿®æ”¹çš„æ•°æ®ç‰ˆæœ¬ã€‚å®ƒå…è®¸åŒä¸€æ—¶é—´å­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„å¯¹è±¡ã€‚å¤§å¤šæ•°æƒ…å†µï¼Œæ–°ç‰ˆæœ¬åŒ…æ‹¬äº†è€çš„ç‰ˆæœ¬ï¼Œç³»ç»Ÿè‡ªå·±å¯ä»¥å†³å®šæƒå¨ç‰ˆæœ¬ï¼ˆè¯­æ³•åè°ƒ syntactic reconciliationï¼‰ã€‚ç„¶è€Œï¼Œåœ¨å‡ºç°å¤±è´¥ä¸”ä¼´éšå¹¶å‘æ›´æ–°æ“ä½œçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´å¯¹è±¡çš„ç‰ˆæœ¬å†²çªã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ— æ³•åè°ƒï¼Œéœ€è¦ç”±å®¢æˆ·ç«¯å¿…é¡»æ‰§è¡Œåè°ƒï¼Œå°†å¤šä¸ªåˆ†æ”¯æ¼”åŒ–åçš„æ•°æ®æŠ˜å æˆä¸€ä¸ªåˆå¹¶çš„ç‰ˆæœ¬ï¼ˆè¯­ä¹‰åè°ƒ semantic reconciliationï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;Dynamo ä½¿ç”¨&lt;strong&gt;çŸ¢é‡æ—¶é’Ÿ&lt;/strong&gt;æ¥æ•æ‰åŒä¸€å¯¹è±¡ä¸åŒç‰ˆæœ¬çš„å› æœå…³ç³»ã€‚çŸ¢é‡æ—¶é’Ÿå®é™…ä¸Šæ˜¯ä¸€ç³»åˆ—ï¼ˆèŠ‚ç‚¹ï¼Œè®¡æ•°å™¨ï¼‰å¯¹ã€‚ä¸€ä¸ªçŸ¢é‡æ—¶é’Ÿå’Œæ¯ä¸ªå¯¹è±¡çš„æ¯ä¸ªç‰ˆæœ¬ç›¸å…³è”ã€‚é€šè¿‡å®¡æŸ¥å‘é‡æ—¶é’Ÿï¼Œå¯ä»¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„ä¸¤ä¸ªç‰ˆæœ¬æ˜¯å¹³è¡Œæˆ–å› æœé¡ºåºã€‚&lt;strong&gt;å¦‚æœç¬¬ä¸€ä¸ªæ—¶é’Ÿå¯¹è±¡ä¸Šçš„è®¡æ•°å™¨å°äºæˆ–ç­‰äºç¬¬äºŒä¸ªæ—¶é’Ÿå¯¹è±¡ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ˜¯ç¬¬äºŒä¸ªçš„ç¥–å…ˆ&lt;/strong&gt;ï¼Œå¯ä»¥è¢«å¿½ç•¥ã€‚å¦åˆ™è¿™ä¸¤ä¸ªå˜åŒ–æ˜¯å†²çªçš„ï¼Œéœ€è¦åè°ƒã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ Dynamo ä¸­ï¼Œå½“å®¢æˆ·ç«¯æ›´æ–°ä¸€ä¸ªå¯¹è±¡æ—¶å¿…é¡»æŒ‡å®šå®ƒæ­£è¦æ›´æ–°å“ªä¸ªç‰ˆæœ¬ï¼Œè¿™é€šè¿‡ä»æ—©æœŸçš„è¯»æ“ä½œä¸­è·å¾—çš„ä¸Šä¸‹æ–‡å¯¹è±¡æ¥æŒ‡å®šã€‚å®ƒåŒ…å«äº†å‘é‡æ—¶é’Ÿä¿¡æ¯ã€‚å½“å¤„ç†ä¸€ä¸ªè¯»è¯·æ±‚ï¼Œå¦‚æœ Dynamo è®¿é—®åˆ°å¤šä¸ªä¸èƒ½è¯­æ³•åè°ƒçš„åˆ†æ”¯ï¼Œå®ƒå°†è¿”å›å¤„äºåˆ†æ”¯å¶å­çš„æ‰€æœ‰å¯¹è±¡ã€‚&lt;/p&gt;

&lt;h2&gt;Execution of get () and put () operations&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;å¤„ç†è¯»æˆ–å†™æ“ä½œçš„èŠ‚ç‚¹è¢«ç§°ä¸ºåè°ƒå‘˜ã€‚&lt;/strong&gt;é€šå¸¸ï¼Œè¿™æ˜¯é¦–é€‰åˆ—è¡¨ä¸­å‰ N ä¸ªèŠ‚ç‚¹ä¸­çš„ç¬¬ä¸€ä¸ªã€‚å¦‚æœè¯·æ±‚æ˜¯é€šè¿‡ load balancer æ”¶åˆ°ï¼Œè®¿é—® key çš„è¯·æ±‚å¯èƒ½è¢«è·¯ç”±åˆ°ç¯ä¸Šä»»ä¸€èŠ‚ç‚¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸æ˜¯è¯·æ±‚çš„ key çš„é¦–é€‰åˆ—è¡¨ä¸­å‰ N ä¸ªèŠ‚ç‚¹ä¹‹ä¸€ï¼Œè¯¥èŠ‚ç‚¹å°†è¯·æ±‚è½¬å‘åˆ°é¦–é€‰åˆ—è¡¨å‰ N ä¸ªä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†ä¿æŒå‰¯æœ¬çš„ä¸€è‡´æ€§ï¼ŒDynamo ä½¿ç”¨çš„ä¸€è‡´æ€§åè®®ç±»ä¼¼äºä»²è£ï¼ˆQuorum NRW æ¨¡å‹ï¼‰ã€‚è¯¥åè®®æœ‰ä¸¤ä¸ªå…³é”®é…ç½®å€¼ï¼šR å’Œ Wã€‚R is the minimum number of nodes that must participate in a successful read operation. W is the minimum number of nodes that must participate in a successful write operation. N åˆ™æ˜¯æ•°æ®çš„å‰¯æœ¬æ•°é‡ã€‚è®¾å®š R å’Œ Wï¼Œä½¿å¾— R + W &amp;gt; Nï¼Œå³&lt;strong&gt;è¯»æ“ä½œå‰¯æœ¬åŠ ä¸Šå†™æ“ä½œå‰¯æœ¬å¿…é¡»å¤§äºæ•°æ®çš„å‰¯æœ¬é‡&lt;/strong&gt;ã€‚åœ¨æ­¤æ¨¡å‹ä¸­ï¼Œä¸€ä¸ª get æˆ–è€… put æ“ä½œå»¶æ—¶æ˜¯ç”±æœ€æ…¢çš„ R æˆ– W å‰¯æœ¬å†³å®šçš„ã€‚å› æ­¤ R å’Œ W é€šå¸¸é…ç½®ä¸ºå°äº ï¼®ï¼Œä»¥å‡å°æ—¶å»¶ã€‚&lt;/p&gt;

&lt;p&gt;å½“æ”¶åˆ°å¯¹ key çš„ put è¯·æ±‚æ—¶ï¼Œåè°ƒå‘˜ä¸ºæ–°ç‰ˆæœ¬ç”Ÿæˆå‘é‡æ—¶é’Ÿå¹¶å†™å…¥æœ¬åœ°ï¼Œç„¶åå°†æ–°ç‰ˆæœ¬ï¼ˆå¸¦ä¸Šå‘é‡æ—¶é’Ÿï¼‰å‘é€ç»™é¦–é€‰åˆ—è¡¨ä¸­çš„å‰ ï¼® ä¸ªå¯è¾¾èŠ‚ç‚¹ã€‚å¦‚æœè‡³å°‘ ï¼·-1 ä¸ªèŠ‚ç‚¹è¿”å›äº†å“åº”ï¼Œé‚£ä¹ˆè¿™ä¸ªå†™æ“ä½œè¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚&lt;/p&gt;

&lt;p&gt;åŒæ ·ï¼Œå¯¹äº get è¯·æ±‚ï¼Œåè°ƒå‘˜ä»é¦–é€‰åˆ—è¡¨ä¸­å‰ ï¼® ä¸ªå¯è¾¾èŠ‚ç‚¹å¤„è¯·æ±‚è¯¥ key æ‰€æœ‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œç„¶åç­‰å¾… ï¼² ä¸ªå“åº”ï¼Œç„¶åè¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚å¦‚æœåè°ƒå‘˜æ”¶åˆ°å¤šä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œå®ƒè¿”å›æ‰€æœ‰å®ƒè®¤ä¸ºæ²¡æœ‰å› æœå…³ç³»çš„ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;h2&gt;Handling Failures: Hinted Handoff&lt;/h2&gt;

&lt;p&gt;Dynamo å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„ä»²è£æ–¹å¼ï¼Œåœ¨æœåŠ¡å™¨æ•…éšœå’Œç½‘ç»œåˆ†è£‚çš„æƒ…å†µä¸‹å°†ä¸å¯ç”¨ã€‚å› æ­¤ Dynamo ä½¿ç”¨äº†&lt;strong&gt;â€œé©¬è™ä»²è£â€&lt;/strong&gt;æœºåˆ¶ï¼Œæ‰€æœ‰çš„è¯»ï¼Œå†™æ“ä½œæ˜¯ç”±é¦–é€‰åˆ—è¡¨ä¸Šçš„å‰ N ä¸ªå¥åº·çš„èŠ‚ç‚¹æ‰§è¡Œçš„ï¼Œå®ƒä»¬å¯èƒ½ä¸æ€»æ˜¯åœ¨æ•£åˆ—ç¯ä¸Šé‡åˆ°çš„é‚£å‰ N ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœå†™æ“ä½œè¿‡ç¨‹ä¸­èŠ‚ç‚¹ A æš‚æ—¶æŒ‚æ‰æˆ–ä¸å¯è¾¾ï¼Œæœ¬æ¥å‘å¾€ A çš„å‰¯æœ¬ç°åœ¨è¢«å‘é€åˆ°èŠ‚ç‚¹ Dã€‚å‘é€åˆ° D çš„å‰¯æœ¬å°†åœ¨å…¶åŸæ•°æ®ä¸­è¡¨æ˜ A èŠ‚ç‚¹æ‰æ˜¯è¯¥å‰¯æœ¬çš„é¢„æœŸæ¥æ”¶è€…ã€‚æ¥æ”¶åˆ°çš„æš—ç¤ºå‰¯æœ¬å°†è¢«ä¿å­˜åœ¨å•ç‹¬çš„æœ¬åœ°å­˜å‚¨ä¸­å®šæœŸæ‰«æã€‚åœ¨æ£€æµ‹åˆ°äº† A å·²ç»å¤è‹ï¼ŒD ä¼šå°è¯•å‘é€å‰¯æœ¬åˆ° Aã€‚ä¸€æ—¦ä¼ é€æˆåŠŸï¼ŒD å¯å°†æ•°æ®ä»æœ¬åœ°å­˜å‚¨ä¸­åˆ é™¤ï¼Œä¸ä¼šé™ä½ç³»ç»Ÿä¸­çš„å‰¯æœ¬æ€»æ•°ã€‚&lt;/p&gt;

&lt;p&gt;æ•°æ®ä¸­å¿ƒæœ‰å¯èƒ½å› ä¸ºæ–­ç”µã€å†·å´è£…ç½®æ•…éšœã€ç½‘ç»œæ•…éšœæˆ–è‡ªç„¶ç¾å®³å‘ç”Ÿæ•…éšœã€‚Dynamo å°†æ¯ä¸ªå¯¹è±¡è·¨å¤šä¸ªæ•°æ®ä¸­å¿ƒåœ°è¿›è¡Œå¤åˆ¶ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œæ¯ä¸ªä¸ª key çš„é¦–é€‰åˆ—è¡¨çš„åˆ†å¸ƒåœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒã€‚è¿™äº›æ•°æ®ä¸­å¿ƒé€šè¿‡é«˜é€Ÿç½‘ç»œè¿æ¥ã€‚è¿™ç§&lt;strong&gt;è·¨å¤šä¸ªæ•°æ®ä¸­å¿ƒçš„å¤åˆ¶æ–¹æ¡ˆ&lt;/strong&gt;ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¤„ç†æ•´ä¸ªæ•°æ®ä¸­å¿ƒæ•…éšœã€‚&lt;/p&gt;

&lt;h2&gt;Handling permanent failures: Replica synchronization&lt;/h2&gt;

&lt;p&gt;Dynamo å®ç°äº†&lt;strong&gt;åç†µï¼ˆanti-entropy æˆ–å‰¯æœ¬åŒæ­¥ï¼‰åè®®&lt;/strong&gt;æ¥ä¿æŒå‰¯æœ¬åŒæ­¥ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†æ›´å¿«åœ°æ£€æµ‹å‰¯æœ¬ä¹‹é—´çš„ä¸ä¸€è‡´æ€§å¹¶å‡å°‘ä¼ è¾“çš„æ•°æ®é‡ï¼Œ&lt;strong&gt;Dynamo ä½¿ç”¨ MerkleTree&lt;/strong&gt;ã€‚MerkleTree æ˜¯ä¸€ä¸ªå“ˆå¸Œæ ‘ï¼Œå…¶å¶å­æ˜¯å„ä¸ª key çš„å“ˆå¸Œå€¼ï¼Œçˆ¶èŠ‚ç‚¹ä¸ºå…¶å„è‡ªå­©å­èŠ‚ç‚¹çš„å“ˆå¸Œã€‚MerkleTree çš„ä¸»è¦ä¼˜ç‚¹æ˜¯æ ‘çš„æ¯ä¸ªåˆ†æ”¯å¯ä»¥ç‹¬ç«‹åœ°æ£€æŸ¥ã€‚å¦å¤–ï¼ŒMerkleTree æœ‰åŠ©äºå‡å°‘ä¸ºæ£€æŸ¥å‰¯æœ¬é—´ä¸ä¸€è‡´è€Œä¼ è¾“çš„æ•°æ®çš„å¤§å°ã€‚å¦‚æœä¸¤æ ‘çš„æ ¹å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆæ ‘çš„å¶èŠ‚ç‚¹å€¼ä¹Ÿç›¸ç­‰ï¼Œè¯¥èŠ‚ç‚¹ä¸éœ€è¦åŒæ­¥ã€‚&lt;/p&gt;

&lt;h2&gt;Membership and Failure Detection&lt;/h2&gt;

&lt;p&gt;å»ä¸­å¿ƒåŒ–çš„æ•…éšœæ£€æµ‹åè®®ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ Gossip å¼çš„åè®®ï¼Œä½¿ç³»ç»Ÿä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥äº†è§£å…¶ä»–èŠ‚ç‚¹åŠ å…¥æˆ–ç¦»å¼€ã€‚è¯¦ç»†å¯ä»¥å‚è€ƒè®ºæ–‡ã€ŠOn
scalable and efficient distributed failure detectorsã€‹&lt;/p&gt;

&lt;h2&gt;Ensuring Uniform Load distribution&lt;/h2&gt;

&lt;p&gt;éšç€æ—¶é—´å’Œè´Ÿè½½åˆ†å¸ƒçš„å½±å“ï¼ŒDynamo çš„åˆ’åˆ†æ–¹æ¡ˆä¹Ÿé€æ¸æ¼”åŒ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-3/illustration-7.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç­–ç•¥ 1ï¼šæ¯ä¸ªèŠ‚ç‚¹éšæœºåˆ†é… T ä¸ª token ï¼Œä¸”åŸºäº token å€¼è¿›è¡Œåˆ†å‰²&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨è¿™ä¸€ç­–ç•¥ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ã€‚é¦–å…ˆï¼Œå½“æ–°çš„èŠ‚ç‚¹åŠ å…¥ç³»ç»Ÿæ—¶ï¼Œå®ƒéœ€è¦ä»å…¶ä»–èŠ‚ç‚¹ä¸Šâ€œçªƒå–â€å…¶è´Ÿè´£çš„ key rangesã€‚ç„¶è€Œï¼Œè¿™äº›éœ€è¦ç§»äº¤key ranges ç»™æ–°èŠ‚ç‚¹çš„èŠ‚ç‚¹å¿…é¡»æ‰«æä»–ä»¬çš„æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨ã€‚ç¬¬äºŒï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥/ç¦»å¼€ç³»ç»Ÿï¼Œè®¸å¤šèŠ‚ç‚¹çš„ key range å‘ç”Ÿå˜åŒ–ï¼ŒMertkleTree éœ€è¦é‡æ–°è®¡ç®—ï¼Œåœ¨ç”Ÿäº§ç³»ç»Ÿä¸Šï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªç®€å•çš„æ“ä½œã€‚æœ€åï¼Œç”±äº key range çš„éšæœºæ€§ï¼Œæ²¡æœ‰ç®€å•çš„åŠæ³•ä¸ºæ•´ä¸ª key space åšå¿«ç…§ï¼Œè¿™ä½¿å¾—å½’æ¡£è¿‡ç¨‹å˜å¾—å¤æ‚ã€‚åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œå½’æ¡£æ•´ä¸ª key space éœ€è¦åˆ†åˆ«æ£€ç´¢æ¯ä¸ªèŠ‚ç‚¹çš„ keyï¼Œè¿™æ˜¯éå¸¸ä½æ•ˆçš„ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªç­–ç•¥çš„æ ¹æœ¬é—®é¢˜æ˜¯ï¼Œ&lt;strong&gt;æ•°æ®åˆ’åˆ†&lt;/strong&gt;å’Œ&lt;strong&gt;æ•°æ®å®‰ç½®&lt;/strong&gt;äº¤ç»‡åœ¨ä¸€èµ·ã€‚ &lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç­–ç•¥ 2ï¼šæ¯ä¸ªèŠ‚ç‚¹éšæœºåˆ†é… T ä¸ª tokenï¼Œæ¯ä¸ªåˆ†åŒºåŒç­‰å¤§å°&lt;/p&gt;

&lt;p&gt;åœ¨æ­¤ç­–ç•¥ä¸­ï¼Œå“ˆå¸Œç©ºé—´è¢«åˆ’åˆ†ä¸º Q ä¸ªåŒæ ·å¤§å°çš„åˆ†åŒº/èŒƒå›´ï¼Œæ¯ä¸ªèŠ‚ç‚¹éšæœºåˆ†é… T ä¸ª tokenã€‚é€šå¸¸è®¾ç½® Q ä½¿å¾— Q &amp;gt;&amp;gt; N ä¸” Q &amp;gt;&amp;gt; S * Tï¼Œå…¶ä¸­ S ä¸ºç³»ç»Ÿçš„èŠ‚ç‚¹ä¸ªæ•°ã€‚åœ¨è¿™ä¸€ç­–ç•¥ä¸­ï¼Œtoken åªæ˜¯ç”¨æ¥æ„é€ æ˜ å°„å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†å“ˆå¸Œç©ºé—´çš„å€¼æ˜ å°„åˆ°ä¸€ä¸ªæœ‰åºåˆ—çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œè€Œä¸å†³å®šåˆ†åŒºã€‚A partition is placed on the first N unique nodes that are encountered while walking the consistent hashing ring clockwise from the end of the partition. &lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç­–ç•¥ 3ï¼šæ¯ä¸ªèŠ‚ç‚¹åˆ†é… Q/S ä¸ª tokenï¼Œæ¯ä¸ªåˆ†åŒºåŒç­‰å¤§å°&lt;/p&gt;

&lt;p&gt;Each node is assigned Q/S tokens where S is the number of nodes in the system. When a node leaves the system, its tokens are randomly distributed to the remaining nodes such that these properties are preserved. Similarly, when a node joins the system it &amp;quot;steals&amp;quot; tokens from nodes in the system in a way that preserves these properties. &lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç›¸å¯¹äºç­–ç•¥ 1ï¼Œç­–ç•¥ 3 è¾¾åˆ°æ›´å¥½çš„æ•ˆç‡ï¼Œæ¯ä¸ªèŠ‚ç‚¹éœ€è¦ç»´æŒçš„ä¿¡æ¯çš„å¤§å°é™ä½äº†ä¸‰ä¸ªæ•°é‡çº§ã€‚è™½ç„¶å­˜å‚¨ä¸æ˜¯ä¸€ä¸ªä¸»è¦é—®é¢˜ï¼Œä½†èŠ‚ç‚¹é—´å‘¨æœŸåœ°gossip æˆå‘˜ä¿¡æ¯ï¼Œå› æ­¤å°½å¯èƒ½ç®€åŒ–ä¿¡æ¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç­–ç•¥ 3 æ›´æ˜“äºéƒ¨ç½²ï¼Œç†ç”±å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ›´å¿«çš„ bootstrapping/recovery&lt;/p&gt;

&lt;p&gt;ç”±äºåˆ†åŒºèŒƒå›´æ˜¯å›ºå®šçš„ï¼Œå®ƒä»¬å¯ä»¥ä¿å­˜åœ¨å•ç‹¬çš„æ–‡ä»¶ï¼Œè¿™æ„å‘³ç€è½¬ç§»åˆ†åŒºä»…éœ€è¦ç®€å•åœ°è½¬ç§»æ–‡ä»¶ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ˜“äºå½’æ¡£&lt;/p&gt;

&lt;p&gt;å¯¹æ•°æ®é›†å®šæœŸå½’æ¡£æ˜¯ Amazon å­˜å‚¨æœåŠ¡çš„å¼ºåˆ¶æ€§è¦æ±‚ã€‚ç­–ç•¥ 3 å½’æ¡£æ•´ä¸ªæ•°æ®é›†å¾ˆç®€å•ï¼Œå› ä¸ºåˆ†åŒºçš„æ–‡ä»¶å¯ä»¥è¢«åˆ†åˆ«å½’æ¡£ã€‚ç›¸åï¼Œç­–ç•¥1 ä¸­ token æ˜¯éšæœºé€‰å–çš„ï¼Œå½’æ¡£å­˜å‚¨çš„æ•°æ®éœ€è¦åˆ†åˆ«æ£€ç´¢å„ä¸ªèŠ‚ç‚¹çš„ keyï¼Œè¿™é€šå¸¸æ˜¯ä½æ•ˆå’Œç¼“æ…¢çš„ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Sat, 02 Dec 2017 15:19:31 +0800</pubDate>
        <link>http://masutangu.com/2017/12/mit-6824-note-3/</link>
        <guid isPermaLink="true">http://masutangu.com/2017/12/mit-6824-note-3/</guid>
        
        
        <category>è¯»ä¹¦ç¬”è®°</category>
        
      </item>
    
      <item>
        <title>MIT 6.824 å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰</title>
        <description>&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« æ˜¯å¯¹ &lt;a href=&quot;https://pdos.csail.mit.edu/6.824/schedule.html&quot;&gt;MIT 6.824&lt;/a&gt; è¯¾ç¨‹çš„å­¦ä¹ ç¬”è®°ã€‚&lt;/p&gt;

&lt;h1&gt;Raft&lt;/h1&gt;

&lt;h2&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Raft æ˜¯ç”¨äºç®¡ç†å¤åˆ¶æ—¥å¿—çš„ä¸€è‡´æ€§ç®—æ³•ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼ŒRaft å°†ä¸€è‡´æ€§ç®—æ³•åˆ†è§£ä¸ºå‡ ä¸ªå…³é”®æ¨¡å—ï¼š&lt;strong&gt;Leader é€‰ä¸¾&lt;/strong&gt;ã€&lt;strong&gt;æ—¥å¿—å¤åˆ¶&lt;/strong&gt;å’Œ&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;ï¼ŒåŒæ—¶&lt;strong&gt;é€šè¿‡æ›´å¼ºçš„ä¸€è‡´æ€§æ¥å‡å°‘éœ€è¦è€ƒè™‘çš„çŠ¶æ€&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€è‡´æ€§ç®—æ³•å…è®¸ä¸€ç»„æœºå™¨åƒä¸€ä¸ªæ•´ä½“ä¸€æ ·å·¥ä½œï¼Œå³ä½¿å…¶ä¸­ä¸€äº›æœºå™¨æŒ‚æ‰ã€‚ä¸€è‡´æ€§ç®—æ³•åœ¨æ„å»ºå¤§è§„æ¨¡å¯ä¿¡èµ–ç³»ç»Ÿä¸­æ‰®æ¼”é‡è¦çš„è§’è‰²ã€‚&lt;/p&gt;

&lt;p&gt;Raft å’Œè®¸å¤šä¸€è‡´æ€§ç®—æ³•ç±»ä¼¼ï¼Œä½†ä»–ä¹Ÿæœ‰è‡ªå·±çš„æ–°ç‰¹æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Strong leader&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Raft ä½¿ç”¨æ¯”å…¶ä»–ä¸€è‡´æ€§ç®—æ³•æ›´å¼ºçš„ leadership å½¢å¼ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œlog entries åªèƒ½ä» leader å‘å¾€å…¶ä»– serverã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Leader election&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Raft ä½¿ç”¨éšæœº timer æ¥é€‰ä¸¾ leaderï¼Œç®€æ´åœ°è§£å†³äº†å†²çªçš„é—®é¢˜ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Membership changes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Raft ä½¿ç”¨ joint consensus çš„æ–¹å¼æ¥å¤„ç†æˆå‘˜å˜åŒ–çš„é—®é¢˜ã€‚åœ¨å˜è¿çš„è¿‡ç¨‹ä¸­ï¼Œä¸¤ä¸ªä¸åŒçš„é…ç½®å¯ä»¥å…±å­˜ï¼Œä»¥æ­¤æ¥å®ç°åœ¨å˜è¿è¿‡ç¨‹ä¸­é›†ç¾¤ä»ç„¶èƒ½æŒç»­è¿è½¬ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Replicated state machines é€šå¸¸ç”¨ replicated log å®ç°ã€‚ä¸€è‡´æ€§ç®—æ³•èµ·çš„ä½œç”¨æ˜¯ä¿è¯å¤šä¸ª replicas ä¸Šçš„ replicated log ä¸€è‡´ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å®é™…ç³»ç»Ÿä¸­ä½¿ç”¨çš„ä¸€è‡´æ€§ç®—æ³•é€šå¸¸æœ‰ä¸‹åˆ—ç‰¹æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;å®‰å…¨æ€§ä¿è¯&lt;/strong&gt;ï¼ˆç»å¯¹ä¸ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯çš„ç»“æœï¼‰&lt;/p&gt;

&lt;p&gt;åœ¨éæ‹œå åº­é”™è¯¯æƒ…å†µä¸‹ï¼Œç½‘ç»œå»¶è¿Ÿã€åˆ†åŒºã€ä¸¢åŒ…ã€å†—ä½™å’Œä¹±åºç­‰é”™è¯¯éƒ½å¯ä»¥ä¿è¯ä¸è¿”å›é”™è¯¯çš„ç»“æœã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;å¯ç”¨æ€§&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é›†ç¾¤ä¸­åªè¦å¤§å¤šæ•°çš„æœºå™¨å¯è¿è¡Œå¹¶ä¸”èƒ½å¤Ÿç›¸äº’é€šä¿¡ã€å’Œå®¢æˆ·ç«¯é€šä¿¡ï¼ŒæœåŠ¡å°±å¯ç”¨ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;ä¸ä¾èµ–æ—¶åºæ¥ä¿è¯ä¸€è‡´æ€§&lt;/strong&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œå°éƒ¨åˆ† slow servers ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“çš„æ€§èƒ½&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Raft basics&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;Raft implements consensus by first electing a distinguished leader, then giving the leader complete responsibility for managing the replicated log. The leader accepts log entries from clients, replicates them on other servers, and tells servers when it is safe to apply log entries to their state machines&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Raft åœ¨ä»»ä½•æ—¶å€™éƒ½ä¿è¯ä»¥ä¸‹çš„ç‰¹æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Election Safety&lt;/strong&gt;: at most one leader can be elected in a given term.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Leader Append-Only&lt;/strong&gt;: a leader never overwrites or deletes entries in its log; it only appends new entries. &lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Log Matching&lt;/strong&gt;: if two logs contain an entry with the same index and term, then the logs are identical in all entries up through the given index. &lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Leader Completeness&lt;/strong&gt;: if a log entry is committed in a given term, then that entry will be present in the logs of the leaders for all higher-numbered terms. &lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;State Machine Safety&lt;/strong&gt;: if a server has applied a log entry at a given index to its state machine, no other server will ever apply a different log entry for the same index.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Raft ä¸­æ¯ä¸ª server åœ¨ä»»æ„æ—¶åˆ»éƒ½å¤„äº &lt;strong&gt;leader&lt;/strong&gt;ã€&lt;strong&gt;follower&lt;/strong&gt;ã€&lt;strong&gt;candidate&lt;/strong&gt; è¿™ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ã€‚Followers è¢«åŠ¨çš„æ¥æ”¶ leader æˆ– candidate çš„è¯·æ±‚ï¼Œleader å¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼Œcandidate åˆ™èµ·äº†é€‰ä¸¾ leader çš„è§’è‰²ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-2/illustration-1.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Raft æŠŠæ—¶é—´åˆ’åˆ†ä¸º&lt;strong&gt;ä»»æœŸï¼ˆTermsï¼‰&lt;/strong&gt;ï¼Œå¹¶ä¿è¯æ¯ä¸ªä»»æœŸå†…åªæœ‰ä¸€ä¸ª leaderã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-2/illustration-2.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Terms act as a logical clock in Raft&lt;/strong&gt;, and they allow servers to detect obsolete information such as stale leaders. &lt;strong&gt;Each server stores a current term number, which increases monotonically over time. Current terms are exchanged whenever servers communicate&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Raft æœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨ RPC è¿›è¡Œé€šä¿¡ï¼Œ&lt;strong&gt;RequestVote RPC ç”¨äºé€‰ä¸¾ï¼ŒAppendEntries ç”¨äº leader å‘ followers å¤åˆ¶æ—¥å¿—å’Œå¿ƒè·³ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h2&gt;Log replication&lt;/h2&gt;

&lt;p&gt;Raft çš„æ—¥å¿—æœºåˆ¶ç»´æŠ¤ä¸‹é¢ä¸¤ä¸ªç‰¹æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;If two entries in different logs have the same index and term, then they store the same command.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;If two entries in different logs have the same index and term, then the logs are identical in all preceding entries.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Safty&lt;/h2&gt;

&lt;p&gt;åœ¨ä»»ä½• leader-based çš„ä¸€è‡´æ€§ç®—æ³•ä¸­ï¼Œleader éƒ½å¿…é¡»å­˜å‚¨æ‰€æœ‰å·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®ã€‚Raft ä½¿ç”¨äº†ä¸€ç§ç®€å•çš„åŠæ³•ï¼Œä¿è¯ä¹‹å‰ä»»æœŸä¸­å·²ç»æäº¤çš„æ—¥å¿—éƒ½ä¼šå‡ºç°åœ¨æ–°çš„ leader ä¸­ï¼Œä¸éœ€è¦å°†è¿™äº›æ—¥å¿—ä¼ ç»™æ–°çš„ leaderã€‚è¿™æ„å‘³ç€&lt;strong&gt;æ—¥å¿—çš„ä¼ é€æ˜¯å•å‘çš„ä» leader å‘å¾€ followersï¼Œå¹¶ä¸” leader ä»ä¸è¦†ç›–æœ¬åœ°å·²ç»å­˜åœ¨çš„æ—¥å¿—ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Raft åœ¨æŠ•ç¥¨è¿‡ç¨‹ä¸­åªå…è®¸&lt;strong&gt;åŒ…å«å…¨éƒ¨å·²æäº¤æ—¥å¿—çš„ server å½“é€‰ leader&lt;/strong&gt;ã€‚Raft é€šè¿‡æ¯”è¾ƒæ—¥å¿—ä¸­æœ€åä¸€æ¡æ—¥å¿—æ¡ç›®çš„ç´¢å¼•å€¼å’Œä»»æœŸæ¥åˆ¤æ–­å“ªä»½æ—¥å¿—æ›´æ–°ã€‚&lt;strong&gt;ä»»æœŸå¤§çš„æ—¥å¿—æ›´åŠ æ–°ï¼Œå¦‚æœä»»æœŸç›¸åŒï¼Œé‚£ä¹ˆæ—¥å¿—ç´¢å¼•å€¼æ›´å¤§çš„æ–°ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Leader ä¸èƒ½æ–­å®šä¹‹å‰ä»»æœŸé‡Œçš„æ—¥å¿—æ¡ç›®è¢«ä¿å­˜åˆ°å¤§å¤šæ•°æœåŠ¡å™¨ä¸Šçš„æ—¶å€™å°±ä¸€å®šå·²ç»æäº¤äº†ã€‚&lt;/strong&gt;ï¼ˆè¯·çœ‹è®ºæ–‡çš„ figure 8ï¼‰Raft æ°¸è¿œä¸ä¼šé€šè¿‡è®¡ç®—å‰¯æœ¬æ•°ç›®çš„æ–¹å¼æäº¤ä¸€ä¸ªä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®ã€‚&lt;strong&gt;åªæœ‰å½“å‰ä»»æœŸé‡Œçš„æ—¥å¿—æ¡ç›®æ˜¯é€šè¿‡è®¡ç®—å‰¯æœ¬æ•°ç›®çš„æ–¹å¼è¢«æäº¤ã€‚&lt;/strong&gt;ä¸€æ—¦å½“å‰ä»»æœŸçš„æ—¥å¿—æ¡ç›®ä»¥è¿™ç§æ–¹å¼è¢«æäº¤ï¼Œé‚£ä¹ˆç”±äºæ—¥å¿—åŒ¹é…ç‰¹æ€§ï¼Œä¹‹å‰çš„æ—¥å¿—æ¡ç›®ä¹Ÿéƒ½ä¼šè¢«é—´æ¥çš„æäº¤ã€‚&lt;/p&gt;

&lt;h2&gt;Timing and availability&lt;/h2&gt;

&lt;p&gt;Raft è¦æ±‚ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹æ—¶é—´é™åˆ¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;broadcastTime â‰ª electionTimeout â‰ª MTBF
&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
&lt;p&gt;BroadcastTime æŒ‡çš„æ˜¯å¹¶è¡Œå‘é€ RPCs ç»™é›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡å™¨å¹¶æ¥æ”¶åˆ°å“åº”çš„å¹³å‡æ—¶é—´ã€‚MTBF æ˜¯å•å°æœåŠ¡å™¨ä¸¤æ¬¡æ•…éšœä¹‹é—´çš„å¹³å‡æ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;Raft çš„ RPCs é€šå¸¸è€—æ—¶åœ¨ 0.5ms åˆ° 20ms ä¹‹é—´ã€‚å› æ­¤ electionTimeout æœ€å¥½å¤„äº 10ms åˆ° 500ms ä¹‹é—´ã€‚&lt;/p&gt;

&lt;h2&gt;Cluster membership changes&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†ä¿è¯é…ç½®ä¿®æ”¹æœºåˆ¶çš„å®‰å…¨ï¼Œåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­åŒä¸€ä¸ªä»»æœŸä¸­ä»»ä½•ä¸€ä¸ªæ—¶é—´ç‚¹éƒ½ä¸èƒ½å‡ºç°è¶…è¿‡ä¸€ä¸ª leaderã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-2/illustration-3.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Raft ä½¿ç”¨ two-phase çš„æ–¹å¼æ¥ä¿è¯å®‰å…¨æ€§ã€‚é›†ç¾¤é¦–å…ˆåˆ‡æ¢åˆ°è¿‡æ¸¡çš„é…ç½®ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º &lt;strong&gt;joint consensus&lt;/strong&gt;ã€‚ä¸€æ—¦ joint consensus è¢«æäº¤ï¼Œé›†ç¾¤å†åˆ‡æ¢åˆ°æ–°çš„é…ç½®ã€‚&lt;strong&gt;Joint consensus&lt;/strong&gt; æ˜¯æ–°è€é…ç½®çš„ç»“åˆï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ—¥å¿—æ¡ç›®è¢«å¤åˆ¶ç»™é›†ç¾¤ä¸­æ–°ã€è€é…ç½®çš„æ‰€æœ‰æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;æ–°ã€æ—§é…ç½®çš„æœåŠ¡å™¨éƒ½å¯ä»¥æˆä¸ºé¢†å¯¼äºº&lt;/li&gt;
&lt;li&gt;Agreement (for elections and entry commitment) éœ€è¦åˆ†åˆ«åœ¨ä¸¤ç§é…ç½®ä¸Šè·å¾—å¤§å¤šæ•°çš„æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é›†ç¾¤é…ç½®ä»¥ç‰¹æ®Šçš„æ—¥å¿—æ¡ç›®ä¿å­˜åœ¨ replicated log ä¸­æ¥å­˜å‚¨å’Œé€šä¿¡ï¼Œä¸‹å›¾å±•ç¤ºäº†é…ç½®è½¬æ¢çš„è¿‡ç¨‹ã€‚ä¸€æ—¦ä¸€ä¸ªæœåŠ¡å™¨å°†æ–°çš„é…ç½®æ—¥å¿—æ¡ç›®æ·»åŠ åˆ°æœ¬åœ°æ—¥å¿—ä¸­ï¼Œå®ƒå°±ä¼šç”¨è¿™ä¸ªé…ç½®æ¥åšå†³å®šï¼ˆæœåŠ¡å™¨æ€»æ˜¯ä½¿ç”¨æœ€æ–°çš„é…ç½®ï¼Œæ— è®ºè¯¥é…ç½®æ˜¯å¦å·²ç»è¢«æäº¤ï¼‰ã€‚è¿™æ„å‘³ç€ leader è¦ä½¿ç”¨ C-old,new çš„è§„åˆ™æ¥å†³å®šæ—¥å¿—æ¡ç›® C-old,new ä»€ä¹ˆæ—¶å€™éœ€è¦è¢«æäº¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/mit-6824-note-2/illustration-4.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸€æ—¦ C-old,new è¢«æäº¤ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯ C-old è¿˜æ˜¯ C-new éƒ½ä¸èƒ½å•ç‹¬åšå‡ºå†³å®šï¼Œå¹¶ä¸” Leader Completeness çš„ç‰¹æ€§ä¿è¯äº†åªæœ‰æ‹¥æœ‰ C-old,new æ—¥å¿—æ¡ç›®çš„æœåŠ¡å™¨æ‰æœ‰å¯èƒ½è¢«é€‰ä¸¾ä¸º leaderã€‚è¿™æ—¶ leader åˆ›å»ºä¸€æ¡ C-new é…ç½®çš„æ—¥å¿—æ¡ç›®å¹¶å¤åˆ¶ç»™é›†ç¾¤å°±æ˜¯å®‰å…¨çš„äº†ï¼Œæ¯ä¸ªæœåŠ¡å™¨åœ¨è§åˆ°æ–°çš„é…ç½®çš„æ—¶å€™å°±ä¼šç«‹å³ç”Ÿæ•ˆã€‚å½“æ–°çš„é…ç½®åœ¨ C-new çš„è§„åˆ™ä¸‹è¢«æäº¤ï¼Œä¸åœ¨æ–°çš„é…ç½®å†…çš„æœåŠ¡å™¨å°±å¯ä»¥å…³é—­äº†ã€‚&lt;/p&gt;

&lt;h2&gt;Client interaction&lt;/h2&gt;

&lt;p&gt;Raft çš„ç›®æ ‡æ˜¯è¦å®ç° linearizable semantics(each operation appears to execute instantaneously, exactly once, at some point between its invocation and its response) ä½† Raft æ˜¯å¯èƒ½æ‰§è¡ŒåŒä¸€æ¡å‘½ä»¤å¤šæ¬¡çš„ã€‚è§£å†³æ–¹æ³•æ˜¯&lt;strong&gt;å®¢æˆ·ç«¯å¯¹äºæ¯ä¸€æ¡æŒ‡ä»¤éƒ½èµ‹äºˆä¸€ä¸ªå”¯ä¸€çš„åºåˆ—å·ï¼ŒçŠ¶æ€æœºè®°å½•æ¯æ¡æŒ‡ä»¤æœ€æ–°çš„åºåˆ—å·å’Œç›¸åº”çš„å“åº”ã€‚&lt;/strong&gt;å¦‚æœæ¥æ”¶åˆ°ä¸€æ¡æŒ‡ä»¤å…¶åºåˆ—å·å·²ç»è¢«æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆå°±ç«‹å³è¿”å›å“åº”ï¼Œæ— éœ€é‡å¤æ‰§è¡ŒæŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;åªè¯»çš„æ“ä½œå¯ä»¥ç›´æ¥å¤„ç†è€Œä¸éœ€è¦å†™å…¥æ—¥å¿—ï¼Œä½†å¯èƒ½è¿”å›è„æ•°æ®ã€‚Raft é‡‡ç”¨é¢å¤–çš„æœºåˆ¶åœ¨ä¸å†™å…¥æ—¥å¿—çš„æƒ…å†µä¸‹ä¿è¯è¯»æ“ä½œçš„æ­£ç¡®æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Leader å¿…é¡»çŸ¥é“æœ€æ–°çš„è¢«æäº¤æ—¥å¿—ã€‚Raft ä¸­é€šè¿‡ leader åœ¨ä»»æœŸå¼€å§‹çš„æ—¶å€™æäº¤ä¸€ä¸ªç©ºç™½çš„æ—¥å¿—æ¡ç›®åˆ°æ—¥å¿—ä¸­å»æ¥å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;Leader åœ¨å¤„ç†åªè¯»çš„è¯·æ±‚ä¹‹å‰éœ€è¦æ£€æŸ¥è‡ªå·±æ˜¯å¦å·²ç»è¢«åºŸé»œäº†ã€‚Raft ä¸­é€šè¿‡è®© leader åœ¨å“åº”åªè¯»è¯·æ±‚ä¹‹å‰ï¼Œå…ˆå’Œé›†ç¾¤ä¸­çš„å¤§å¤šæ•°èŠ‚ç‚¹äº¤æ¢ä¸€æ¬¡å¿ƒè·³ä¿¡æ¯æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Raft makes a few design choices that sacrifice performance for simplicity:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Raft follower rejects out-of-order AppendEntries RPCs&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Rather than saving for use after hole is filled. Might be important if network re-orders packets a lot
And makes leader-&amp;gt;follower RPC pipelining harder&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Snapshotting is wasteful for big slowly-changing states&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;A slow leader may hurt Raft, e.g. in geo-replication&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Experience suggests these have a big effect on performance:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Disk writes for persistence&lt;/li&gt;
&lt;li&gt;Message/packet/RPC overhead&lt;/li&gt;
&lt;li&gt;Need to execute logged commands sequentially&lt;/li&gt;
&lt;li&gt;Fast path for read-only operations&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Appendix&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://thesecretlivesofdata.com/raft/&quot;&gt;http://thesecretlivesofdata.com/raft/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://thesquareplanet.com/blog/students-guide-to-raft/&quot;&gt;https://thesquareplanet.com/blog/students-guide-to-raft/&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Sat, 02 Dec 2017 15:19:31 +0800</pubDate>
        <link>http://masutangu.com/2017/12/mit-6824-note-2/</link>
        <guid isPermaLink="true">http://masutangu.com/2017/12/mit-6824-note-2/</guid>
        
        
        <category>è¯»ä¹¦ç¬”è®°</category>
        
      </item>
    
  </channel>
</rss>
